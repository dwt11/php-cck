!function(H,F){var I={msgurl:"mailbox.html?msg=",chatlogurl:"mailbox.html?user=",aniTime:200,right:-232,api:{friend:"js/plugins/layer/layim/data/friend.json",group:"js/plugins/layer/layim/data/group.json",chatlog:"js/plugins/layer/layim/data/chatlog.json",groups:"js/plugins/layer/layim/data/groups.json",sendurl:""},user:{name:"游客",face:"img/a1.jpg"},autoReplay:["您好，我现在有事不在，一会再和您联系。","你没发错吧？","洗澡中，请勿打扰，偷窥请购票，个体四十，团体八折，订票电话：一般人我不告诉他！","你好，我是主人的美女秘书，有什么事就跟我说吧，等他回来我会转告他的。","我正在拉磨，没法招呼您，因为我们家毛驴去动物保护协会把我告了，说我剥夺它休产假的权利。","<（@￣︶￣@）>","你要和我说话？你真的要和我说话？你确定自己想说吗？你一定非说不可吗？那你说吧，这是自动回复。","主人正在开机自检，键盘鼠标看好机会出去凉快去了，我是他的电冰箱，我打字比较慢，你慢慢说，别急……","(*^__^*) 嘻嘻，是贤心吗？"],chating:{},hosts:(function(){var A=location.href.match(/\:\d+/);A=A?A[0]:"";return"http://"+document.domain+A+"/"})(),json:function(B,C,A,D){return $.ajax({type:"POST",url:B,data:C,dataType:"json",success:A,error:D})},stopMP:function(A){A?A.stopPropagation():A.cancelBubble=true}},J=[$(window),$(document),$("html"),$("body")],G={};G.tabs=function(B){var A=G.node;A.tabs.eq(B).addClass("xxim_tabnow").siblings().removeClass("xxim_tabnow");A.list.eq(B).show().siblings(".xxim_list").hide();if(A.list.eq(B).find("li").length===0){G.getDates(B)}};G.renode=function(){var A=G.node={tabs:$("#xxim_tabs>span"),list:$(".xxim_list"),online:$(".xxim_online"),setonline:$(".xxim_setonline"),onlinetex:$("#xxim_onlinetex"),xximon:$("#xxim_on"),layimFooter:$("#xxim_bottom"),xximHide:$("#xxim_hide"),xximSearch:$("#xxim_searchkey"),searchMian:$("#xxim_searchmain"),closeSearch:$("#xxim_closesearch"),layimMin:$("#layim_min")}};G.expend=function(){var A=G.node;if(G.layimNode.attr("state")!=="1"){G.layimNode.stop().animate({right:I.right},I.aniTime,function(){A.xximon.addClass("xxim_off");try{localStorage.layimState=1}catch(B){}G.layimNode.attr({state:1});A.layimFooter.addClass("xxim_expend").stop().animate({marginLeft:I.right},I.aniTime/2);A.xximHide.addClass("xxim_show")})}else{G.layimNode.stop().animate({right:1},I.aniTime,function(){A.xximon.removeClass("xxim_off");try{localStorage.layimState=2}catch(B){}G.layimNode.removeAttr("state");A.layimFooter.removeClass("xxim_expend");A.xximHide.removeClass("xxim_show")});A.layimFooter.stop().animate({marginLeft:0},I.aniTime)}};G.layinit=function(){var B=G.node;try{if(localStorage.layimState==="1"){G.layimNode.attr({state:1}).css({right:I.right});B.xximon.addClass("xxim_off");B.layimFooter.addClass("xxim_expend").css({marginLeft:I.right});B.xximHide.addClass("xxim_show")}}catch(A){}};G.popchat=function(B){var A=G.node,C={};C.success=function(D){layer.setMove();G.chatbox=D.find("#layim_chatbox");C.chatlist=G.chatbox.find(".layim_chatmore>ul");C.chatlist.html('<li data-id="'+B.id+'" type="'+B.type+'"  id="layim_user'+B.type+B.id+'"><span>'+B.name+"</span><em>×</em></li>");G.tabchat(B,G.chatbox);G.chatbox.find(".layer_setmin").on("click",function(){var E=D.attr("times");D.hide();A.layimMin.text(G.nowchat.name).show()});G.chatbox.find(".layim_close").on("click",function(){var E=D.attr("times");layer.close(E);G.chatbox=null;I.chating={};I.chatings=0});C.chatlist.on("mouseenter","li",function(){$(this).find("em").show()}).on("mouseleave","li",function(){$(this).find("em").hide()});C.chatlist.on("click","li em",function(T){var E=$(this).parent(),S=E.attr("type");var R=E.attr("data-id"),U=E.index();var V=C.chatlist.find("li"),Q;I.stopMP(T);delete I.chating[S+R];I.chatings--;E.remove();$("#layim_area"+S+R).remove();if(S==="group"){$("#layim_group"+S+R).remove()}if(E.hasClass("layim_chatnow")){if(U===I.chatings){Q=U-1}else{Q=U+1}G.tabchat(I.chating[V.eq(Q).attr("type")+V.eq(Q).attr("data-id")])}if(C.chatlist.find("li").length===1){C.chatlist.parent().hide()}});C.chatlist.on("click","li",function(){var M=$(this),E=M.attr("type"),N=M.attr("data-id");G.tabchat(I.chating[E+N])});C.sendType=$("#layim_sendtype"),C.sendTypes=C.sendType.find("span");$("#layim_enter").on("click",function(E){I.stopMP(E);C.sendType.show()});C.sendTypes.on("click",function(){C.sendTypes.find("i").text("");$(this).find("i").text("√")});G.transmit()};C.html='<div class="layim_chatbox" id="layim_chatbox"><h6><span class="layim_move"></span>    <a href="'+B.url+'" class="layim_face" target="_blank"><img src="'+B.face+'" ></a>    <a href="'+B.url+'" class="layim_names" target="_blank">'+B.name+'</a>    <span class="layim_rightbtn">        <i class="layer_setmin">—</i>        <i class="layim_close">&times;</i>    </span></h6><div class="layim_chatmore" id="layim_chatmore">    <ul class="layim_chatlist"></ul></div><div class="layim_groups" id="layim_groups"></div><div class="layim_chat">    <div class="layim_chatarea" id="layim_chatarea">        <ul class="layim_chatview layim_chatthis"  id="layim_area'+B.type+B.id+'"></ul>    </div>    <div class="layim_tool">        <i class="layim_addface fa fa-meh-o" title="发送表情"></i>        <a href="javascript:;"><i class="layim_addimage fa fa-picture-o" title="上传图片"></i></a>        <a href="javascript:;"><i class="layim_addfile fa fa-paperclip" title="上传附件"></i></a>        <a href="" target="_blank" class="layim_seechatlog"><i class="fa fa-comment-o"></i>聊天记录</a>    </div>    <textarea class="layim_write" id="layim_write"></textarea>    <div class="layim_send">        <div class="layim_sendbtn" id="layim_sendbtn">发送<span class="layim_enter" id="layim_enter"><em class="layim_zero"></em></span></div>        <div class="layim_sendtype" id="layim_sendtype">            <span><i>√</i>按Enter键发送</span>            <span><i></i>按Ctrl+Enter键发送</span>        </div>    </div></div></div>';if(I.chatings<1){$.layer({type:1,border:[0],title:false,shade:[0],area:["620px","493px"],move:".layim_chatbox .layim_move",moveType:1,closeBtn:false,offset:[(($(window).height()-493)/2)+"px",""],page:{html:C.html},success:function(D){C.success(D)}})}else{C.chatmore=G.chatbox.find("#layim_chatmore");C.chatarea=G.chatbox.find("#layim_chatarea");C.chatmore.show();C.chatmore.find("ul>li").removeClass("layim_chatnow");C.chatmore.find("ul").append('<li data-id="'+B.id+'" type="'+B.type+'" id="layim_user'+B.type+B.id+'" class="layim_chatnow"><span>'+B.name+"</span><em>×</em></li>");C.chatarea.find(".layim_chatview").removeClass("layim_chatthis");C.chatarea.append('<ul class="layim_chatview layim_chatthis" id="layim_area'+B.type+B.id+'"></ul>');G.tabchat(B)}C.chatgroup=G.chatbox.find("#layim_groups");if(B.type==="group"){C.chatgroup.find("ul").removeClass("layim_groupthis");C.chatgroup.append('<ul class="layim_groupthis" id="layim_group'+B.type+B.id+'"></ul>');G.getGroups(B)}C.chatgroup.on("click","ul>li",function(){G.popchatbox($(this))})};G.tabchat=function(B){var A=G.node,D={},C=B.type+B.id;G.nowchat=B;G.chatbox.find("#layim_user"+C).addClass("layim_chatnow").siblings().removeClass("layim_chatnow");G.chatbox.find("#layim_area"+C).addClass("layim_chatthis").siblings().removeClass("layim_chatthis");G.chatbox.find("#layim_group"+C).addClass("layim_groupthis").siblings().removeClass("layim_groupthis");G.chatbox.find(".layim_face>img").attr("src",B.face);G.chatbox.find(".layim_face, .layim_names").attr("href",B.href);G.chatbox.find(".layim_names").text(B.name);G.chatbox.find(".layim_seechatlog").attr("href",I.chatlogurl+B.id);D.groups=G.chatbox.find(".layim_groups");if(B.type==="group"){D.groups.show()}else{D.groups.hide()}$("#layim_write").focus()};G.popchatbox=function(A){var B=G.node,L=A.attr("data-id"),C={id:L,type:A.attr("type"),name:A.find(".xxim_onename").text(),face:A.find(".xxim_oneface").attr("src"),href:"profile.html?user="+L},D=C.type+L;if(!I.chating[D]){G.popchat(C);I.chatings++}else{G.tabchat(C)}I.chating[D]=C;var E=$("#layim_chatbox");if(E[0]){B.layimMin.hide();E.parents(".xubox_layer").show()}};G.getGroups=function(A){var B=A.type+A.id,C="",D=G.chatbox.find("#layim_group"+B);D.addClass("loading");I.json(I.api.groups,{},function(M){if(M.status===1){var E=0,N=M.data.length;if(N>0){for(;E<N;E++){C+='<li data-id="'+M.data[E].id+'" type="one"><img src="'+M.data[E].face+'" class="xxim_oneface"><span class="xxim_onename">'+M.data[E].name+"</span></li>"}}else{C='<li class="layim_errors">没有群员</li>'}}else{C='<li class="layim_errors">'+M.msg+"</li>"}D.removeClass("loading");D.html(C)},function(){D.removeClass("loading");D.html('<li class="layim_errors">请求异常</li>')})};G.transmit=function(){var A=G.node,B={};A.sendbtn=$("#layim_sendbtn");A.imwrite=$("#layim_write");B.send=function(){var D={content:A.imwrite.val(),id:G.nowchat.id,sign_key:"",_:+new Date};if(D.content.replace(/\s/g,"")===""){layer.tips("说点啥呗！","#layim_write",2);A.imwrite.focus()}else{var C=G.nowchat.type+G.nowchat.id;B.html=function(E,L){return'<li class="'+(L==="me"?"layim_chateme":"")+'"><div class="layim_chatuser">'+function(){if(L==="me"){return'<span class="layim_chattime">'+E.time+'</span><span class="layim_chatname">'+E.name+'</span><img src="'+E.face+'" >'}else{return'<img src="'+E.face+'" ><span class="layim_chatname">'+E.name+'</span><span class="layim_chattime">'+E.time+"</span>"}}()+'</div><div class="layim_chatsay">'+E.content+'<em class="layim_zero"></em></div></li>'};B.imarea=G.chatbox.find("#layim_area"+C);B.imarea.append(B.html({time:"2014-04-26 0:37",name:I.user.name,face:I.user.face,content:D.content},"me"));A.imwrite.val("").focus();B.imarea.scrollTop(B.imarea[0].scrollHeight);setTimeout(function(){B.imarea.append(B.html({time:"2014-04-26 0:38",name:G.nowchat.name,face:G.nowchat.face,content:I.autoReplay[(Math.random()*I.autoReplay.length)|0]}));B.imarea.scrollTop(B.imarea[0].scrollHeight)},500)}};A.sendbtn.on("click",B.send);A.imwrite.keyup(function(C){if(C.keyCode===13){B.send()}})};G.event=function(){var A=G.node;A.tabs.eq(0).addClass("xxim_tabnow");A.tabs.on("click",function(){var B=$(this),C=B.index();G.tabs(C)});A.list.on("click","h5",function(){var C=$(this),B=C.siblings(".xxim_chatlist"),D=C.find("i");if(D.hasClass("fa-caret-down")){B.hide();D.attr("class","fa fa-caret-right")}else{B.show();D.attr("class","fa fa-caret-down")}});A.online.on("click",function(B){I.stopMP(B);A.setonline.show()});A.setonline.find("span").on("click",function(C){var B=$(this).index();I.stopMP(C);if(B===0){A.onlinetex.html("在线");A.online.removeClass("xxim_offline")}else{if(B===1){A.onlinetex.html("隐身");A.online.addClass("xxim_offline")}}A.setonline.hide()});A.xximon.on("click",G.expend);A.xximHide.on("click",G.expend);A.xximSearch.keyup(function(){var B=$(this).val().replace(/\s/g,"");if(B!==""){A.searchMian.show();A.closeSearch.show();A.list.eq(3).html('<li class="xxim_errormsg">没有符合条件的结果</li>')}else{A.searchMian.hide();A.closeSearch.hide()}});A.closeSearch.on("click",function(){$(this).hide();A.searchMian.hide();A.xximSearch.val("").focus()});I.chatings=0;A.list.on("click",".xxim_childnode",function(){var B=$(this);G.popchatbox(B)});A.layimMin.on("click",function(){$(this).hide();$("#layim_chatbox").parents(".xubox_layer").show()});J[1].on("click",function(){A.setonline.hide();$("#layim_sendtype").hide()})};G.getDates=function(B){var C=[I.api.friend,I.api.group,I.api.chatlog],A=G.node,D=A.list.eq(B);D.addClass("loading");I.json(C[B],{},function(R){if(R.status===1){var T=0,P=R.data.length,S="",E;if(P>1){if(B!==2){for(;T<P;T++){S+='<li data-id="'+R.data[T].id+'" class="xxim_parentnode"><h5><i class="fa fa-caret-right"></i><span class="xxim_parentname">'+R.data[T].name+'</span><em class="xxim_nums">（'+R.data[T].nums+'）</em></h5><ul class="xxim_chatlist">';E=R.data[T].item;for(var Q=0;Q<E.length;Q++){S+='<li data-id="'+E[Q].id+'" class="xxim_childnode" type="'+(B===0?"one":"group")+'"><img src="'+E[Q].face+'" class="xxim_oneface"><span class="xxim_onename">'+E[Q].name+"</span></li>"}S+="</ul></li>"}}else{S+='<li class="xxim_liston"><ul class="xxim_chatlist">';for(;T<P;T++){S+='<li data-id="'+R.data[T].id+'" class="xxim_childnode" type="one"><img src="'+R.data[T].face+'"  class="xxim_oneface"><span  class="xxim_onename">'+R.data[T].name+'</span><em class="xxim_time">'+R.data[T].time+"</em></li>"}S+="</ul></li>"}D.html(S)}else{D.html('<li class="xxim_errormsg">没有任何数据</li>')}D.removeClass("loading")}else{D.html('<li class="xxim_errormsg">'+R.msg+"</li>")}},function(){D.html('<li class="xxim_errormsg">请求失败</li>');D.removeClass("loading")})};G.view=(function(){var A=G.layimNode=$('<div id="xximmm" class="xxim_main"><div class="xxim_top" id="xxim_top">  <div class="xxim_search"><i class="fa fa-search"></i><input id="xxim_searchkey" /><span id="xxim_closesearch">×</span></div>  <div class="xxim_tabs" id="xxim_tabs"><span class="xxim_tabfriend" title="好友"><i class="fa fa-user"></i></span><span class="xxim_tabgroup" title="群组"><i class="fa fa-users"></i></span><span class="xxim_latechat"  title="最近聊天"><i class="fa fa-clock-o"></i></span></div>  <ul class="xxim_list" style="display:block"></ul>  <ul class="xxim_list"></ul>  <ul class="xxim_list"></ul>  <ul class="xxim_list xxim_searchmain" id="xxim_searchmain"></ul></div><ul class="xxim_bottom" id="xxim_bottom"><li class="xxim_online" id="xxim_online"><i class="xxim_nowstate fa fa-check-circle"></i><span id="xxim_onlinetex">在线</span><div class="xxim_setonline"><span><i class="fa fa-check-circle"></i>在线</span><span class="xxim_setoffline"><i class="fa fa-check-circle"></i>隐身</span></div></li><li class="xxim_mymsg" id="xxim_mymsg" title="我的私信"><i class="fa fa-comment"></i><a href="'+I.msgurl+'" target="_blank"></a></li><li class="xxim_seter" id="xxim_seter" title="设置"><i class="fa fa-gear"></i><div></div></li><li class="xxim_hide" id="xxim_hide"><i class="fa fa-exchange"></i></li><li id="xxim_on" class="xxim_icon xxim_on fa fa-ellipsis-v"></li><div class="layim_min" id="layim_min"></div></ul></div>');J[3].append(A);G.renode();G.getDates(0);G.event();G.layinit()}())}(window);