var toMarkdown=function(W){var X=[{patterns:"p",replacement:function(C,B,A){return A?"\n\n"+A+"\n":""}},{patterns:"br",type:"void",replacement:"\n"},{patterns:"h([1-6])",replacement:function(C,F,E,D){var B="";for(var A=0;A<F;A++){B+="#"}return"\n\n"+B+" "+D+"\n"}},{patterns:"hr",type:"void",replacement:"\n\n* * *\n"},{patterns:"a",replacement:function(E,D,C){var B=D.match(V("href")),A=D.match(V("title"));return B?"["+C+"]("+B[1]+(A&&A[1]?' "'+A[1]+'"':"")+")":E}},{patterns:["b","strong"],replacement:function(C,B,A){return A?"**"+A+"**":""}},{patterns:["i","em"],replacement:function(C,B,A){return A?"_"+A+"_":""}},{patterns:"code",replacement:function(C,B,A){return A?"`"+A+"`":""}},{patterns:"img",type:"void",replacement:function(F,E,D){var C=E.match(V("src")),B=E.match(V("alt")),A=E.match(V("title"));return"!["+(B&&B[1]?B[1]:"")+"]("+C[1]+(A&&A[1]?' "'+A[1]+'"':"")+")"}}];for(var O=0,P=X.length;O<P;O++){if(typeof X[O].patterns==="string"){W=U(W,{tag:X[O].patterns,replacement:X[O].replacement,type:X[O].type})}else{for(var Y=0,R=X[O].patterns.length;Y<R;Y++){W=U(W,{tag:X[O].patterns[Y],replacement:X[O].replacement,type:X[O].type})}}}function U(C,B){var E=B.type==="void"?"<"+B.tag+"\\b([^>]*)\\/?>":"<"+B.tag+"\\b([^>]*)>([\\s\\S]*?)<\\/"+B.tag+">",D=new RegExp(E,"gi"),A="";if(typeof B.replacement==="string"){A=C.replace(D,B.replacement)}else{A=C.replace(D,function(H,F,I,G){return B.replacement.call(this,H,F,I,G)})}return A}function V(A){return new RegExp(A+"\\s*=\\s*[\"']?([^\"']*)[\"']?","i")}W=W.replace(/<pre\b[^>]*>`([\s\S]*)`<\/pre>/gi,function(B,A){A=A.replace(/^\t+/g,"  ");A=A.replace(/\n/g,"\n    ");return"\n\n    "+A+"\n"});W=W.replace(/^(\s{0,3}\d+)\. /g,"$1\\. ");var T=/<(ul|ol)\b[^>]*>(?:(?!<ul|<ol)[\s\S])*?<\/\1>/gi;while(W.match(T)){W=W.replace(T,function(A){return Z(A)})}function Z(A){A=A.replace(/<(ul|ol)\b[^>]*>([\s\S]*?)<\/\1>/gi,function(C,D,E){var B=E.split("</li>");B.splice(B.length-1,1);for(O=0,P=B.length;O<P;O++){if(B[O]){var F=(D==="ol")?(O+1)+".  ":"*   ";B[O]=B[O].replace(/\s*<li[^>]*>([\s\S]*)/i,function(H,G){G=G.replace(/^\s+/,"");G=G.replace(/\n\n/g,"\n\n    ");G=G.replace(/\n([ ]*)+(\*|\d+\.) /g,"\n$1    $2 ");return F+G})}}return B.join("\n")});return"\n\n"+A.replace(/[ \t]+\n|\s+$/g,"")}var N=/<blockquote\b[^>]*>((?:(?!<blockquote)[\s\S])*?)<\/blockquote>/gi;while(W.match(N)){W=W.replace(N,function(A){return S(A)})}function S(A){A=A.replace(/<blockquote\b[^>]*>([\s\S]*?)<\/blockquote>/gi,function(C,B){B=B.replace(/^\s+|\s+$/g,"");B=Q(B);B=B.replace(/^/gm,"> ");B=B.replace(/^(>([ \t]{2,}>)+)/gm,"> >");return B});return A}function Q(A){A=A.replace(/^[\t\r\n]+|[\t\r\n]+$/g,"");A=A.replace(/\n\s+\n/g,"\n\n");A=A.replace(/\n{3,}/g,"\n\n");return A}return Q(W)};if(typeof exports==="object"){exports.toMarkdown=toMarkdown};