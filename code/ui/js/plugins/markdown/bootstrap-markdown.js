!function(G){var J=function(B,A){this.$ns="bootstrap-markdown";this.$element=G(B);this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null};this.$options=G.extend(true,{},G.fn.markdown.defaults,A,this.$element.data(),this.$element.data("options"));this.$oldContent=null;this.$isPreview=false;this.$isFullscreen=false;this.$editor=null;this.$textarea=null;this.$handler=[];this.$callback=[];this.$nextTab=[];this.showEditor()};J.prototype={constructor:J,__alterButtons:function(B,C){var D=this.$handler,E=(B=="all"),A=this;G.each(D,function(P,O){var N=true;if(E){N=false}else{N=O.indexOf(B)<0}if(N==false){C(A.$editor.find('button[data-handler="'+O+'"]'))}})},__buildButtons:function(e,B){var a,j=this.$ns,p=this.$handler,h=this.$callback;for(a=0;a<e.length;a++){var A,i=e[a];for(A=0;A<i.length;A++){var d,C=i[A].data,m=G("<div/>",{"class":"btn-group"});for(d=0;d<C.length;d++){var k=C[d],n,l,o=j+"-"+k.name,f=this.__getIcon(k.icon),g=k.btnText?k.btnText:"",E=k.btnClass?k.btnClass:"btn",c=k.tabIndex?k.tabIndex:"-1",D=typeof k.hotkey!=="undefined"?k.hotkey:"",b=typeof jQuery.hotkeys!=="undefined"&&D!==""?" ("+D+")":"";n=G("<button></button>");n.text(" "+this.__localize(g)).addClass("btn-white btn-sm").addClass(E);if(E.match(/btn\-(primary|success|info|warning|danger|link)/)){n.removeClass("btn-default")}n.attr({"type":"button","title":this.__localize(k.title)+b,"tabindex":c,"data-provider":j,"data-handler":o,"data-hotkey":D});if(k.toggle==true){n.attr("data-toggle","button")}l=G("<span/>");l.addClass(f);l.prependTo(n);m.append(n);p.push(o);h.push(k.callback)}B.append(m)}}return B},__setListener:function(){var A=typeof this.$textarea.attr("rows")!="undefined",B=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",C=A?this.$textarea.attr("rows"):B;this.$textarea.attr("rows",C);if(this.$options.resize){this.$textarea.css("resize",this.$options.resize)}this.$textarea.on("focus",G.proxy(this.focus,this)).on("keypress",G.proxy(this.keypress,this)).on("keyup",G.proxy(this.keyup,this)).on("change",G.proxy(this.change,this));if(this.eventSupported("keydown")){this.$textarea.on("keydown",G.proxy(this.keydown,this))}this.$textarea.data("markdown",this)},__handle:function(B){var E=G(B.currentTarget),C=this.$handler,A=this.$callback,N=E.attr("data-handler"),D=C.indexOf(N),M=A[D];G(B.currentTarget).focus();M(this);this.change(this);if(N.indexOf("cmdSave")<0){this.$textarea.focus()}B.preventDefault()},__localize:function(B){var C=G.fn.markdown.messages,A=this.$options.language;if(typeof C!=="undefined"&&typeof C[A]!=="undefined"&&typeof C[A][B]!=="undefined"){return C[A][B]}return B},__getIcon:function(A){return typeof A=="object"?A[this.$options.iconlibrary]:A},setFullscreen:function(A){var B=this.$editor,C=this.$textarea;if(A===true){B.addClass("md-fullscreen-mode");G("body").addClass("md-nooverflow");this.$options.onFullscreen(this)}else{B.removeClass("md-fullscreen-mode");G("body").removeClass("md-nooverflow")}this.$isFullscreen=A;C.focus()},showEditor:function(){var b=this,c,f=this.$ns,a=this.$element,D=a.css("height"),i=a.css("width"),B=this.$editable,k=this.$handler,g=this.$callback,C=this.$options,l=G("<div/>",{"class":"md-editor",click:function(){b.focus()}});if(this.$editor==null){var n=G("<div/>",{"class":"md-header btn-toolbar"});var m=[];if(C.buttons.length>0){m=m.concat(C.buttons[0])}if(C.additionalButtons.length>0){m=m.concat(C.additionalButtons[0])}if(C.reorderButtonGroups.length>0){m=m.filter(function(K){return C.reorderButtonGroups.indexOf(K.name)>-1}).sort(function(L,K){if(C.reorderButtonGroups.indexOf(L.name)<C.reorderButtonGroups.indexOf(K.name)){return -1}if(C.reorderButtonGroups.indexOf(L.name)>C.reorderButtonGroups.indexOf(K.name)){return 1}return 0})}if(m.length>0){n=this.__buildButtons([m],n)}if(C.fullscreen.enable){n.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(C.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(K){K.preventDefault();b.setFullscreen(true)})}l.append(n);if(a.is("textarea")){a.before(l);c=a;c.addClass("md-input");l.append(c)}else{var e=(typeof toMarkdown=="function")?toMarkdown(a.html()):a.html(),h=G.trim(e);c=G("<textarea/>",{"class":"md-input","val":h});l.append(c);B.el=a;B.type=a.prop("tagName").toLowerCase();B.content=a.html();G(a[0].attributes).each(function(){B.attrKeys.push(this.nodeName);B.attrValues.push(this.nodeValue)});a.replaceWith(l)}var Z=G("<div/>",{"class":"md-footer"}),d=false,j="";if(C.savable){d=true;var E="cmdSave";k.push(E);g.push(C.onSave);Z.append('<button class="btn btn-success" data-provider="'+f+'" data-handler="'+E+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}j=typeof C.footer==="function"?C.footer(this):C.footer;if(G.trim(j)!==""){d=true;Z.append(j)}if(d){l.append(Z)}if(C.width&&C.width!=="inherit"){if(jQuery.isNumeric(C.width)){l.css("display","table");c.css("width",C.width+"px")}else{l.addClass(C.width)}}if(C.height&&C.height!=="inherit"){if(jQuery.isNumeric(C.height)){var A=C.height;if(n){A=Math.max(0,A-n.outerHeight())}if(Z){A=Math.max(0,A-Z.outerHeight())}c.css("height",A+"px")}else{l.addClass(C.height)}}this.$editor=l;this.$textarea=c;this.$editable=B;this.$oldContent=this.getContent();this.__setListener();this.$editor.attr("id",(new Date).getTime());this.$editor.on("click",'[data-provider="bootstrap-markdown"]',G.proxy(this.__handle,this));if(this.$element.is(":disabled")||this.$element.is("[readonly]")){this.$editor.addClass("md-editor-disabled");this.disableButtons("all")}if(this.eventSupported("keydown")&&typeof jQuery.hotkeys==="object"){n.find('[data-provider="bootstrap-markdown"]').each(function(){var K=G(this),L=K.attr("data-hotkey");if(L.toLowerCase()!==""){c.bind("keydown",L,function(){K.trigger("click");return false})}})}if(C.initialstate==="preview"){this.showPreview()}else{if(C.initialstate==="fullscreen"&&C.fullscreen.enable){this.setFullscreen(true)}}}else{this.$editor.show()}if(C.autofocus){this.$textarea.focus();this.$editor.addClass("active")}if(C.fullscreen.enable&&C.fullscreen!==false){this.$editor.append('          <div class="md-fullscreen-controls">            <a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(C.fullscreen.icons.fullscreenOff)+'"></span></a>          </div>');this.$editor.on("click",".exit-fullscreen",function(K){K.preventDefault();b.setFullscreen(false)})}this.hideButtons(C.hiddenButtons);this.disableButtons(C.disabledButtons);C.onShow(this);return this},parseContent:function(){var B,A=this.$options.onPreview(this);if(typeof A=="string"){B=A}else{var C=this.$textarea.val();if(typeof markdown=="object"){B=markdown.toHTML(C)}else{if(typeof marked=="function"){B=marked(C)}else{B=C}}}return B},showPreview:function(){var B=this.$options,C=this.$textarea,E=C.next(),A=G("<div/>",{"class":"md-preview","data-provider":"markdown-preview"}),D;this.$isPreview=true;this.disableButtons("all").enableButtons("cmdPreview");D=this.parseContent();A.html(D);if(E&&E.attr("class")=="md-footer"){A.insertBefore(E)}else{C.parent().append(A)}A.css({width:C.outerWidth()+"px",height:C.outerHeight()+"px"});if(this.$options.resize){A.css("resize",this.$options.resize)}C.hide();A.data("markdown",this);if(this.$element.is(":disabled")||this.$element.is("[readonly]")){this.$editor.addClass("md-editor-disabled");this.disableButtons("all")}return this},hidePreview:function(){this.$isPreview=false;var A=this.$editor.find('div[data-provider="markdown-preview"]');A.remove();this.enableButtons("all");this.disableButtons(this.$options.disabledButtons);this.$textarea.show();this.__setListener();return this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(A){this.$textarea.val(A);return this},findSelection:function(A){var C=this.getContent(),B;if(B=C.indexOf(A),B>=0&&A.length>0){var E=this.getSelection(),D;this.setSelection(B,B+A.length);D=this.getSelection();this.setSelection(E.start,E.end);return D}else{return null}},getSelection:function(){var A=this.$textarea[0];return(("selectionStart" in A&&function(){var B=A.selectionEnd-A.selectionStart;return{start:A.selectionStart,end:A.selectionEnd,length:B,text:A.value.substr(A.selectionStart,B)}})||function(){return null})()},setSelection:function(B,C){var A=this.$textarea[0];return(("selectionStart" in A&&function(){A.selectionStart=B;A.selectionEnd=C;return})||function(){return null})()},replaceSelection:function(B){var A=this.$textarea[0];return(("selectionStart" in A&&function(){A.value=A.value.substr(0,A.selectionStart)+B+A.value.substr(A.selectionEnd,A.value.length);A.selectionStart=A.value.length;return this})||function(){A.value+=B;return jQuery(A)})()},getNextTab:function(){if(this.$nextTab.length==0){return null}else{var B,A=this.$nextTab.shift();if(typeof A=="function"){B=A()}else{if(typeof A=="object"&&A.length>0){B=A}}return B}},setNextTab:function(C,B){if(typeof C=="string"){var D=this;this.$nextTab.push(function(){return D.findSelection(C)})}else{if(typeof C=="number"&&typeof B=="number"){var A=this.getSelection();this.setSelection(C,B);this.$nextTab.push(this.getSelection());this.setSelection(A.start,A.end)}}return},__parseButtonNameParam:function(A){var B=[];if(typeof A=="string"){B.push(A)}else{B=A}return B},enableButtons:function(B){var A=this.__parseButtonNameParam(B),C=this;G.each(A,function(D,E){C.__alterButtons(A[D],function(L){L.removeAttr("disabled")})});return this},disableButtons:function(B){var A=this.__parseButtonNameParam(B),C=this;G.each(A,function(D,E){C.__alterButtons(A[D],function(L){L.attr("disabled","disabled")})});return this},hideButtons:function(B){var A=this.__parseButtonNameParam(B),C=this;G.each(A,function(D,E){C.__alterButtons(A[D],function(L){L.addClass("hidden")})});return this},showButtons:function(B){var A=this.__parseButtonNameParam(B),C=this;G.each(A,function(D,E){C.__alterButtons(A[D],function(L){L.removeClass("hidden")})});return this},eventSupported:function(A){var B=A in this.$element;if(!B){this.$element.setAttribute(A,"return;");B=typeof this.$element[A]==="function"}return B},keyup:function(B){var C=false;switch(B.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var E;if(E=this.getNextTab(),E!=null){var A=this;setTimeout(function(){A.setSelection(E.start,E.end)},500);C=true}else{var D=this.getSelection();if(D.start==D.end&&D.end==this.getContent().length){C=false}else{this.setSelection(this.getContent().length,this.getContent().length);C=true}}break;case 13:C=false;break;case 27:if(this.$isFullscreen){this.setFullscreen(false)}C=false;break;default:C=false}if(C){B.stopPropagation();B.preventDefault()}this.$options.onChange(this)},change:function(A){this.$options.onChange(this);return this},focus:function(A){var B=this.$options,C=B.hideable,D=this.$editor;D.addClass("active");G(document).find(".md-editor").each(function(){if(G(this).attr("id")!=D.attr("id")){var E;if(E=G(this).find("textarea").data("markdown"),E==null){E=G(this).find('div[data-provider="markdown-preview"]').data("markdown")}if(E){E.blur()}}});B.onFocus(this);return this},blur:function(N){var A=this.$options,O=A.hideable,B=this.$editor,C=this.$editable;if(B.hasClass("active")||this.$element.parent().length==0){B.removeClass("active");if(O){if(C.el!=null){var P=G("<"+C.type+"/>"),E=this.getContent(),D=(typeof markdown=="object")?markdown.toHTML(E):E;G(C.attrKeys).each(function(L,K){P.attr(C.attrKeys[L],C.attrValues[L])});P.html(D);B.replaceWith(P)}else{B.hide()}}A.onBlur(this)}return this}};var H=G.fn.markdown;G.fn.markdown=function(A){return this.each(function(){var C=G(this),D=C.data("markdown"),B=typeof A=="object"&&A;if(!D){C.data("markdown",(D=new J(this,B)))}})};G.fn.markdown.messages={};G.fn.markdown.defaults={autofocus:false,hideable:false,savable:false,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"zh",initialstate:"editor",buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(B){var A,C,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("strong text")}else{A=E.text}if(D.substr(E.start-2,2)=="**"&&D.substr(E.end,2)=="**"){B.setSelection(E.start-2,E.end+2);B.replaceSelection(A);C=E.start-2}else{B.replaceSelection("**"+A+"**");C=E.start+2}B.setSelection(C,C+A.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(B){var A,C,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("emphasized text")}else{A=E.text}if(D.substr(E.start-1,1)=="_"&&D.substr(E.end,1)=="_"){B.setSelection(E.start-1,E.end+1);B.replaceSelection(A);C=E.start-1}else{B.replaceSelection("_"+A+"_");C=E.start+1}B.setSelection(C,C+A.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font"},callback:function(B){var A,N,E=B.getSelection(),C=B.getContent(),D,M;if(E.length==0){A=B.__localize("heading text")}else{A=E.text+"\n"}if((D=4,C.substr(E.start-D,D)=="### ")||(D=3,C.substr(E.start-D,D)=="###")){B.setSelection(E.start-D,E.end);B.replaceSelection(A);N=E.start-D}else{if(E.start>0&&(M=C.substr(E.start-1,1),!!M&&M!="\n")){B.replaceSelection("\n\n### "+A);N=E.start+6}else{B.replaceSelection("### "+A);N=E.start+4}}B.setSelection(N,N+A.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(B){var A,N,D=B.getSelection(),M=B.getContent(),E;if(D.length==0){A=B.__localize("enter link description here")}else{A=D.text}E=prompt(B.__localize("Insert Hyperlink"),"http://");if(E!=null&&E!=""&&E!="http://"&&E.substr(0,4)=="http"){var C=G("<div>"+E+"</div>").text();B.replaceSelection("["+A+"]("+C+")");N=D.start+1;B.setSelection(N,N+A.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(B){var A,N,D=B.getSelection(),M=B.getContent(),E;if(D.length==0){A=B.__localize("enter image description here")}else{A=D.text}E=prompt(B.__localize("Insert Image Hyperlink"),"http://");if(E!=null&&E!=""&&E!="http://"&&E.substr(0,4)=="http"){var C=G("<div>"+E+"</div>").text();B.replaceSelection("!["+A+"]("+C+' "'+B.__localize("enter image title here")+'")');N=D.start+2;B.setNextTab(B.__localize("enter image title here"));B.setSelection(N,N+A.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(B){var A,L,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("list text here");B.replaceSelection("- "+A);L=E.start+2}else{if(E.text.indexOf("\n")<0){A=E.text;B.replaceSelection("- "+A);L=E.start+2}else{var C=[];C=E.text.split("\n");A=C[0];G.each(C,function(N,K){C[N]="- "+K});B.replaceSelection("\n\n"+C.join("\n"));L=E.start+4}}B.setSelection(L,L+A.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(B){var A,L,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("list text here");B.replaceSelection("1. "+A);L=E.start+3}else{if(E.text.indexOf("\n")<0){A=E.text;B.replaceSelection("1. "+A);L=E.start+3}else{var C=[];C=E.text.split("\n");A=C[0];G.each(C,function(N,K){C[N]="1. "+K});B.replaceSelection("\n\n"+C.join("\n"));L=E.start+5}}B.setSelection(L,L+A.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(B){var A,C,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("code text here")}else{A=E.text}if(D.substr(E.start-1,1)=="`"&&D.substr(E.end,1)=="`"){B.setSelection(E.start-1,E.end+1);B.replaceSelection(A);C=E.start-1}else{B.replaceSelection("`"+A+"`");C=E.start+1}B.setSelection(C,C+A.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(B){var A,L,E=B.getSelection(),D=B.getContent();if(E.length==0){A=B.__localize("quote here");B.replaceSelection("> "+A);L=E.start+2}else{if(E.text.indexOf("\n")<0){A=E.text;B.replaceSelection("> "+A);L=E.start+2}else{var C=[];C=E.text.split("\n");A=C[0];G.each(C,function(N,K){C[N]="> "+K});B.replaceSelection("\n\n"+C.join("\n"));L=E.start+4}}B.setSelection(L,L+A.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:true,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(A){var B=A.$isPreview,C;if(B==false){A.showPreview()}else{A.hidePreview()}}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:true,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(A){},onPreview:function(A){},onSave:function(A){},onBlur:function(A){},onFocus:function(A){},onChange:function(A){},onFullscreen:function(A){}};G.fn.markdown.Constructor=J;G.fn.markdown.noConflict=function(){G.fn.markdown=H;return this};var I=function(A){var B=A;if(B.data("markdown")){B.data("markdown").showEditor();return}B.markdown()};var F=function(A){var B=G(document.activeElement);G(document).find(".md-editor").each(function(){var C=G(this),D=B.closest(".md-editor")[0]===this,E=C.find("textarea").data("markdown")||C.find('div[data-provider="markdown-preview"]').data("markdown");if(E&&!D){E.blur()}})};G(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(A){I(G(this));A.preventDefault()}).on("click focusin",function(A){F(A)}).ready(function(){G('textarea[data-provide="markdown"]').each(function(){I(G(this))})})}(window.jQuery);