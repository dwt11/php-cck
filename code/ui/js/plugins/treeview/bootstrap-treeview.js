(function(I,N,L,J){var M="treeview";var K=function(B,A){this.$element=I(B);this._element=B;this._elementId=this._element.id;this._styleId=this._elementId+"-style";this.tree=[];this.nodes=[];this.selectedNode={};this._init(A)};K.defaults={injectStyle:true,levels:2,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",nodeIcon:"glyphicon glyphicon-stop",color:J,backColor:J,borderColor:J,onhoverColor:"#F5F5F5",selectedColor:"#FFFFFF",selectedBackColor:"#428bca",enableLinks:false,highlightSelected:true,showBorder:true,showTags:false,onNodeSelected:J};K.prototype={remove:function(){this._destroy();I.removeData(this,"plugin_"+M);I("#"+this._styleId).remove()},_destroy:function(){if(this.initialized){this.$wrapper.remove();this.$wrapper=null;this._unsubscribeEvents()}this.initialized=false},_init:function(A){if(A.data){if(typeof A.data==="string"){A.data=I.parseJSON(A.data)}this.tree=I.extend(true,[],A.data);delete A.data}this.options=I.extend({},K.defaults,A);this._setInitialLevels(this.tree,0);this._destroy();this._subscribeEvents();this._render()},_unsubscribeEvents:function(){this.$element.off("click")},_subscribeEvents:function(){this._unsubscribeEvents();this.$element.on("click",I.proxy(this._clickHandler,this));if(typeof(this.options.onNodeSelected)==="function"){this.$element.on("nodeSelected",this.options.onNodeSelected)}},_clickHandler:function(C){if(!this.options.enableLinks){C.preventDefault()}var D=I(C.target),A=D.attr("class")?D.attr("class").split(" "):[],B=this._findNode(D);if((A.indexOf("click-expand")!=-1)||(A.indexOf("click-collapse")!=-1)){this._toggleNodes(B);this._render()}else{if(B){this._setSelectedNode(B)}}},_findNode:function(C){var A=C.closest("li.list-group-item").attr("data-nodeid"),B=this.nodes[A];if(!B){console.log("Error: node does not exist")}return B},_triggerNodeSelectedEvent:function(A){this.$element.trigger("nodeSelected",[I.extend(true,{},A)])},_setSelectedNode:function(A){if(!A){return}if(A===this.selectedNode){this.selectedNode={}}else{this._triggerNodeSelectedEvent(this.selectedNode=A)}this._render()},_setInitialLevels:function(A,D){if(!A){return}D+=1;var C=this;I.each(A,function B(E,F){if(D>=C.options.levels){C._toggleNodes(F)}var G=F.nodes?F.nodes:F._nodes?F._nodes:J;if(G){return C._setInitialLevels(G,D)}})},_toggleNodes:function(A){if(!A.nodes&&!A._nodes){return}if(A.nodes){A._nodes=A.nodes;delete A.nodes}else{A.nodes=A._nodes;delete A._nodes}},_render:function(){var A=this;if(!A.initialized){A.$element.addClass(M);A.$wrapper=I(A._template.list);A._injectStyle();A.initialized=true}A.$element.empty().append(A.$wrapper.empty());A.nodes=[];A._buildTree(A.tree,0)},_buildTree:function(A,D){if(!A){return}D+=1;var C=this;I.each(A,function B(G,F){F.nodeId=C.nodes.length;C.nodes.push(F);var Q=I(C._template.item).addClass("node-"+C._elementId).addClass((F===C.selectedNode)?"node-selected":"").attr("data-nodeid",F.nodeId).attr("style",C._buildStyleOverride(F));for(var R=0;R<(D-1);R++){Q.append(C._template.indent)}if(F._nodes){Q.append(I(C._template.iconWrapper).append(I(C._template.icon).addClass("click-expand").addClass(C.options.expandIcon)))}else{if(F.nodes){Q.append(I(C._template.iconWrapper).append(I(C._template.icon).addClass("click-collapse").addClass(C.options.collapseIcon)))}else{Q.append(I(C._template.iconWrapper).append(I(C._template.icon).addClass("glyphicon")))}}Q.append(I(C._template.iconWrapper).append(I(C._template.icon).addClass(F.icon?F.icon:C.options.nodeIcon)));if(C.options.enableLinks){Q.append(I(C._template.link).attr("href",F.href).append(F.text))}else{Q.append(F.text)}if(C.options.showTags&&F.tags){I.each(F.tags,function E(O,P){Q.append(I(C._template.badge).append(P))})}C.$wrapper.append(Q);if(F.nodes){return C._buildTree(F.nodes,D)}})},_buildStyleOverride:function(A){var B="";if(this.options.highlightSelected&&(A===this.selectedNode)){B+="color:"+this.options.selectedColor+";"}else{if(A.color){B+="color:"+A.color+";"}}if(this.options.highlightSelected&&(A===this.selectedNode)){B+="background-color:"+this.options.selectedBackColor+";"}else{if(A.backColor){B+="background-color:"+A.backColor+";"}}return B},_injectStyle:function(){if(this.options.injectStyle&&!L.getElementById(this._styleId)){I('<style type="text/css" id="'+this._styleId+'"> '+this._buildStyle()+" </style>").appendTo("head")}},_buildStyle:function(){var A=".node-"+this._elementId+"{";if(this.options.color){A+="color:"+this.options.color+";"}if(this.options.backColor){A+="background-color:"+this.options.backColor+";"}if(!this.options.showBorder){A+="border:none;"}else{if(this.options.borderColor){A+="border:1px solid "+this.options.borderColor+";"}}A+="}";if(this.options.onhoverColor){A+=".node-"+this._elementId+":hover{background-color:"+this.options.onhoverColor+";}"}return this._css+A},_template:{list:'<ul class="list-group"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',iconWrapper:'<span class="icon"></span>',icon:"<i></i>",link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge"></span>'},_css:".list-group-item{cursor:pointer;}span.indent{margin-left:10px;margin-right:10px}span.icon{margin-right:5px}"};var H=function(A){if(N.console){N.console.error(A)}};I.fn[M]=function(A,B){return this.each(function(){var C=I.data(this,"plugin_"+M);if(typeof A==="string"){if(!C){H("Not initialized, can not call method : "+A)}else{if(!I.isFunction(C[A])||A.charAt(0)==="_"){H("No such method : "+A)}else{if(typeof B==="string"){B=[B]}C[A].apply(C,B)}}}else{if(!C){I.data(this,"plugin_"+M,new K(this,I.extend(true,{},A)))}else{C._init(A)}}})}})(jQuery,window,document);