(function(){var g=window.jQuery,s=g(window),a=g(document),i;var e="http://www.w3.org/2000/svg",v="SVGAngle" in window&&(function(){var B,A=document.createElement("div");A.innerHTML="<svg/>";B=(A.firstChild&&A.firstChild.namespaceURI)==e;A.innerHTML="";return B})();var r=(function(){var A=document.createElement("div").style;return"transition" in A||"WebkitTransition" in A||"MozTransition" in A||"msTransition" in A||"OTransition" in A})();var q="ontouchstart" in window,u="mousedown"+(q?" touchstart":""),x="mousemove.clockpicker"+(q?" touchmove.clockpicker":""),h="mouseup.clockpicker"+(q?" touchend.clockpicker":"");var w=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null;function k(A){return document.createElementNS(e,A)}function m(A){return(A<10?"0":"")+A}var d=0;function b(A){var B=++d+"";return A?A+B:B}var c=100,n=80,f=54,t=13,o=c*2,j=r?350:1;var l=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");function Z(A,G){var D=g(l),C=D.find(".clockpicker-plate"),I=D.find(".clockpicker-hours"),Ad=D.find(".clockpicker-minutes"),B=D.find(".clockpicker-am-pm-block"),R=A.prop("tagName")==="INPUT",J=R?A:A.find("input"),Q=A.find(".input-group-addon"),V=this,M;this.id=b("cp");this.element=A;this.options=G;this.isAppended=false;this.isShown=false;this.currentView="hours";this.isInput=R;this.input=J;this.addon=Q;this.popover=D;this.plate=C;this.hoursView=I;this.minutesView=Ad;this.amPmBlock=B;this.spanHours=D.find(".clockpicker-span-hours");this.spanMinutes=D.find(".clockpicker-span-minutes");this.spanAmPm=D.find(".clockpicker-span-am-pm");this.amOrPm="PM";if(G.twelvehour){var L=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");var T=g(L);g('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){V.amOrPm="AM";g(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock);g('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){V.amOrPm="PM";g(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}if(!G.autoclose){g('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+G.donetext+"</button>").click(g.proxy(this.done,this)).appendTo(D)}if((G.placement==="top"||G.placement==="bottom")&&(G.align==="top"||G.align==="bottom")){G.align="left"}if((G.placement==="left"||G.placement==="right")&&(G.align==="left"||G.align==="right")){G.align="top"}D.addClass(G.placement);D.addClass("clockpicker-align-"+G.align);this.spanHours.click(g.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(g.proxy(this.toggleView,this,"minutes"));J.on("focus.clockpicker click.clockpicker",g.proxy(this.show,this));Q.on("click.clockpicker",g.proxy(this.toggle,this));var O=g('<div class="clockpicker-tick"></div>'),U,H,X,S;if(G.twelvehour){for(U=1;U<13;U+=1){H=O.clone();X=U/6*Math.PI;S=n;H.css("font-size","120%");H.css({left:c+Math.sin(X)*S-t,top:c-Math.cos(X)*S-t});H.html(U===0?"00":U);I.append(H);H.on(u,Aa)}}else{for(U=0;U<24;U+=1){H=O.clone();X=U/6*Math.PI;var N=U>0&&U<13;S=N?f:n;H.css({left:c+Math.sin(X)*S-t,top:c-Math.cos(X)*S-t});if(N){H.css("font-size","120%")}H.html(U===0?"00":U);I.append(H);H.on(u,Aa)}}for(U=0;U<60;U+=5){H=O.clone();X=U/30*Math.PI;H.css({left:c+Math.sin(X)*n-t,top:c-Math.cos(X)*n-t});H.css("font-size","120%");H.html(m(U));Ad.append(H);H.on(u,Aa)}C.on(u,function(y){if(g(y.target).closest(".clockpicker-tick").length===0){Aa(y,true)}});function Aa(Ar,Ai){var Ao=C.offset(),Ah=/^touch/.test(Ar.type),Am=Ao.left+c,An=Ao.top+c,Ac=(Ah?Ar.originalEvent.touches[0]:Ar).pageX-Am,y=(Ah?Ar.originalEvent.touches[0]:Ar).pageY-An,Aq=Math.sqrt(Ac*Ac+y*y),Ap=false;if(Ai&&(Aq<n-t||Aq>n+t)){return}Ar.preventDefault();var z=setTimeout(function(){i.addClass("clockpicker-moving")},200);if(v){C.append(V.canvas)}V.setHand(Ac,y,!Ai,true);a.off(x).on(x,function(Af){Af.preventDefault();var Ae=/^touch/.test(Af.type),Ag=(Ae?Af.originalEvent.touches[0]:Af).pageX-Am,Aj=(Ae?Af.originalEvent.touches[0]:Af).pageY-An;if(!Ap&&Ag===Ac&&Aj===y){return}Ap=true;V.setHand(Ag,Aj,false,true)});a.off(h).on(h,function(Af){a.off(h);Af.preventDefault();var Ae=/^touch/.test(Af.type),Ag=(Ae?Af.originalEvent.changedTouches[0]:Af).pageX-Am,Aj=(Ae?Af.originalEvent.changedTouches[0]:Af).pageY-An;if((Ai||Ap)&&Ag===Ac&&Aj===y){V.setHand(Ag,Aj)}if(V.currentView==="hours"){V.toggleView("minutes",j/2)}else{if(G.autoclose){V.minutesView.addClass("clockpicker-dial-out");setTimeout(function(){V.done()},j/2)}}C.prepend(K);clearTimeout(z);i.removeClass("clockpicker-moving");a.off(x)})}if(v){var K=D.find(".clockpicker-canvas"),E=k("svg");E.setAttribute("class","clockpicker-svg");E.setAttribute("width",o);E.setAttribute("height",o);var P=k("g");P.setAttribute("transform","translate("+c+","+c+")");var Ab=k("circle");Ab.setAttribute("class","clockpicker-canvas-bearing");Ab.setAttribute("cx",0);Ab.setAttribute("cy",0);Ab.setAttribute("r",2);var F=k("line");F.setAttribute("x1",0);F.setAttribute("y1",0);var Y=k("circle");Y.setAttribute("class","clockpicker-canvas-bg");Y.setAttribute("r",t);var W=k("circle");W.setAttribute("class","clockpicker-canvas-fg");W.setAttribute("r",3.5);P.appendChild(F);P.appendChild(Y);P.appendChild(W);P.appendChild(Ab);E.appendChild(P);K.append(E);this.hand=F;this.bg=Y;this.fg=W;this.bearing=Ab;this.g=P;this.canvas=K}p(this.options.init)}function p(A){if(A&&typeof A==="function"){A()}}Z.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:false,twelvehour:false,vibrate:true};Z.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};Z.prototype.locate=function(){var B=this.element,I=this.popover,D=B.offset(),H=B.outerWidth(),F=B.outerHeight(),G=this.options.placement,A=this.options.align,E={},C=this;I.show();switch(G){case"bottom":E.top=D.top+F;break;case"right":E.left=D.left+H;break;case"top":E.top=D.top-I.outerHeight();break;case"left":E.left=D.left-I.outerWidth();break}switch(A){case"left":E.left=D.left;break;case"right":E.left=D.left+H-I.outerWidth();break;case"top":E.top=D.top;break;case"bottom":E.top=D.top+F-I.outerHeight();break}I.css(E)};Z.prototype.show=function(A){if(this.isShown){return}p(this.options.beforeShow);var B=this;if(!this.isAppended){i=g(document.body).append(this.popover);s.on("resize.clockpicker"+this.id,function(){if(B.isShown){B.locate()}});this.isAppended=true}var D=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if(D[0]==="now"){var C=new Date(+new Date()+this.options.fromnow);D=[C.getHours(),C.getMinutes()]}this.hours=+D[0]||0;this.minutes=+D[1]||0;this.spanHours.html(m(this.hours));this.spanMinutes.html(m(this.minutes));this.toggleView("hours");this.locate();this.isShown=true;a.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(E){var F=g(E.target);if(F.closest(B.popover).length===0&&F.closest(B.addon).length===0&&F.closest(B.input).length===0){B.hide()}});a.on("keyup.clockpicker."+this.id,function(E){if(E.keyCode===27){B.hide()}});p(this.options.afterShow)};Z.prototype.hide=function(){p(this.options.beforeHide);this.isShown=false;a.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);a.off("keyup.clockpicker."+this.id);this.popover.hide();p(this.options.afterHide)};Z.prototype.toggleView=function(E,B){var C=false;if(E==="minutes"&&g(this.hoursView).css("visibility")==="visible"){p(this.options.beforeHourSelect);C=true}var F=E==="hours",D=F?this.hoursView:this.minutesView,A=F?this.minutesView:this.hoursView;this.currentView=E;this.spanHours.toggleClass("text-primary",F);this.spanMinutes.toggleClass("text-primary",!F);A.addClass("clockpicker-dial-out");D.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(B);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){A.css("visibility","hidden")},j);if(C){p(this.options.afterHourSelect)}};Z.prototype.resetClock=function(E){var B=this.currentView,J=this[B],A=B==="hours",D=Math.PI/(A?6:30),F=J*D,H=A&&J>0&&J<13?f:n,I=Math.sin(F)*H,C=-Math.cos(F)*H,G=this;if(v&&E){G.canvas.addClass("clockpicker-canvas-out");setTimeout(function(){G.canvas.removeClass("clockpicker-canvas-out");G.setHand(I,C)},E)}else{this.setHand(I,C)}};Z.prototype.setHand=function(C,D,G,M){var N=Math.atan2(C,-D),I=this.currentView==="hours",H=Math.PI/(I||G?6:30),F=Math.sqrt(C*C+D*D),A=this.options,B=I&&F<(n+f)/2,E=B?f:n,K;if(A.twelvehour){E=n}if(N<0){N=Math.PI*2+N}K=Math.round(N/H);N=K*H;if(A.twelvehour){if(I){if(K===0){K=12}}else{if(G){K*=5}if(K===60){K=0}}}else{if(I){if(K===12){K=0}K=B?(K===0?12:K):K===0?0:K+12}else{if(G){K*=5}if(K===60){K=0}}}if(this[this.currentView]!==K){if(w&&this.options.vibrate){if(!this.vibrateTimer){navigator[w](10);this.vibrateTimer=setTimeout(g.proxy(function(){this.vibrateTimer=null},this),100)}}}this[this.currentView]=K;this[I?"spanHours":"spanMinutes"].html(m(K));if(!v){this[I?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var O=g(this);O.toggleClass("active",K===+O.html())});return}if(M||(!I&&K%5)){this.g.insertBefore(this.hand,this.bearing);this.g.insertBefore(this.bg,this.fg);this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")}else{this.g.insertBefore(this.hand,this.bg);this.g.insertBefore(this.fg,this.bg);this.bg.setAttribute("class","clockpicker-canvas-bg")}var L=Math.sin(N)*E,J=-Math.cos(N)*E;this.hand.setAttribute("x2",L);this.hand.setAttribute("y2",J);this.bg.setAttribute("cx",L);this.bg.setAttribute("cy",J);this.fg.setAttribute("cx",L);this.fg.setAttribute("cy",J)};Z.prototype.done=function(){p(this.options.beforeDone);this.hide();var B=this.input.prop("value"),A=m(this.hours)+":"+m(this.minutes);if(this.options.twelvehour){A=A+this.amOrPm}this.input.prop("value",A);if(A!==B){this.input.triggerHandler("change");if(!this.isInput){this.element.trigger("change")}}if(this.options.autoclose){this.input.trigger("blur")}p(this.options.afterDone)};Z.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");if(this.isShown){this.hide()}if(this.isAppended){s.off("resize.clockpicker"+this.id);this.popover.remove()}};g.fn.clockpicker=function(A){var B=Array.prototype.slice.call(arguments,1);return this.each(function(){var D=g(this),C=D.data("clockpicker");if(!C){var E=g.extend({},Z.DEFAULTS,D.data(),typeof A=="object"&&A);D.data("clockpicker",new Z(D,E))}else{if(typeof C[A]==="function"){C[A].apply(C,B)}}})}}());