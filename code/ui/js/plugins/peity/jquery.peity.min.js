(function(N,M,P){var J=function(B,C){var A=M.createElementNS("http://www.w3.org/2000/svg",B);N.each(C,function(D,E){A.setAttribute(D,E)});return A},Q="createElementNS" in M&&J("svg",{}).createSVGRect,O=1/(window.devicePixelRatio||1),R=N.fn.peity=function(A,B){Q&&this.each(function(){var E=N(this),G=E.data("peity");if(G){A&&(G.type=A),N.extend(G.opts,B)}else{var D=R.defaults[A],F={};N.each(E.data(),function(H,I){H in D&&(F[H]=I)});var C=N.extend({},D,F,B),G=new L(E,A,C);E.change(function(){G.draw()}).data("peity",G)}G.draw()});return this},L=function(B,C,A){this.$el=B;this.type=C;this.opts=A},K=L.prototype;K.draw=function(){R.graphers[this.type].call(this,this.opts)};K.fill=function(){var A=this.opts.fill,B=A;N.isFunction(B)||(B=function(D,C){return A[C%A.length]});return B};K.prepare=function(B,C){var A;this.svg?A=N(this.svg).empty():(this.svg=J("svg",{"class":"peity"}),this.$el.hide().after(this.svg),A=N(this.svg).data("peity",this));this.svg.setAttribute("height",C);this.svg.setAttribute("width",B);return A};K.values=function(){return N.map(this.$el.text().split(this.opts.delimiter),function(A){return parseFloat(A)})};R.defaults={};R.graphers={};R.register=function(B,C,A){this.defaults[B]=C;this.graphers[B]=A};R.register("pie",{delimiter:null,diameter:16,fill:["#ff9900","#fff4dd","#ffc66e"]},function(b){if(!b.delimiter){var d=this.$el.text().match(/[^0-9\.]/);b.delimiter=d?d[0]:","}d=this.values();if("/"==b.delimiter){var e=d[0],d=[e,P.max(0,d[1]-e)]}for(var G=0,e=d.length,c=0;G<e;G++){c+=d[G]}for(var b=this.prepare(b.width||b.diameter,b.height||b.diameter),G=b.width(),F=b.height(),b=G/2,F=F/2,A=P.min(b,F),f=P.PI,B=this.fill(),Z=-f/2,G=0;G<e;G++){var a=d[G],H=a/c,C;if(0!=H){if(1==H){C=J("circle",{cx:b,cy:F,r:A})}else{C=2*H*f;var H=Z+C,I=A*P.cos(Z)+b,Z=A*P.sin(Z)+F,D=A*P.cos(H)+b,E=A*P.sin(H)+F;C=J("path",{d:["M",b,F,"L",I,Z,"A",A,A,0,C>f?1:0,1,D,E,"Z"].join(" ")});Z=H}C.setAttribute("fill",B.call(this,a,G,d));this.svg.appendChild(C)}}});R.register("line",{delimiter:",",fill:"#c6d9fd",height:16,max:null,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(H){var B=this.values();1==B.length&&B.push(B[0]);for(var C=P.max.apply(P,B.concat([H.max])),G=P.min.apply(P,B.concat([H.min])),I=this.prepare(H.width,H.height),F=I.width(),I=I.height()-H.strokeWidth,T=F/(B.length-1),C=C-G,A=0==C?I:I/C,E=I+G*A,C=[0,E],D=0;D<B.length;D++){C.push(D*T,I-A*(B[D]-G)+H.strokeWidth/2)}C.push(F,E);B=J("polygon",{fill:H.fill,points:C.join(" ")});this.svg.appendChild(B);H.strokeWidth&&(H=J("polyline",{fill:"transparent",points:C.slice(2,C.length-2).join(" "),stroke:H.stroke,"stroke-width":H.strokeWidth,"stroke-linecap":"square"}),this.svg.appendChild(H))});R.register("bar",{delimiter:",",fill:["#4D89F9"],gap:1,height:16,max:null,min:0,width:32},function(G){for(var I=this.values(),F=P.max.apply(P,I.concat([G.max])),W=P.min.apply(P,I.concat([G.min])),X=this.prepare(G.width,G.height),Y=X.width(),X=X.height(),Z=F-W,A=0==Z?0:X/Z,G=G.gap,Y=(Y+G)/I.length,H=this.fill(),E=0;E<I.length;E++){var B=I[E],C=X-A*(B-W),D=A*B;if(0==D){if(D=O,0>=W&&0<F||0==Z){C-=O}}else{0>D&&(C+=D,D=-D)}B=J("rect",{fill:H.call(this,B,E,I),x:E*Y,y:C,width:Y-G,height:D});this.svg.appendChild(B)}})})(jQuery,document,Math);