(function(E){function D(Am){var Ae=null;var s=null;var q=null;var A=null;var Ai=null;var m=0;var Ab=true;var t=10;var Ak=0.95;var C=0;var Ah=false;var An=false;var r=[];Am.hooks.processOptions.push(z);Am.hooks.bindEvents.push(v);function z(H,G){if(G.series.pie.show){G.grid.show=false;if(G.series.pie.label.show=="auto"){if(G.legend.show){G.series.pie.label.show=false}else{G.series.pie.label.show=true}}if(G.series.pie.radius=="auto"){if(G.series.pie.label.show){G.series.pie.radius=3/4}else{G.series.pie.radius=1}}if(G.series.pie.tilt>1){G.series.pie.tilt=1}if(G.series.pie.tilt<0){G.series.pie.tilt=0}H.hooks.processDatapoints.push(Ad);H.hooks.drawOverlay.push(Ap);H.hooks.draw.push(Af)}}function v(G,I){var H=G.getOptions();if(H.series.pie.show&&H.grid.hoverable){I.unbind("mousemove").mousemove(l)}if(H.series.pie.show&&H.grid.clickable){I.unbind("click").click(Ao)}}function n(H){var G="";function I(K,L){if(!L){L=0}for(var M=0;M<K.length;++M){for(var J=0;J<L;J++){G+="\t"}if(typeof K[M]=="object"){G+=""+M+":\n";I(K[M],L+1)}else{G+=""+M+": "+K[M]+"\n"}}}I(H);alert(G)}function Ag(G){for(var H=0;H<G.length;++H){var I=parseFloat(G[H].data[0][1]);if(I){m+=I}}}function Ad(J,G,H,I){if(!Ah){Ah=true;Ae=J.getCanvas();s=E(Ae).parent();F=J.getOptions();J.setData(Ac(J.getData()))}}function Aa(){C=s.children().filter(".legend").children().width();q=Math.min(Ae.width,(Ae.height/F.series.pie.tilt))/2;Ai=(Ae.height/2)+F.series.pie.offset.top;A=(Ae.width/2);if(F.series.pie.offset.left=="auto"){if(F.legend.position.match("w")){A+=C/2}else{A-=C/2}}else{A+=F.series.pie.offset.left}if(A<q){A=q}else{if(A>Ae.width-q){A=Ae.width-q}}}function p(H){for(var G=0;G<H.length;++G){if(typeof(H[G].data)=="number"){H[G].data=[[1,H[G].data]]}else{if(typeof(H[G].data)=="undefined"||typeof(H[G].data[0])=="undefined"){if(typeof(H[G].data)!="undefined"&&typeof(H[G].data.label)!="undefined"){H[G].label=H[G].data.label}H[G].data=[[1,0]]}}}return H}function Ac(I){I=p(I);Ag(I);var G=0;var J=0;var H=F.series.pie.combine.color;var K=[];for(var L=0;L<I.length;++L){I[L].data[0][1]=parseFloat(I[L].data[0][1]);if(!I[L].data[0][1]){I[L].data[0][1]=0}if(I[L].data[0][1]/m<=F.series.pie.combine.threshold){G+=I[L].data[0][1];J++;if(!H){H=I[L].color}}else{K.push({data:[[1,I[L].data[0][1]]],color:I[L].color,label:I[L].label,angle:(I[L].data[0][1]*(Math.PI*2))/m,percent:(I[L].data[0][1]/m*100)})}}if(J>0){K.push({data:[[1,G]],color:H,label:F.series.pie.combine.label,angle:(G*(Math.PI*2))/m,percent:(G/m*100)})}return K}function Af(I,H){if(!s){return}ctx=H;Aa();var J=I.getData();var K=0;while(Ab&&K<t){Ab=false;if(K>0){q*=Ak}K+=1;L();if(F.series.pie.tilt<=0.8){G()}M()}if(K>=t){L();s.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')}if(I.setSeries&&I.insertLegend){I.setSeries(J);I.insertLegend()}function L(){ctx.clearRect(0,0,Ae.width,Ae.height);s.children().filter(".pieLabel, .pieLabelBackground").remove()}function G(){var S=5;var P=15;var R=10;var O=0.02;if(F.series.pie.radius>1){var Q=F.series.pie.radius}else{var Q=q*F.series.pie.radius}if(Q>=(Ae.width/2)-S||Q*F.series.pie.tilt>=(Ae.height/2)-P||Q<=R){return}ctx.save();ctx.translate(S,P);ctx.globalAlpha=O;ctx.fillStyle="#000";ctx.translate(A,Ai);ctx.scale(1,F.series.pie.tilt);for(var N=1;N<=R;N++){ctx.beginPath();ctx.arc(0,0,Q,0,Math.PI*2,false);ctx.fill();Q-=N}ctx.restore()}function M(){startAngle=Math.PI*F.series.pie.startAngle;if(F.series.pie.radius>1){var Q=F.series.pie.radius}else{var Q=q*F.series.pie.radius}ctx.save();ctx.translate(A,Ai);ctx.scale(1,F.series.pie.tilt);ctx.save();var O=startAngle;for(var N=0;N<J.length;++N){J[N].startAngle=O;R(J[N].angle,J[N].color,true)}ctx.restore();ctx.save();ctx.lineWidth=F.series.pie.stroke.width;O=startAngle;for(var N=0;N<J.length;++N){R(J[N].angle,F.series.pie.stroke.color,false)}ctx.restore();w(ctx);if(F.series.pie.label.show){P()}ctx.restore();function R(T,S,U){if(T<=0){return}if(U){ctx.fillStyle=S}else{ctx.strokeStyle=S;ctx.lineJoin="round"}ctx.beginPath();if(Math.abs(T-Math.PI*2)>1e-09){ctx.moveTo(0,0)}else{if(E.browser.msie){T-=0.0001}}ctx.arc(0,0,Q,O,O+T,false);ctx.closePath();O+=T;if(U){ctx.fill()}else{ctx.stroke()}}function P(){var V=startAngle;if(F.series.pie.label.radius>1){var T=F.series.pie.label.radius}else{var T=q*F.series.pie.label.radius}for(var U=0;U<J.length;++U){if(J[U].percent>=F.series.pie.label.threshold*100){S(J[U],V,U)}V+=J[U].angle}function S(g,As,e){if(g.data[0][1]==0){return}var W=F.legend.labelFormatter,a,f=F.series.pie.label.formatter;if(W){a=W(g.label,g)}else{a=g.label}if(f){a=f(a,g)}var c=((As+g.angle)+As)/2;var Y=A+Math.round(Math.cos(c)*T);var j=Ai+Math.round(Math.sin(c)*T)*F.series.pie.tilt;var h='<span class="pieLabel" id="pieLabel'+e+'" style="position:absolute;top:'+j+"px;left:"+Y+'px;">'+a+"</span>";s.append(h);var b=s.children("#pieLabel"+e);var k=(j-b.height()/2);var X=(Y-b.width()/2);b.css("top",k);b.css("left",X);if(0-k>0||0-X>0||Ae.height-(k+b.height())<0||Ae.width-(X+b.width())<0){Ab=true}if(F.series.pie.label.background.opacity!=0){var d=F.series.pie.label.background.color;if(d==null){d=g.color}var Z="top:"+k+"px;left:"+X+"px;";E('<div class="pieLabelBackground" style="position:absolute;width:'+b.width()+"px;height:"+b.height()+"px;"+Z+"background-color:"+d+';"> </div>').insertBefore(b).css("opacity",F.series.pie.label.background.opacity)}}}}}function w(G){if(F.series.pie.innerRadius>0){G.save();innerRadius=F.series.pie.innerRadius>1?F.series.pie.innerRadius:q*F.series.pie.innerRadius;G.globalCompositeOperation="destination-out";G.beginPath();G.fillStyle=F.series.pie.stroke.color;G.arc(0,0,innerRadius,0,Math.PI*2,false);G.fill();G.closePath();G.restore();G.save();G.beginPath();G.strokeStyle=F.series.pie.stroke.color;G.arc(0,0,innerRadius,0,Math.PI*2,false);G.stroke();G.closePath();G.restore()}}function u(K,I){for(var J=false,H=-1,L=K.length,G=L-1;++H<L;G=H){((K[H][1]<=I[1]&&I[1]<K[G][1])||(K[G][1]<=I[1]&&I[1]<K[H][1]))&&(I[0]<(K[G][0]-K[H][0])*(I[1]-K[H][1])/(K[G][1]-K[H][1])+K[H][0])&&(J=!J)}return J}function B(J,G){var K=Am.getData(),I=Am.getOptions(),L=I.series.pie.radius>1?I.series.pie.radius:q*I.series.pie.radius;for(var M=0;M<K.length;++M){var H=K[M];if(H.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,L,H.startAngle,H.startAngle+H.angle,false);ctx.closePath();x=J-A;y=G-Ai;if(ctx.isPointInPath){if(ctx.isPointInPath(J-A,G-Ai)){ctx.restore();return{datapoint:[H.percent,H.data],dataIndex:0,series:H,seriesIndex:M}}}else{p1X=(L*Math.cos(H.startAngle));p1Y=(L*Math.sin(H.startAngle));p2X=(L*Math.cos(H.startAngle+(H.angle/4)));p2Y=(L*Math.sin(H.startAngle+(H.angle/4)));p3X=(L*Math.cos(H.startAngle+(H.angle/2)));p3Y=(L*Math.sin(H.startAngle+(H.angle/2)));p4X=(L*Math.cos(H.startAngle+(H.angle/1.5)));p4Y=(L*Math.sin(H.startAngle+(H.angle/1.5)));p5X=(L*Math.cos(H.startAngle+H.angle));p5Y=(L*Math.sin(H.startAngle+H.angle));arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(u(arrPoly,arrPoint)){ctx.restore();return{datapoint:[H.percent,H.data],dataIndex:0,series:H,seriesIndex:M}}}ctx.restore()}}return null}function l(G){Aj("plothover",G)}function Ao(G){Aj("plotclick",G)}function Aj(H,N){var O=Am.offset(),M=parseInt(N.pageX-O.left),I=parseInt(N.pageY-O.top),K=B(M,I);if(F.grid.autoHighlight){for(var G=0;G<r.length;++G){var J=r[G];if(J.auto==H&&!(K&&J.series==K.series)){o(J.series)}}}if(K){Aq(K.series,H)}var L={pageX:N.pageX,pageY:N.pageY};s.trigger(H,[L,K])}function Aq(I,G){if(typeof I=="number"){I=series[I]}var H=Al(I);if(H==-1){r.push({series:I,auto:G});Am.triggerRedrawOverlay()}else{if(!G){r[H].auto=false}}}function o(H){if(H==null){r=[];Am.triggerRedrawOverlay()}if(typeof H=="number"){H=series[H]}var G=Al(H);if(G!=-1){r.splice(G,1);Am.triggerRedrawOverlay()}}function Al(G){for(var I=0;I<r.length;++I){var H=r[I];if(H.series==G){return I}}return -1}function Ap(H,J){var G=H.getOptions();var I=G.series.pie.radius>1?G.series.pie.radius:q*G.series.pie.radius;J.save();J.translate(A,Ai);J.scale(1,G.series.pie.tilt);for(i=0;i<r.length;++i){K(r[i].series)}w(J);J.restore();function K(L){if(L.angle<0){return}J.fillStyle="rgba(255, 255, 255, "+G.series.pie.highlight.opacity+")";J.beginPath();if(Math.abs(L.angle-Math.PI*2)>1e-09){J.moveTo(0,0)}J.arc(0,0,I,L.startAngle,L.startAngle+L.angle,false);J.closePath();J.fill()}}}var F={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(A,B){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+B.color+';">'+A+"<br/>"+Math.round(B.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};E.plot.plugins.push({init:D,options:F,name:"pie",version:"1.0"})})(jQuery);