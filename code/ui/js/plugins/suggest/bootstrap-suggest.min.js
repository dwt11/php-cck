!function(C){C.fn.bsSuggest=function(A){return"string"==typeof A&&D[A]?D[A].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof A&&A?void 0:D.init.apply(this,arguments)};var D={init:function(V){function W(F,H){var I,G,E;return -1===H.indexId&&!H.idField||H.multiWord?F:(I=F.css("background-color").replace(/ /g,"").split(",",3).join(","),G="rgba(255,255,255,0.1)",E=H.inputWarnColor||"rgba(255,255,0,0.1)",!F.val()||F.attr("data-id")?F.css("background",G):(-1===E.indexOf(I)&&(F.trigger("onUnsetSelectValue"),F.css("background",E)),F))}function X(F,H){var I,G,E=F.parent().find("tbody tr."+h.listHoverCSS);E.length>0&&(I=(E.index()+3)*E.height(),G=Number(H.css("max-height").replace("px","")),H.scrollTop(I>G||H.scrollTop()>G?I-G:0))}function Y(F,E){F=F||$dropdownMenu,E=E||h,F.find("tr."+E.listHoverCSS).removeClass(E.listHoverCSS)}function A(G){var H=C(G),F=H.parent(".input-group").find("ul.dropdown-menu"),E=H.data("bsSuggest");return 0===F.length?!1:E?!1:(H.data("bsSuggest",{target:G,options:h}),!0)}function B(I,J,F,N){var G,E,K,O,L,M,H,P={value:[]};if(I=I||"",N=N||h,N.url){L=-1!==N.url.indexOf("?")?"&":"?",M=N.jsonp?[N.url+I,L,N.jsonp,"=?"].join(""):N.url+I,C.ajax({type:"GET",url:M,dataType:"json",timeout:3000}).done(function(Q){F(J,Q,N),J.trigger("onDataRequestSuccess",Q),"firstByUrl"===h.getDataMethod&&(h.data=Q,h.url=null)}).fail(l)}else{if(G=N.data,E=a(G)){if(I){for(H=G.value.length,K=0;H>K;K++){for(O in G.value[K]){if(C.trim(G.value[K][O])&&(c(O,N)||b(O,N))&&(-1!==G.value[K][O].toString().indexOf(I)||-1!==I.indexOf(G.value[K][O]))){P.value.push(G.value[K]);break}}}}else{P=G}}F(J,P,N)}}function Z(E){return validData=a(E)}function a(G){var F=!0;for(var E in G){if("value"===E){F=!1;break}}return F?(l("返回数据格式错误!"),!1):0===G.value.length?!1:G}function b(E,F){return F=F||h,C.isArray(F.effectiveFields)&&F.effectiveFields.length>0&&-1===C.inArray(E,F.effectiveFields)?!1:!0}function c(E,F){return -1!==C.inArray(E,F.searchFields)?!0:!1}function d(E,O,G){var I,P,F,H,K,J,M,L=E.parent().find("ul.dropdown-menu"),N=0,Q=['<table class="table table-condensed">'];if(G=G||h,O=Z(O),O===!1||0===(I=O.value.length)){return L.empty().hide(),E}if(G.showHeader){H="<thead><tr>";for(F in O.value[0]){b(F)!==!1&&(H+=0===N?"<th>"+(G.effectiveFieldsAlias[F]||F)+"("+I+")</th>":"<th>"+(G.effectiveFieldsAlias[F]||F)+"</th>",N++)}H+="</tr></thead>",Q.push(H)}for(Q.push("<tbody>"),P=0;I>P;P++){N=0,K="",J=O.value[P][G.idField]||"",M=O.value[P][G.keyField]||"";for(F in O.value[P]){M||G.indexKey!==N||(M=O.value[P][F]),J||G.indexId!==N||(J=O.value[P][F]),N++,b(F)!==!1&&(K+='<td data-name="'+F+'">'+O.value[P][F]+"</td>")}K='<tr data-index="'+P+'" data-id="'+J+'" data-key="'+M+'">'+K+"</tr>",Q.push(K)}return Q.push("</tbody></table>"),L.html(Q.join("")).show(),e(E,L,G),L.css("max-height")&&Number(L.css("max-height").replace("px",""))<Number(L.find("table:eq(0)").css("height").replace("px",""))&&Number(L.css("min-width").replace("px",""))<Number(L.css("width").replace("px",""))?L.css("padding-right","20px").find("table:eq(0)").css("margin-bottom","20px"):L.css("padding-right",0).find("table:eq(0)").css("margin-bottom",0),E}function e(G,F,E){F=F||$dropdownMenu,E=E||h,F.find("tbody tr").each(function(){C(this).off("mouseenter").on("mouseenter",function(){Y(F,E),C(this).addClass(E.listHoverCSS)}).off("mousedown").on("mousedown",function(){g(G,f(C(this)),E),W(G,E)})})}function f(F){var E={};return E.id=F.attr("data-id"),E.key=F.attr("data-key"),E}function g(E,K,H){var J,I=K||{},F=I.id||"",G=I.key||"";H&&H.multiWord?(J=E.val().split(H.separator||" "),J[J.length-1]=G,E.val(J.join(H.separator||" ")).focus()):E.attr("data-id",F).focus().val(G),E.trigger("onSetSelectValue",I)}function l(F,E){console.log(F),E&&console.log(E)}var i=this,h=C.extend({url:null,jsonp:null,data:{},getDataMethod:"firstByUrl",indexId:0,indexKey:0,idField:"",keyField:"",effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],showHeader:!1,showBtn:!0,allowNoKeyword:!0,multiWord:!1,separator:",",processData:Z,getData:B,autoMinWidth:!1,listAlign:"left",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.5s","-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s"},listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13},V);if(C.isFunction(h.processData)&&(Z=h.processData),C.isFunction(h.getData)&&(B=h.getData),!V.showHeader&&h.effectiveFields&&h.effectiveFields.length>1&&(h.showHeader=!0),"firstByUrl"===h.getDataMethod&&h.url){var k=-1!==V.url.indexOf("?")?"&":"?",j=V.jsonp?[V.url,k,V.jsonp,"=?"].join(""):V.url;C.ajax({type:"GET",url:j,dataType:"json",timeout:5000}).done(function(E){h.data=E,h.url=null,C(i).trigger("onDataRequestSuccess",E)}).fail(function(F,E){throw new Error(j+" : "+E)})}return C("head:eq(0)").append("<style>."+h.listHoverCSS+"{"+h.listHoverStyle+"}</style>"),i.each(function(){var E=C(this),F=E.parents(".input-group:eq(0)").find("ul.dropdown-menu");return A(this)===!1?void console.warn("not a dropdown-menu"):(h.showBtn||E.parents(".input-group:eq(0)").css("width","100%").find(".input-group-btn>.btn.dropdown-toggle").hide(),E.removeClass("disabled").attr("disabled",!1).attr("autocomplete","off"),F.css(h.listStyle||{"max-height":"300px","max-width":"800px",overflow:"auto"}),h.autoMinWidth===!1?F.css({"min-width":E.parent().width()}):F.css("width","auto"),"left"===h.listAlign?F.css({left:E.siblings("div").width()-E.parent().width(),right:"auto"}):"right"===h.listAlign&&F.css({left:"auto",right:"0"}),E.on("keydown",function(H){var I,G="";"none"!==F.css("display")&&(I=F.find("."+h.listHoverCSS),G="",H.keyCode===h.keyDown?(0===I.length?G=f(F.find("table tbody tr:first").mouseover()):0===I.next().length?(Y(F,h),C(this).val(C(this).attr("alt")).attr("data-id","")):(Y(F,h),0!==I.next().length&&(G=f(I.next().mouseover()))),X(E,F)):H.keyCode===h.keyUp?(0===I.length?G=f(F.find("table tbody tr:last").mouseover()):0===I.prev().length?(Y(F,h),C(this).val(C(this).attr("alt")).attr("data-id","")):(Y(F,h),0!==I.prev().length&&(G=f(I.prev().mouseover()))),X(E,F)):H.keyCode===h.keyEnter?F.hide().empty():C(this).attr("data-id",""),G&&""!==G.key&&g(C(this),G,h))}).on("keyup",function(H){var I,G;return H.keyCode===h.keyDown||H.keyCode===h.keyUp||H.keyCode===h.keyEnter?(C(this).val(C(this).val()),void W(E,h)):(C(this).attr("data-id",""),W(E,h),I=C(this).val(),void ((""===C.trim(I)||I!==C(this).attr("alt"))&&(C(this).attr("alt",C(this).val()),V.multiWord&&(G=I.split(h.separator||" "),I=G[G.length-1]),(0!==I.length||h.allowNoKeyword)&&B(C.trim(I),E,d,h))))}).on("focus",function(){}).on("blur",function(){F.css("display",""),-1===V.indexId&&!V.idField||V.multiWord}).on("click",function(){var G,H=C(this).val();return""!==C.trim(H)&&H===C(this).attr("alt")&&F.find("table tr").length?F.show():void ("none"===F.css("display")&&(h.multiWord&&(G=H.split(h.separator||" "),H=G[G.length-1]),(0!==H.length||h.allowNoKeyword)&&B(C.trim(H),E,d,h)))}),E.parent().find("button:eq(0)").attr("data-toggle","").on("click",function(){var G;"none"===F.css("display")?(G="block",h.url?E.click().focus():d(E,h.data,h)):G="none",F.css("display",G)}),void F.on("mouseenter",function(){E.blur(),C(this).show()}).on("mouseleave",function(){E.focus()}))})},show:function(){var A=this.data("bsSuggest");return A&&A.options&&this.parent().find("ul.dropdown-menu").show(),this},hide:function(){var A=this.data("bsSuggest");return A&&A.options&&this.parent().find("ul.dropdown-menu").css("display",""),this},disable:function(){return C(this).data("bsSuggest")?void C(this).attr("disabled",!0).parent().find(".input-group-btn>.btn").addClass("disabled"):!1},enable:function(){return C(this).data("bsSuggest")?void C(this).attr("disabled",!1).parent().find(".input-group-btn>.btn").removeClass("disabled"):!1},destroy:function(){C(this).off().removeData("bsSuggest").parent().find(".input-group-btn>.btn").off()}}}(window.jQuery);