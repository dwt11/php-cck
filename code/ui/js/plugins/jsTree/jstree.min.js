(function(B){if(typeof define==="function"&&define.amd){define(["jquery"],B)}else{if(typeof module!=="undefined"&&module.exports){module.exports=B(require("jquery"))}else{B(jQuery)}}}(function(S,R){if(S.jstree){}var U=0,X=false,c=false,b=false,f=[],W=S("script:last").attr("src"),V=window.document,Y=V.createElement("LI"),T,Z;Y.setAttribute("role","treeitem");T=V.createElement("I");T.className="jstree-icon jstree-ocl";T.setAttribute("role","presentation");Y.appendChild(T);T=V.createElement("A");T.className="jstree-anchor";T.setAttribute("href","#");T.setAttribute("tabindex","-1");Z=V.createElement("I");Z.className="jstree-icon jstree-themeicon";Z.setAttribute("role","presentation");T.appendChild(Z);Y.appendChild(T);T=Z=null;S.jstree={version:"4.0.0",defaults:{plugins:[]},plugins:{},path:W&&W.indexOf("/")!==-1?W.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"};S.jstree.create=function(A,C){var B=new S.jstree.core(++U),D=C;C=S.extend(true,{},S.jstree.defaults,C);if(D&&D.plugins){C.plugins=D.plugins}S.each(C.plugins,function(E,F){if(E!=="core"){B=B.plugin(F,C[F])}});S(A).data("jstree",B);B.init(A,C);return B};S.jstree.destroy=function(){S(".jstree:jstree").jstree("destroy");S(V).off(".jstree")};S.jstree.core=function(A){this._id=A;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:false,dots:false,icons:false},selected:[],last_error:{},working:false,worker_queue:[],focused:null}}};S.jstree.reference=function(A){var B=null,C=null;if(A&&A.id&&(!A.tagName||!A.nodeType)){A=A.id}if(!C||!C.length){try{C=S(A)}catch(D){}}if(!C||!C.length){try{C=S("#"+A.replace(S.jstree.idregex,"\\$&"))}catch(D){}}if(C&&C.length&&(C=C.closest(".jstree")).length&&(C=C.data("jstree"))){B=C}else{S(".jstree").each(function(){var E=S(this).data("jstree");if(E&&E._model.data[A]){B=E;return false}})}return B};S.fn.jstree=function(B){var C=(typeof B==="string"),D=Array.prototype.slice.call(arguments,1),A=null;if(B===true&&!this.length){return false}this.each(function(){var E=S.jstree.reference(this),F=C&&E?E[B]:null;A=C&&F?F.apply(E,D):null;if(!E&&!C&&(B===R||S.isPlainObject(B))){S.jstree.create(this,B)}if((E&&!C)||B===true){A=E||false}if(A!==null&&A!==R){return false}});return A!==null&&A!==R?A:this};S.expr[":"].jstree=S.expr.createPseudo(function(A){return function(B){return S(B).hasClass("jstree")&&S(B).data("jstree")!==R}});S.jstree.defaults.core={data:false,strings:false,check_callback:false,error:S.noop,animation:200,multiple:true,themes:{name:false,url:false,dir:false,dots:true,icons:true,stripes:false,variant:false,responsive:false},expand_selected_onload:true,worker:true,force_text:false,dblclick_toggle:true};S.jstree.core.prototype={plugin:function(C,A){var B=S.jstree.plugins[C];if(B){this._data[C]={};B.prototype=this;return new B(A,this)}return this},init:function(A,B){this._model={data:{},changed:[],force_full_redraw:false,redraw_timeout:false,default_state:{loaded:true,opened:false,selected:false,disabled:false}};this._model.data[S.jstree.root]={id:S.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:false}};this.element=S(A).addClass("jstree jstree-"+this._id);this.settings=B;this._data.core.ready=false;this._data.core.loaded=false;this._data.core.rtl=(this.element.css("direction")==="rtl");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");if(this.settings.core.multiple){this.element.attr("aria-multiselectable",true)}if(!this.element.attr("tabindex")){this.element.attr("tabindex","0")}this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(true);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("加载中 ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||24;this.trigger("loading");this.load_node(S.jstree.root)},destroy:function(B){if(this._wrk){try{window.URL.revokeObjectURL(this._wrk);this._wrk=null}catch(A){}}if(!B){this.element.empty()}this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var C="",A=null,B=0;this.element.on("dblclick.jstree",function(F){if(F.target.tagName&&F.target.tagName.toLowerCase()==="input"){return true}if(V.selection&&V.selection.empty){V.selection.empty()}else{if(window.getSelection){var E=window.getSelection();try{E.removeAllRanges();E.collapse()}catch(D){}}}}).on("mousedown.jstree",S.proxy(function(D){if(D.target===this.element[0]){D.preventDefault();B=+(new Date())}},this)).on("mousedown.jstree",".jstree-ocl",function(D){D.preventDefault()}).on("click.jstree",".jstree-ocl",S.proxy(function(D){this.toggle_node(D.target)},this)).on("dblclick.jstree",".jstree-anchor",S.proxy(function(D){if(D.target.tagName&&D.target.tagName.toLowerCase()==="input"){return true}if(this.settings.core.dblclick_toggle){this.toggle_node(D.target)}},this)).on("click.jstree",".jstree-anchor",S.proxy(function(D){D.preventDefault();if(D.currentTarget!==V.activeElement){S(D.currentTarget).focus()}this.activate_node(D.currentTarget,D)},this)).on("keydown.jstree",".jstree-anchor",S.proxy(function(E){if(E.target.tagName&&E.target.tagName.toLowerCase()==="input"){return true}if(E.which!==32&&E.which!==13&&(E.shiftKey||E.ctrlKey||E.altKey||E.metaKey)){return true}var D=null;if(this._data.core.rtl){if(E.which===37){E.which=39}else{if(E.which===39){E.which=37}}}switch(E.which){case 32:if(E.ctrlKey){E.type="click";S(E.currentTarget).trigger(E)}break;case 13:E.type="click";S(E.currentTarget).trigger(E);break;case 37:E.preventDefault();if(this.is_open(E.currentTarget)){this.close_node(E.currentTarget)}else{D=this.get_parent(E.currentTarget);if(D&&D.id!==S.jstree.root){this.get_node(D,true).children(".jstree-anchor").focus()}}break;case 38:E.preventDefault();D=this.get_prev_dom(E.currentTarget);if(D&&D.length){D.children(".jstree-anchor").focus()}break;case 39:E.preventDefault();if(this.is_closed(E.currentTarget)){this.open_node(E.currentTarget,function(F){this.get_node(F,true).children(".jstree-anchor").focus()})}else{if(this.is_open(E.currentTarget)){D=this.get_node(E.currentTarget,true).children(".jstree-children")[0];if(D){S(this._firstChild(D)).children(".jstree-anchor").focus()}}}break;case 40:E.preventDefault();D=this.get_next_dom(E.currentTarget);if(D&&D.length){D.children(".jstree-anchor").focus()}break;case 106:this.open_all();break;case 36:E.preventDefault();D=this._firstChild(this.get_container_ul()[0]);if(D){S(D).children(".jstree-anchor").filter(":visible").focus()}break;case 35:E.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus();break}},this)).on("load_node.jstree",S.proxy(function(E,D){if(D.status){if(D.node.id===S.jstree.root&&!this._data.core.loaded){this._data.core.loaded=true;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.trigger("loaded")}if(!this._data.core.ready){setTimeout(S.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=true;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var G=[],F,H;for(F=0,H=this._data.core.selected.length;F<H;F++){G=G.concat(this._model.data[this._data.core.selected[F]].parents)}G=S.vakata.array_unique(G);for(F=0,H=G.length;F<H;F++){this.open_node(G[F],false,0)}}this.trigger("changed",{"action":"ready","selected":this._data.core.selected})}this.trigger("ready")}},this),0)}}},this)).on("keypress.jstree",S.proxy(function(H){if(H.target.tagName&&H.target.tagName.toLowerCase()==="input"){return true}if(A){clearTimeout(A)}A=setTimeout(function(){C=""},500);var F=String.fromCharCode(H.which).toLowerCase(),E=this.element.find(".jstree-anchor").filter(":visible"),D=E.index(V.activeElement)||0,G=false;C+=F;if(C.length>1){E.slice(D).each(S.proxy(function(I,J){if(S(J).text().toLowerCase().indexOf(C)===0){S(J).focus();G=true;return false}},this));if(G){return}E.slice(0,D).each(S.proxy(function(I,J){if(S(J).text().toLowerCase().indexOf(C)===0){S(J).focus();G=true;return false}},this));if(G){return}}if(new RegExp("^"+F.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(C)){E.slice(D+1).each(S.proxy(function(I,J){if(S(J).text().toLowerCase().charAt(0)===F){S(J).focus();G=true;return false}},this));if(G){return}E.slice(0,D+1).each(S.proxy(function(I,J){if(S(J).text().toLowerCase().charAt(0)===F){S(J).focus();G=true;return false}},this));if(G){return}}},this)).on("init.jstree",S.proxy(function(){var D=this.settings.core.themes;this._data.core.themes.dots=D.dots;this._data.core.themes.stripes=D.stripes;this._data.core.themes.icons=D.icons;this.set_theme(D.name||"default",D.url);this.set_theme_variant(D.variant)},this)).on("loading.jstree",S.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",S.proxy(function(D){this._data.core.focused=null;S(D.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",S.proxy(function(D){var E=this.get_node(D.currentTarget);if(E&&E.id){this._data.core.focused=E.id}this.element.find(".jstree-hovered").not(D.currentTarget).mouseleave();S(D.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",S.proxy(function(){if(+(new Date())-B>500&&!this._data.core.focused){B=0;var D=this.get_node(this.element.attr("aria-activedescendant"),true);if(D){D.find("> .jstree-anchor").focus()}}},this)).on("mouseenter.jstree",".jstree-anchor",S.proxy(function(D){this.hover_node(D.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",S.proxy(function(D){this.dehover_node(D.currentTarget)},this))},unbind:function(){this.element.off(".jstree");S(V).off(".jstree-"+this._id)},trigger:function(A,B){if(!B){B={}}B.instance=this;this.element.triggerHandler(A.replace(".jstree","")+".jstree",B)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(A){var B=this.settings.core.strings;if(S.isFunction(B)){return B.call(this,A)}if(B&&B[A]){return B[A]}return A},_firstChild:function(A){A=A?A.firstChild:null;while(A!==null&&A.nodeType!==1){A=A.nextSibling}return A},_nextSibling:function(A){A=A?A.nextSibling:null;while(A!==null&&A.nodeType!==1){A=A.nextSibling}return A},_previousSibling:function(A){A=A?A.previousSibling:null;while(A!==null&&A.nodeType!==1){A=A.previousSibling}return A},get_node:function(B,A){if(B&&B.id){B=B.id}var D;try{if(this._model.data[B]){B=this._model.data[B]}else{if(typeof B==="string"&&this._model.data[B.replace(/^#/,"")]){B=this._model.data[B.replace(/^#/,"")]}else{if(typeof B==="string"&&(D=S("#"+B.replace(S.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[D.closest(".jstree-node").attr("id")]){B=this._model.data[D.closest(".jstree-node").attr("id")]}else{if((D=S(B,this.element)).length&&this._model.data[D.closest(".jstree-node").attr("id")]){B=this._model.data[D.closest(".jstree-node").attr("id")]}else{if((D=S(B,this.element)).length&&D.hasClass("jstree")){B=this._model.data[S.jstree.root]}else{return false}}}}}if(A){B=B.id===S.jstree.root?this.element:S("#"+B.id.replace(S.jstree.idregex,"\\$&"),this.element)}return B}catch(C){return false}},get_path:function(B,F,C){B=B.parents?B:this.get_node(B);if(!B||B.id===S.jstree.root||!B.parents){return false}var A,D,E=[];E.push(C?B.id:B.text);for(A=0,D=B.parents.length;A<D;A++){E.push(C?B.parents[A]:this.get_text(B.parents[A]))}E=E.reverse().slice(1);return F?E.join(F):E},get_next_dom:function(B,C){var A;B=this.get_node(B,true);if(B[0]===this.element[0]){A=this._firstChild(this.get_container_ul()[0]);while(A&&A.offsetHeight===0){A=this._nextSibling(A)}return A?S(A):false}if(!B||!B.length){return false}if(C){A=B[0];do{A=this._nextSibling(A)}while(A&&A.offsetHeight===0);return A?S(A):false}if(B.hasClass("jstree-open")){A=this._firstChild(B.children(".jstree-children")[0]);while(A&&A.offsetHeight===0){A=this._nextSibling(A)}if(A!==null){return S(A)}}A=B[0];do{A=this._nextSibling(A)}while(A&&A.offsetHeight===0);if(A!==null){return S(A)}return B.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(B,C){var A;B=this.get_node(B,true);if(B[0]===this.element[0]){A=this.get_container_ul()[0].lastChild;while(A&&A.offsetHeight===0){A=this._previousSibling(A)}return A?S(A):false}if(!B||!B.length){return false}if(C){A=B[0];do{A=this._previousSibling(A)}while(A&&A.offsetHeight===0);return A?S(A):false}A=B[0];do{A=this._previousSibling(A)}while(A&&A.offsetHeight===0);if(A!==null){B=S(A);while(B.hasClass("jstree-open")){B=B.children(".jstree-children").first().children(".jstree-node:visible:last")}return B}A=B[0].parentNode.parentNode;return A&&A.className&&A.className.indexOf("jstree-node")!==-1?S(A):false},get_parent:function(A){A=this.get_node(A);if(!A||A.id===S.jstree.root){return false}return A.parent},get_children_dom:function(A){A=this.get_node(A,true);if(A[0]===this.element[0]){return this.get_container_ul().children(".jstree-node")}if(!A||!A.length){return false}return A.children(".jstree-children").children(".jstree-node")},is_parent:function(A){A=this.get_node(A);return A&&(A.state.loaded===false||A.children.length>0)},is_loaded:function(A){A=this.get_node(A);return A&&A.state.loaded},is_loading:function(A){A=this.get_node(A);return A&&A.state&&A.state.loading},is_open:function(A){A=this.get_node(A);return A&&A.state.opened},is_closed:function(A){A=this.get_node(A);return A&&this.is_parent(A)&&!A.state.opened},is_leaf:function(A){return !this.is_parent(A)},load_node:function(F,A){var E,G,B,D,C;if(S.isArray(F)){this._load_nodes(F.slice(),A);return true}F=this.get_node(F);if(!F){if(A){A.call(this,F,false)}return false}if(F.state.loaded){F.state.loaded=false;for(E=0,G=F.children_d.length;E<G;E++){for(B=0,D=F.parents.length;B<D;B++){this._model.data[F.parents[B]].children_d=S.vakata.array_remove_item(this._model.data[F.parents[B]].children_d,F.children_d[E])}if(this._model.data[F.children_d[E]].state.selected){C=true;this._data.core.selected=S.vakata.array_remove_item(this._data.core.selected,F.children_d[E])}delete this._model.data[F.children_d[E]]}F.children=[];F.children_d=[];if(C){this.trigger("changed",{"action":"load_node","node":F,"selected":this._data.core.selected})}}F.state.failed=false;F.state.loading=true;this.get_node(F,true).addClass("jstree-loading").attr("aria-busy",true);this._load_node(F,S.proxy(function(M){F=this._model.data[F.id];F.state.loading=false;F.state.loaded=M;F.state.failed=!F.state.loaded;var L=this.get_node(F,true),I=0,H=0,J=this._model.data,K=false;for(I=0,H=F.children.length;I<H;I++){if(J[F.children[I]]&&!J[F.children[I]].state.hidden){K=true;break}}if(F.state.loaded&&!K&&L&&L.length&&!L.hasClass("jstree-leaf")){L.removeClass("jstree-closed jstree-open").addClass("jstree-leaf")}L.removeClass("jstree-loading").attr("aria-busy",false);this.trigger("load_node",{"node":F,"status":M});if(A){A.call(this,F,M)}},this));return true},_load_nodes:function(A,E,C){var D=true,B=function(){this._load_nodes(A,E,true)},G=this._model.data,F,H,I=[];for(F=0,H=A.length;F<H;F++){if(G[A[F]]&&((!G[A[F]].state.loaded&&!G[A[F]].state.failed)||!C)){if(!this.is_loading(A[F])){this.load_node(A[F],B)}D=false}}if(D){for(F=0,H=A.length;F<H;F++){if(G[A[F]]&&G[A[F]].state.loaded){I.push(A[F])}}if(E&&!E.done){E.call(this,I);E.done=true}}},load_all:function(F,A){if(!F){F=S.jstree.root}F=this.get_node(F);if(!F){return false}var B=[],D=this._model.data,E=D[F.id].children_d,G,C;if(F.state&&!F.state.loaded){B.push(F.id)}for(G=0,C=E.length;G<C;G++){if(D[E[G]]&&D[E[G]].state&&!D[E[G]].state.loaded){B.push(E[G])}}if(B.length){this._load_nodes(B,function(){this.load_all(F,A)})}else{if(A){A.call(this,F)}this.trigger("load_all",{"node":F})}},_load_node:function(B,A){var C=this.settings.core.data,D;if(!C){if(B.id===S.jstree.root){return this._append_html_data(B,this._data.core.original_container_html.clone(true),function(E){A.call(this,E)})}else{return A.call(this,false)}}if(S.isFunction(C)){return C.call(this,B,S.proxy(function(E){if(E===false){A.call(this,false)}this[typeof E==="string"?"_append_html_data":"_append_json_data"](B,typeof E==="string"?S(S.parseHTML(E)).filter(function(){return this.nodeType!==3}):E,function(F){A.call(this,F)})},this))}if(typeof C==="object"){if(C.url){C=S.extend(true,{},C);if(S.isFunction(C.url)){C.url=C.url.call(this,B)}if(S.isFunction(C.data)){C.data=C.data.call(this,B)}return S.ajax(C).done(S.proxy(function(G,H,F){var E=F.getResponseHeader("Content-Type");if((E&&E.indexOf("json")!==-1)||typeof G==="object"){return this._append_json_data(B,G,function(I){A.call(this,I)})}if((E&&E.indexOf("html")!==-1)||typeof G==="string"){return this._append_html_data(B,S(S.parseHTML(G)).filter(function(){return this.nodeType!==3}),function(I){A.call(this,I)})}this._data.core.last_error={"error":"ajax","plugin":"core","id":"core_04","reason":"Could not load node","data":JSON.stringify({"id":B.id,"xhr":F})};this.settings.core.error.call(this,this._data.core.last_error);return A.call(this,false)},this)).fail(S.proxy(function(E){A.call(this,false);this._data.core.last_error={"error":"ajax","plugin":"core","id":"core_04","reason":"Could not load node","data":JSON.stringify({"id":B.id,"xhr":E})};this.settings.core.error.call(this,this._data.core.last_error)},this))}D=(S.isArray(C)||S.isPlainObject(C))?JSON.parse(JSON.stringify(C)):C;if(B.id===S.jstree.root){return this._append_json_data(B,D,function(E){A.call(this,E)})}else{this._data.core.last_error={"error":"nodata","plugin":"core","id":"core_05","reason":"Could not load node","data":JSON.stringify({"id":B.id})};this.settings.core.error.call(this,this._data.core.last_error);return A.call(this,false)}}if(typeof C==="string"){if(B.id===S.jstree.root){return this._append_html_data(B,S(S.parseHTML(C)).filter(function(){return this.nodeType!==3}),function(E){A.call(this,E)})}else{this._data.core.last_error={"error":"nodata","plugin":"core","id":"core_06","reason":"Could not load node","data":JSON.stringify({"id":B.id})};this.settings.core.error.call(this,this._data.core.last_error);return A.call(this,false)}}return A.call(this,false)},_node_changed:function(A){A=this.get_node(A);if(A){this._model.changed.push(A.id)}},_append_html_data:function(M,L,K){M=this.get_node(M);M.children=[];M.children_d=[];var G=L.is("ul")?L.children():L,J=M.id,B=[],I=[],H=this._model.data,F=H[J],E=this._data.core.selected.length,D,A,C;G.each(S.proxy(function(N,O){D=this._parse_model_from_html(S(O),J,F.parents.concat());if(D){B.push(D);I.push(D);if(H[D].children_d.length){I=I.concat(H[D].children_d)}}},this));F.children=B;F.children_d=I;for(A=0,C=F.parents.length;A<C;A++){H[F.parents[A]].children_d=H[F.parents[A]].children_d.concat(I)}this.trigger("model",{"nodes":I,"parent":J});if(J!==S.jstree.root){this._node_changed(J);this.redraw()}else{this.get_container_ul().children(".jstree-initial-node").remove();this.redraw(true)}if(this._data.core.selected.length!==E){this.trigger("changed",{"action":"model","selected":this._data.core.selected})}K.call(this,true)},_append_json_data:function(C,I,H,D){if(this.element===null){return}C=this.get_node(C);C.children=[];C.children_d=[];if(I.d){I=I.d;if(typeof I==="string"){I=JSON.parse(I)}}if(!S.isArray(I)){I=[I]}var F=null,E={"df":this._model.default_state,"dat":I,"par":C.id,"m":this._model.data,"t_id":this._id,"t_cnt":this._cnt,"sel":this._data.core.selected},A=function(O,N){if(O.data){O=O.data}var M=O.dat,L=O.par,Ab=[],y=[],K=[],P=O.df,j=O.t_id,p=O.t_cnt,i=O.m,z=i[L],J=O.sel,x,Aa,Ad,Ac,m=function(l,r,n){if(!n){n=[]}else{n=n.concat()}if(r){n.unshift(r)}var o=l.id.toString(),t,s,k,q,u={id:o,text:l.text||"",icon:l.icon!==N?l.icon:true,parent:r,parents:n,children:l.children||[],children_d:l.children_d||[],data:l.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(t in P){if(P.hasOwnProperty(t)){u.state[t]=P[t]}}if(l&&l.data&&l.data.jstree&&l.data.jstree.icon){u.icon=l.data.jstree.icon}if(u.icon===N||u.icon===null||u.icon===""){u.icon=true}if(l&&l.data){u.data=l.data;if(l.data.jstree){for(t in l.data.jstree){if(l.data.jstree.hasOwnProperty(t)){u.state[t]=l.data.jstree[t]}}}}if(l&&typeof l.state==="object"){for(t in l.state){if(l.state.hasOwnProperty(t)){u.state[t]=l.state[t]}}}if(l&&typeof l.li_attr==="object"){for(t in l.li_attr){if(l.li_attr.hasOwnProperty(t)){u.li_attr[t]=l.li_attr[t]}}}if(!u.li_attr.id){u.li_attr.id=o}if(l&&typeof l.a_attr==="object"){for(t in l.a_attr){if(l.a_attr.hasOwnProperty(t)){u.a_attr[t]=l.a_attr[t]}}}if(l&&l.children&&l.children===true){u.state.loaded=false;u.children=[];u.children_d=[]}i[u.id]=u;for(t=0,s=u.children.length;t<s;t++){k=m(i[u.children[t]],u.id,n);q=i[k];u.children_d.push(k);if(q.children_d.length){u.children_d=u.children_d.concat(q.children_d)}}delete l.data;delete l.children;i[u.id].original=l;if(u.state.selected){K.push(u.id)}return u.id},Q=function(l,r,n){if(!n){n=[]}else{n=n.concat()}if(r){n.unshift(r)}var o=false,t,s,k,q,u;do{o="j"+j+"_"+(++p)}while(i[o]);u={id:false,text:typeof l==="string"?l:"",icon:typeof l==="object"&&l.icon!==N?l.icon:true,parent:r,parents:n,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(t in P){if(P.hasOwnProperty(t)){u.state[t]=P[t]}}if(l&&l.id){u.id=l.id.toString()}if(l&&l.text){u.text=l.text}if(l&&l.data&&l.data.jstree&&l.data.jstree.icon){u.icon=l.data.jstree.icon}if(u.icon===N||u.icon===null||u.icon===""){u.icon=true}if(l&&l.data){u.data=l.data;if(l.data.jstree){for(t in l.data.jstree){if(l.data.jstree.hasOwnProperty(t)){u.state[t]=l.data.jstree[t]}}}}if(l&&typeof l.state==="object"){for(t in l.state){if(l.state.hasOwnProperty(t)){u.state[t]=l.state[t]}}}if(l&&typeof l.li_attr==="object"){for(t in l.li_attr){if(l.li_attr.hasOwnProperty(t)){u.li_attr[t]=l.li_attr[t]}}}if(u.li_attr.id&&!u.id){u.id=u.li_attr.id.toString()}if(!u.id){u.id=o}if(!u.li_attr.id){u.li_attr.id=u.id}if(l&&typeof l.a_attr==="object"){for(t in l.a_attr){if(l.a_attr.hasOwnProperty(t)){u.a_attr[t]=l.a_attr[t]}}}if(l&&l.children&&l.children.length){for(t=0,s=l.children.length;t<s;t++){k=Q(l.children[t],u.id,n);q=i[k];u.children.push(k);if(q.children_d.length){u.children_d=u.children_d.concat(q.children_d)}}u.children_d=u.children_d.concat(u.children)}if(l&&l.children&&l.children===true){u.state.loaded=false;u.children=[];u.children_d=[]}delete l.data;delete l.children;u.original=l;i[u.id]=u;if(u.state.selected){K.push(u.id)}return u.id};if(M.length&&M[0].id!==N&&M[0].parent!==N){for(Aa=0,Ad=M.length;Aa<Ad;Aa++){if(!M[Aa].children){M[Aa].children=[]}i[M[Aa].id.toString()]=M[Aa]}for(Aa=0,Ad=M.length;Aa<Ad;Aa++){i[M[Aa].parent.toString()].children.push(M[Aa].id.toString());z.children_d.push(M[Aa].id.toString())}for(Aa=0,Ad=z.children.length;Aa<Ad;Aa++){x=m(i[z.children[Aa]],L,z.parents.concat());y.push(x);if(i[x].children_d.length){y=y.concat(i[x].children_d)}}for(Aa=0,Ad=z.parents.length;Aa<Ad;Aa++){i[z.parents[Aa]].children_d=i[z.parents[Aa]].children_d.concat(y)}Ac={"cnt":p,"mod":i,"sel":J,"par":L,"dpc":y,"add":K}}else{for(Aa=0,Ad=M.length;Aa<Ad;Aa++){x=Q(M[Aa],L,z.parents.concat());if(x){Ab.push(x);y.push(x);if(i[x].children_d.length){y=y.concat(i[x].children_d)}}}z.children=Ab;z.children_d=y;for(Aa=0,Ad=z.parents.length;Aa<Ad;Aa++){i[z.parents[Aa]].children_d=i[z.parents[Aa]].children_d.concat(y)}Ac={"cnt":p,"mod":i,"sel":J,"par":L,"dpc":y,"add":K}}if(typeof window==="undefined"||typeof window.document==="undefined"){postMessage(Ac)}else{return Ac}},B=function(O,K){if(this.element===null){return}this._cnt=O.cnt;this._model.data=O.mod;if(K){var J,Q,L=O.add,M=O.sel,N=this._data.core.selected.slice(),P=this._model.data;if(M.length!==N.length||S.vakata.array_unique(M.concat(N)).length!==M.length){for(J=0,Q=M.length;J<Q;J++){if(S.inArray(M[J],L)===-1&&S.inArray(M[J],N)===-1){P[M[J]].state.selected=false}}for(J=0,Q=N.length;J<Q;J++){if(S.inArray(N[J],M)===-1){P[N[J]].state.selected=true}}}}if(O.add.length){this._data.core.selected=this._data.core.selected.concat(O.add)}this.trigger("model",{"nodes":O.dpc,"parent":O.par});if(O.par!==S.jstree.root){this._node_changed(O.par);this.redraw()}else{this.redraw(true)}if(O.add.length){this.trigger("changed",{"action":"model","selected":this._data.core.selected})}H.call(this,true)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker){try{if(this._wrk===null){this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+A.toString()],{type:"text/javascript"}))}if(!this._data.core.working||D){this._data.core.working=true;F=new window.Worker(this._wrk);F.onmessage=S.proxy(function(K){B.call(this,K.data,true);try{F.terminate();F=null}catch(J){}if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}},this);if(!E.par){if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}else{F.postMessage(E)}}else{this._data.core.worker_queue.push([C,I,H,true])}}catch(G){B.call(this,A(E),false);if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}}else{B.call(this,A(E),false)}},_parse_model_from_html:function(H,F,G){if(!G){G=[]}else{G=[].concat(G)}if(F){G.unshift(F)}var D,E,C=this._model.data,I={id:false,text:false,icon:true,parent:F,parents:G,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false},J,A,B;for(J in this._model.default_state){if(this._model.default_state.hasOwnProperty(J)){I.state[J]=this._model.default_state[J]}}A=S.vakata.attributes(H,true);S.each(A,function(K,L){L=S.trim(L);if(!L.length){return true}I.li_attr[K]=L;if(K==="id"){I.id=L.toString()}});A=H.children("a").first();if(A.length){A=S.vakata.attributes(A,true);S.each(A,function(K,L){L=S.trim(L);if(L.length){I.a_attr[K]=L}})}A=H.children("a").first().length?H.children("a").first().clone():H.clone();A.children("ins, i, ul").remove();A=A.html();A=S("<div />").html(A);I.text=this.settings.core.force_text?A.text():A.html();A=H.data();I.data=A?S.extend(true,{},A):null;I.state.opened=H.hasClass("jstree-open");I.state.selected=H.children("a").hasClass("jstree-clicked");I.state.disabled=H.children("a").hasClass("jstree-disabled");if(I.data&&I.data.jstree){for(J in I.data.jstree){if(I.data.jstree.hasOwnProperty(J)){I.state[J]=I.data.jstree[J]}}}A=H.children("a").children(".jstree-themeicon");if(A.length){I.icon=A.hasClass("jstree-themeicon-hidden")?false:A.attr("rel")}if(I.state.icon!==R){I.icon=I.state.icon}if(I.icon===R||I.icon===null||I.icon===""){I.icon=true}A=H.children("ul").children("li");do{B="j"+this._id+"_"+(++this._cnt)}while(C[B]);I.id=I.li_attr.id?I.li_attr.id.toString():B;if(A.length){A.each(S.proxy(function(K,L){D=this._parse_model_from_html(S(L),I.id,G);E=this._model.data[D];I.children.push(D);if(E.children_d.length){I.children_d=I.children_d.concat(E.children_d)}},this));I.children_d=I.children_d.concat(I.children)}else{if(H.hasClass("jstree-closed")){I.state.loaded=false}}if(I.li_attr["class"]){I.li_attr["class"]=I.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")}if(I.a_attr["class"]){I.a_attr["class"]=I.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")}C[I.id]=I;if(I.state.selected){this._data.core.selected.push(I.id)}return I.id},_parse_model_from_flat_json:function(G,F,K){if(!K){K=[]}else{K=K.concat()}if(F){K.unshift(F)}var I=G.id.toString(),D=this._model.data,J=this._model.default_state,C,A,B,E,H={id:I,text:G.text||"",icon:G.icon!==R?G.icon:true,parent:F,parents:K,children:G.children||[],children_d:G.children_d||[],data:G.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(C in J){if(J.hasOwnProperty(C)){H.state[C]=J[C]}}if(G&&G.data&&G.data.jstree&&G.data.jstree.icon){H.icon=G.data.jstree.icon}if(H.icon===R||H.icon===null||H.icon===""){H.icon=true}if(G&&G.data){H.data=G.data;if(G.data.jstree){for(C in G.data.jstree){if(G.data.jstree.hasOwnProperty(C)){H.state[C]=G.data.jstree[C]}}}}if(G&&typeof G.state==="object"){for(C in G.state){if(G.state.hasOwnProperty(C)){H.state[C]=G.state[C]}}}if(G&&typeof G.li_attr==="object"){for(C in G.li_attr){if(G.li_attr.hasOwnProperty(C)){H.li_attr[C]=G.li_attr[C]}}}if(!H.li_attr.id){H.li_attr.id=I}if(G&&typeof G.a_attr==="object"){for(C in G.a_attr){if(G.a_attr.hasOwnProperty(C)){H.a_attr[C]=G.a_attr[C]}}}if(G&&G.children&&G.children===true){H.state.loaded=false;H.children=[];H.children_d=[]}D[H.id]=H;for(C=0,A=H.children.length;C<A;C++){B=this._parse_model_from_flat_json(D[H.children[C]],H.id,K);E=D[B];H.children_d.push(B);if(E.children_d.length){H.children_d=H.children_d.concat(E.children_d)}}delete G.data;delete G.children;D[H.id].original=G;if(H.state.selected){this._data.core.selected.push(H.id)}return H.id},_parse_model_from_json:function(G,F,A){if(!A){A=[]}else{A=A.concat()}if(F){A.unshift(F)}var I=false,C,K,B,E,D=this._model.data,J=this._model.default_state,H;do{I="j"+this._id+"_"+(++this._cnt)}while(D[I]);H={id:false,text:typeof G==="string"?G:"",icon:typeof G==="object"&&G.icon!==R?G.icon:true,parent:F,parents:A,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(C in J){if(J.hasOwnProperty(C)){H.state[C]=J[C]}}if(G&&G.id){H.id=G.id.toString()}if(G&&G.text){H.text=G.text}if(G&&G.data&&G.data.jstree&&G.data.jstree.icon){H.icon=G.data.jstree.icon}if(H.icon===R||H.icon===null||H.icon===""){H.icon=true}if(G&&G.data){H.data=G.data;if(G.data.jstree){for(C in G.data.jstree){if(G.data.jstree.hasOwnProperty(C)){H.state[C]=G.data.jstree[C]}}}}if(G&&typeof G.state==="object"){for(C in G.state){if(G.state.hasOwnProperty(C)){H.state[C]=G.state[C]}}}if(G&&typeof G.li_attr==="object"){for(C in G.li_attr){if(G.li_attr.hasOwnProperty(C)){H.li_attr[C]=G.li_attr[C]}}}if(H.li_attr.id&&!H.id){H.id=H.li_attr.id.toString()}if(!H.id){H.id=I}if(!H.li_attr.id){H.li_attr.id=H.id}if(G&&typeof G.a_attr==="object"){for(C in G.a_attr){if(G.a_attr.hasOwnProperty(C)){H.a_attr[C]=G.a_attr[C]}}}if(G&&G.children&&G.children.length){for(C=0,K=G.children.length;C<K;C++){B=this._parse_model_from_json(G.children[C],H.id,A);E=D[B];H.children.push(B);if(E.children_d.length){H.children_d=H.children_d.concat(E.children_d)}}H.children_d=H.children_d.concat(H.children)}if(G&&G.children&&G.children===true){H.state.loaded=false;H.children=[];H.children_d=[]}delete G.data;delete G.children;H.original=G;D[H.id]=H;if(H.state.selected){this._data.core.selected.push(H.id)}return H.id},_redraw:function(){var F=this._model.force_full_redraw?this._model.data[S.jstree.root].children.concat([]):this._model.changed.concat([]),D=V.createElement("UL"),A,B,C,E=this._data.core.focused;for(B=0,C=F.length;B<C;B++){A=this.redraw_node(F[B],true,this._model.force_full_redraw);if(A&&this._model.force_full_redraw){D.appendChild(A)}}if(this._model.force_full_redraw){D.className=this.get_container_ul()[0].className;D.setAttribute("role","group");this.element.empty().append(D)}if(E!==null){A=this.get_node(E,true);if(A&&A.length&&A.children(".jstree-anchor")[0]!==V.activeElement){A.children(".jstree-anchor").focus()}else{this._data.core.focused=null}}this._model.force_full_redraw=false;this._model.changed=[];this.trigger("redraw",{"nodes":F})},redraw:function(A){if(A){this._model.force_full_redraw=true}this._redraw()},draw_children:function(F){var B=this.get_node(F),A=false,C=false,D=false,E=V;if(!B){return false}if(B.id===S.jstree.root){return this.redraw(true)}F=this.get_node(F,true);if(!F||!F.length){return false}F.children(".jstree-children").remove();F=F[0];if(B.children.length&&B.state.loaded){D=E.createElement("UL");D.setAttribute("role","group");D.className="jstree-children";for(A=0,C=B.children.length;A<C;A++){D.appendChild(this.redraw_node(B.children[A],true,true))}F.appendChild(D)}},redraw_node:function(E,D,A,I){var k=this.get_node(E),i=false,O=false,C=false,F=false,L=false,M=false,P="",G=V,B=this._model.data,N=false,J=false,K=null,Q=0,j=0,H=false,l=false;if(!k){return false}if(k.id===S.jstree.root){return this.redraw(true)}D=D||k.children.length===0;E=!V.querySelector?V.getElementById(k.id):this.element[0].querySelector("#"+("0123456789".indexOf(k.id[0])!==-1?"\\3"+k.id[0]+" "+k.id.substr(1).replace(S.jstree.idregex,"\\$&"):k.id.replace(S.jstree.idregex,"\\$&")));if(!E){D=true;if(!A){i=k.parent!==S.jstree.root?S("#"+k.parent.replace(S.jstree.idregex,"\\$&"),this.element)[0]:null;if(i!==null&&(!i||!B[k.parent].state.opened)){return false}O=S.inArray(k.id,i===null?B[S.jstree.root].children:B[k.parent].children)}}else{E=S(E);if(!A){i=E.parent().parent()[0];if(i===this.element[0]){i=null}O=E.index()}if(!D&&k.children.length&&!E.children(".jstree-children").length){D=true}if(!D){C=E.children(".jstree-children")[0]}N=E.children(".jstree-anchor")[0]===V.activeElement;E.remove()}E=Y.cloneNode(true);P="jstree-node ";for(F in k.li_attr){if(k.li_attr.hasOwnProperty(F)){if(F==="id"){continue}if(F!=="class"){E.setAttribute(F,k.li_attr[F])}else{P+=k.li_attr[F]}}}if(!k.a_attr.id){k.a_attr.id=k.id+"_anchor"}E.setAttribute("aria-selected",!!k.state.selected);E.setAttribute("aria-level",k.parents.length);E.setAttribute("aria-labelledby",k.a_attr.id);if(k.state.disabled){E.setAttribute("aria-disabled",true)}for(F=0,L=k.children.length;F<L;F++){if(!B[k.children[F]].state.hidden){H=true;break}}if(k.parent!==null&&B[k.parent]&&!k.state.hidden){F=S.inArray(k.id,B[k.parent].children);l=k.id;if(F!==-1){F++;for(L=B[k.parent].children.length;F<L;F++){if(!B[B[k.parent].children[F]].state.hidden){l=B[k.parent].children[F]}if(l!==k.id){break}}}}if(k.state.hidden){P+=" jstree-hidden"}if(k.state.loaded&&!H){P+=" jstree-leaf"}else{P+=k.state.opened&&k.state.loaded?" jstree-open":" jstree-closed";E.setAttribute("aria-expanded",(k.state.opened&&k.state.loaded))}if(l===k.id){P+=" jstree-last"}E.id=k.id;E.className=P;P=(k.state.selected?" jstree-clicked":"")+(k.state.disabled?" jstree-disabled":"");for(L in k.a_attr){if(k.a_attr.hasOwnProperty(L)){if(L==="href"&&k.a_attr[L]==="#"){continue}if(L!=="class"){E.childNodes[1].setAttribute(L,k.a_attr[L])}else{P+=" "+k.a_attr[L]}}}if(P.length){E.childNodes[1].className="jstree-anchor "+P}if((k.icon&&k.icon!==true)||k.icon===false){if(k.icon===false){E.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden"}else{if(k.icon.indexOf("/")===-1&&k.icon.indexOf(".")===-1){E.childNodes[1].childNodes[0].className+=" "+k.icon+" jstree-themeicon-custom"}else{E.childNodes[1].childNodes[0].style.backgroundImage="url("+k.icon+")";E.childNodes[1].childNodes[0].style.backgroundPosition="center center";E.childNodes[1].childNodes[0].style.backgroundSize="auto";E.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom"}}}if(this.settings.core.force_text){E.childNodes[1].appendChild(G.createTextNode(k.text))}else{E.childNodes[1].innerHTML+=k.text}if(D&&k.children.length&&(k.state.opened||I)&&k.state.loaded){M=G.createElement("UL");M.setAttribute("role","group");M.className="jstree-children";for(F=0,L=k.children.length;F<L;F++){M.appendChild(this.redraw_node(k.children[F],D,true))}E.appendChild(M)}if(C){E.appendChild(C)}if(!A){if(!i){i=this.element[0]}for(F=0,L=i.childNodes.length;F<L;F++){if(i.childNodes[F]&&i.childNodes[F].className&&i.childNodes[F].className.indexOf("jstree-children")!==-1){K=i.childNodes[F];break}}if(!K){K=G.createElement("UL");K.setAttribute("role","group");K.className="jstree-children";i.appendChild(K)}i=K;if(O<i.childNodes.length){i.insertBefore(E,i.childNodes[O])}else{i.appendChild(E)}if(N){Q=this.element[0].scrollTop;j=this.element[0].scrollLeft;E.childNodes[1].focus();this.element[0].scrollTop=Q;this.element[0].scrollLeft=j}}if(k.state.opened&&!k.state.loaded){k.state.opened=false;setTimeout(S.proxy(function(){this.open_node(k.id,false,0)},this),0)}return E},open_node:function(F,A,B){var E,D,G,C;if(S.isArray(F)){F=F.slice();for(E=0,D=F.length;E<D;E++){this.open_node(F[E],A,B)}return true}F=this.get_node(F);if(!F||F.id===S.jstree.root){return false}B=B===R?this.settings.core.animation:B;if(!this.is_closed(F)){if(A){A.call(this,F,false)}return false}if(!this.is_loaded(F)){if(this.is_loading(F)){return setTimeout(S.proxy(function(){this.open_node(F,A,B)},this),500)}this.load_node(F,function(H,I){return I?this.open_node(H,A,B):(A?A.call(this,H,false):false)})}else{G=this.get_node(F,true);C=this;if(G.length){if(B&&G.children(".jstree-children").length){G.children(".jstree-children").stop(true,true)}if(F.children.length&&!this._firstChild(G.children(".jstree-children")[0])){this.draw_children(F)}if(!B){this.trigger("before_open",{"node":F});G[0].className=G[0].className.replace("jstree-closed","jstree-open");G[0].setAttribute("aria-expanded",true)}else{this.trigger("before_open",{"node":F});G.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",true).children(".jstree-children").stop(true,true).slideDown(B,function(){this.style.display="";C.trigger("after_open",{"node":F})})}}F.state.opened=true;if(A){A.call(this,F,true)}if(!G.length){this.trigger("before_open",{"node":F})}this.trigger("open_node",{"node":F});if(!B||!G.length){this.trigger("after_open",{"node":F})}}},_open_to:function(B){B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}var A,D,C=B.parents;for(A=0,D=C.length;A<D;A+=1){if(A!==S.jstree.root){this.open_node(C[A],false,0)}}return S("#"+B.id.replace(S.jstree.idregex,"\\$&"),this.element)},close_node:function(B,A){var D,F,C,E;if(S.isArray(B)){B=B.slice();for(D=0,F=B.length;D<F;D++){this.close_node(B[D],A)}return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}if(this.is_closed(B)){return false}A=A===R?this.settings.core.animation:A;C=this;E=this.get_node(B,true);if(E.length){if(!A){E[0].className=E[0].className.replace("jstree-open","jstree-closed");E.attr("aria-expanded",false).children(".jstree-children").remove()}else{E.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",false).children(".jstree-children").stop(true,true).slideUp(A,function(){this.style.display="";E.children(".jstree-children").remove();C.trigger("after_close",{"node":B})})}}B.state.opened=false;this.trigger("close_node",{"node":B});if(!A||!E.length){this.trigger("after_close",{"node":B})}},toggle_node:function(B){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.toggle_node(B[C])}return true}if(this.is_closed(B)){return this.open_node(B)}if(this.is_open(B)){return this.close_node(B)}},open_all:function(F,B,G){if(!F){F=S.jstree.root}F=this.get_node(F);if(!F){return false}var A=F.id===S.jstree.root?this.get_container_ul():this.get_node(F,true),D,E,C;if(!A.length){for(D=0,E=F.children_d.length;D<E;D++){if(this.is_closed(this._model.data[F.children_d[D]])){this._model.data[F.children_d[D]].state.opened=true}}return this.trigger("open_all",{"node":F})}G=G||A;C=this;A=this.is_closed(F)?A.find(".jstree-closed").addBack():A.find(".jstree-closed");A.each(function(){C.open_node(this,function(I,H){if(H&&this.is_parent(I)){this.open_all(I,B,G)}},B||0)});if(G.find(".jstree-closed").length===0){this.trigger("open_all",{"node":this.get_node(G)})}},close_all:function(E,B){if(!E){E=S.jstree.root}E=this.get_node(E);if(!E){return false}var A=E.id===S.jstree.root?this.get_container_ul():this.get_node(E,true),F=this,C,D;if(A.length){A=this.is_open(E)?A.find(".jstree-open").addBack():A.find(".jstree-open");S(A.get().reverse()).each(function(){F.close_node(this,B||0)})}for(C=0,D=E.children_d.length;C<D;C++){this._model.data[E.children_d[C]].state.opened=false}this.trigger("close_all",{"node":E})},is_disabled:function(A){A=this.get_node(A);return A&&A.state&&A.state.disabled},enable_node:function(B){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.enable_node(B[C])}return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}B.state.disabled=false;this.get_node(B,true).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",false);this.trigger("enable_node",{"node":B})},disable_node:function(B){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.disable_node(B[C])}return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}B.state.disabled=true;this.get_node(B,true).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",true);this.trigger("disable_node",{"node":B})},hide_node:function(B,D){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.hide_node(B[C],true)}this.redraw();return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}if(!B.state.hidden){B.state.hidden=true;this._node_changed(B.parent);if(!D){this.redraw()}this.trigger("hide_node",{"node":B})}},show_node:function(B,D){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.show_node(B[C],true)}this.redraw();return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}if(B.state.hidden){B.state.hidden=false;this._node_changed(B.parent);if(!D){this.redraw()}this.trigger("show_node",{"node":B})}},hide_all:function(B){var A,C=this._model.data,D=[];for(A in C){if(C.hasOwnProperty(A)&&A!==S.jstree.root&&!C[A].state.hidden){C[A].state.hidden=true;D.push(A)}}this._model.force_full_redraw=true;this.redraw();this.trigger("hide_all",{"nodes":D});return D},show_all:function(B){var A,C=this._model.data,D=[];for(A in C){if(C.hasOwnProperty(A)&&A!==S.jstree.root&&C[A].state.hidden){C[A].state.hidden=false;D.push(A)}}this._model.force_full_redraw=true;this.redraw();this.trigger("show_all",{"nodes":D});return D},activate_node:function(A,C){if(this.is_disabled(A)){return false}if(!C||typeof C!=="object"){C={}}this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==R?this.get_node(this._data.core.last_clicked.id):null;if(this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected){this._data.core.last_clicked=null}if(!this._data.core.last_clicked&&this._data.core.selected.length){this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])}if(!this.settings.core.multiple||(!C.metaKey&&!C.ctrlKey&&!C.shiftKey)||(C.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(A)||this.get_parent(A)!==this._data.core.last_clicked.parent))){if(!this.settings.core.multiple&&(C.metaKey||C.ctrlKey||C.shiftKey)&&this.is_selected(A)){this.deselect_node(A,false,C)}else{this.deselect_all(true);this.select_node(A,false,false,C);this._data.core.last_clicked=this.get_node(A)}}else{if(C.shiftKey){var E=this.get_node(A).id,F=this._data.core.last_clicked.id,D=this.get_node(this._data.core.last_clicked.parent).children,B=false,H,G;for(H=0,G=D.length;H<G;H+=1){if(D[H]===E){B=!B}if(D[H]===F){B=!B}if(!this.is_disabled(D[H])&&(B||D[H]===E||D[H]===F)){this.select_node(D[H],true,false,C)}else{this.deselect_node(D[H],true,C)}}this.trigger("changed",{"action":"select_node","node":this.get_node(A),"selected":this._data.core.selected,"event":C})}else{if(!this.is_selected(A)){this.select_node(A,false,false,C)}else{this.deselect_node(A,false,C)}}}this.trigger("activate_node",{"node":this.get_node(A),"event":C})},hover_node:function(A){A=this.get_node(A,true);if(!A||!A.length||A.children(".jstree-hovered").length){return false}var B=this.element.find(".jstree-hovered"),C=this.element;if(B&&B.length){this.dehover_node(B)}A.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{"node":this.get_node(A)});setTimeout(function(){C.attr("aria-activedescendant",A[0].id)},0)},dehover_node:function(A){A=this.get_node(A,true);if(!A||!A.length||!A.children(".jstree-hovered").length){return false}A.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{"node":this.get_node(A)})},select_node:function(A,C,H,D){var G,E,F,B;if(S.isArray(A)){A=A.slice();for(E=0,F=A.length;E<F;E++){this.select_node(A[E],C,H,D)}return true}A=this.get_node(A);if(!A||A.id===S.jstree.root){return false}G=this.get_node(A,true);if(!A.state.selected){A.state.selected=true;this._data.core.selected.push(A.id);if(!H){G=this._open_to(A)}if(G&&G.length){G.attr("aria-selected",true).children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{"node":A,"selected":this._data.core.selected,"event":D});if(!C){this.trigger("changed",{"action":"select_node","node":A,"selected":this._data.core.selected,"event":D})}}},deselect_node:function(E,C,F){var D,B,A;if(S.isArray(E)){E=E.slice();for(D=0,B=E.length;D<B;D++){this.deselect_node(E[D],C,F)}return true}E=this.get_node(E);if(!E||E.id===S.jstree.root){return false}A=this.get_node(E,true);if(E.state.selected){E.state.selected=false;this._data.core.selected=S.vakata.array_remove_item(this._data.core.selected,E.id);if(A.length){A.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{"node":E,"selected":this._data.core.selected,"event":F});if(!C){this.trigger("changed",{"action":"deselect_node","node":E,"selected":this._data.core.selected,"event":F})}}},select_all:function(C){var A=this._data.core.selected.concat([]),B,D;this._data.core.selected=this._model.data[S.jstree.root].children_d.concat();for(B=0,D=this._data.core.selected.length;B<D;B++){if(this._model.data[this._data.core.selected[B]]){this._model.data[this._data.core.selected[B]].state.selected=true}}this.redraw(true);this.trigger("select_all",{"selected":this._data.core.selected});if(!C){this.trigger("changed",{"action":"select_all","selected":this._data.core.selected,"old_selection":A})}},deselect_all:function(C){var A=this._data.core.selected.concat([]),B,D;for(B=0,D=this._data.core.selected.length;B<D;B++){if(this._model.data[this._data.core.selected[B]]){this._model.data[this._data.core.selected[B]].state.selected=false}}this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",false);this.trigger("deselect_all",{"selected":this._data.core.selected,"node":A});if(!C){this.trigger("changed",{"action":"deselect_all","selected":this._data.core.selected,"old_selection":A})}},is_selected:function(A){A=this.get_node(A);if(!A||A.id===S.jstree.root){return false}return A.state.selected},get_selected:function(A){return A?S.map(this._data.core.selected,S.proxy(function(B){return this.get_node(B)},this)):this._data.core.selected.slice()},get_top_selected:function(E){var A=this.get_selected(true),F={},B,D,G,C;for(B=0,D=A.length;B<D;B++){F[A[B].id]=A[B]}for(B=0,D=A.length;B<D;B++){for(G=0,C=A[B].children_d.length;G<C;G++){if(F[A[B].children_d[G]]){delete F[A[B].children_d[G]]}}}A=[];for(B in F){if(F.hasOwnProperty(B)){A.push(B)}}return E?S.map(A,S.proxy(function(H){return this.get_node(H)},this)):A},get_bottom_selected:function(E){var A=this.get_selected(true),D=[],B,C;for(B=0,C=A.length;B<C;B++){if(!A[B].children.length){D.push(A[B].id)}}return E?S.map(D,S.proxy(function(F){return this.get_node(F)},this)):D},get_state:function(){var B={"core":{"open":[],"scroll":{"left":this.element.scrollLeft(),"top":this.element.scrollTop()},"selected":[]}},A;for(A in this._model.data){if(this._model.data.hasOwnProperty(A)){if(A!==S.jstree.root){if(this._model.data[A].state.opened){B.core.open.push(A)}if(this._model.data[A].state.selected){B.core.selected.push(A)}}}}return B},set_state:function(E,A){if(E){if(E.core){var D,F,C,B,G;if(E.core.open){if(!S.isArray(E.core.open)||!E.core.open.length){delete E.core.open;this.set_state(E,A)}else{this._load_nodes(E.core.open,function(H){this.open_node(H,false,0);delete E.core.open;this.set_state(E,A)},true)}return false}if(E.core.scroll){if(E.core.scroll&&E.core.scroll.left!==R){this.element.scrollLeft(E.core.scroll.left)}if(E.core.scroll&&E.core.scroll.top!==R){this.element.scrollTop(E.core.scroll.top)}delete E.core.scroll;this.set_state(E,A);return false}if(E.core.selected){B=this;this.deselect_all();S.each(E.core.selected,function(I,H){B.select_node(H,false,true)});delete E.core.selected;this.set_state(E,A);return false}for(G in E){if(E.hasOwnProperty(G)&&G!=="core"&&S.inArray(G,this.settings.plugins)===-1){delete E[G]}}if(S.isEmptyObject(E.core)){delete E.core;this.set_state(E,A);return false}}if(S.isEmptyObject(E)){E=null;if(A){A.call(this)}this.trigger("set_state");return false}return true}return false},refresh:function(B,A){this._data.core.state=A===true?{}:this.get_state();if(A&&S.isFunction(A)){this._data.core.state=A.call(this,this._data.core.state)}this._cnt=0;this._model.data={};this._model.data[S.jstree.root]={id:S.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:false}};this._data.core.selected=[];this._data.core.last_clicked=null;this._data.core.focused=null;var C=this.get_container_ul()[0].className;if(!B){this.element.html("<ul class='"+C+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading")}this.load_node(S.jstree.root,function(D,E){if(E){this.get_container_ul()[0].className=C;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.set_state(S.extend(true,{},this._data.core.state),function(){this.trigger("refresh")})}this._data.core.state=null})},refresh_node:function(B){B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}var D=[],A=[],C=this._data.core.selected.concat([]);A.push(B.id);if(B.state.opened===true){D.push(B.id)}this.get_node(B,true).find(".jstree-open").each(function(){D.push(this.id)});this._load_nodes(A,S.proxy(function(E){this.open_node(D,false,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{"node":B,"nodes":E})},this))},set_id:function(B,C){B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}var A,E,D=this._model.data;C=C.toString();D[B.parent].children[S.inArray(B.id,D[B.parent].children)]=C;for(A=0,E=B.parents.length;A<E;A++){D[B.parents[A]].children_d[S.inArray(B.id,D[B.parents[A]].children_d)]=C}for(A=0,E=B.children.length;A<E;A++){D[B.children[A]].parent=C}for(A=0,E=B.children_d.length;A<E;A++){D[B.children_d[A]].parents[S.inArray(B.id,D[B.children_d[A]].parents)]=C}A=S.inArray(B.id,this._data.core.selected);if(A!==-1){this._data.core.selected[A]=C}A=this.get_node(B.id,true);if(A){A.attr("id",C).children(".jstree-anchor").attr("id",C+"_anchor").end().attr("aria-labelledby",C+"_anchor");if(this.element.attr("aria-activedescendant")===B.id){this.element.attr("aria-activedescendant",C)}}delete D[B.id];B.id=C;B.li_attr.id=C;D[C]=B;return true},get_text:function(A){A=this.get_node(A);return(!A||A.id===S.jstree.root)?false:A.text},set_text:function(B,C){var D,A;if(S.isArray(B)){B=B.slice();for(D=0,A=B.length;D<A;D++){this.set_text(B[D],C)}return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}B.text=C;if(this.get_node(B,true).length){this.redraw_node(B.id)}this.trigger("set_text",{"obj":B,"text":C});return true},get_json:function(E,C,F){E=this.get_node(E||S.jstree.root);if(!E){return false}if(C&&C.flat&&!F){F=[]}var A={"id":E.id,"text":E.text,"icon":this.get_icon(E),"li_attr":S.extend(true,{},E.li_attr),"a_attr":S.extend(true,{},E.a_attr),"state":{},"data":C&&C.no_data?false:S.extend(true,{},E.data)},B,D;if(C&&C.flat){A.parent=E.parent}else{A.children=[]}if(!C||!C.no_state){for(B in E.state){if(E.state.hasOwnProperty(B)){A.state[B]=E.state[B]}}}if(C&&C.no_id){delete A.id;if(A.li_attr&&A.li_attr.id){delete A.li_attr.id}if(A.a_attr&&A.a_attr.id){delete A.a_attr.id}}if(C&&C.flat&&E.id!==S.jstree.root){F.push(A)}if(!C||!C.no_children){for(B=0,D=E.children.length;B<D;B++){if(C&&C.flat){this.get_json(E.children[B],C,F)}else{A.children.push(this.get_json(E.children[B],C))}}}return C&&C.flat?F:(E.id===S.jstree.root?A.children:A)},create_node:function(H,B,C,D,A){if(H===null){H=S.jstree.root}H=this.get_node(H);if(!H){return false}C=C===R?"last":C;if(!C.toString().match(/^(before|after)$/)&&!A&&!this.is_loaded(H)){return this.load_node(H,function(){this.create_node(H,B,C,D,true)})}if(!B){B={"text":this.get_string("New node")}}if(typeof B==="string"){B={"text":B}}if(B.text===R){B.text=this.get_string("New node")}var F,E,G,I;if(H.id===S.jstree.root){if(C==="before"){C="first"}if(C==="after"){C="last"}}switch(C){case"before":F=this.get_node(H.parent);C=S.inArray(H.id,F.children);H=F;break;case"after":F=this.get_node(H.parent);C=S.inArray(H.id,F.children)+1;H=F;break;case"inside":case"first":C=0;break;case"last":C=H.children.length;break;default:if(!C){C=0}break}if(C>H.children.length){C=H.children.length}if(!B.id){B.id=true}if(!this.check("create_node",B,H,C)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(B.id===true){delete B.id}B=this._parse_model_from_json(B,H.id,H.parents.concat());if(!B){return false}F=this.get_node(B);E=[];E.push(B);E=E.concat(F.children_d);this.trigger("model",{"nodes":E,"parent":H.id});H.children_d=H.children_d.concat(E);for(G=0,I=H.parents.length;G<I;G++){this._model.data[H.parents[G]].children_d=this._model.data[H.parents[G]].children_d.concat(E)}B=F;F=[];for(G=0,I=H.children.length;G<I;G++){F[G>=C?G+1:G]=H.children[G]}F[C]=B.id;H.children=F;this.redraw_node(H,true);if(D){D.call(this,this.get_node(B))}this.trigger("create_node",{"node":this.get_node(B),"parent":H.id,"position":C});return B.id},rename_node:function(B,E){alert("aaaa");var C,A,D;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.rename_node(B[C],E)}return true}B=this.get_node(B);if(!B||B.id===S.jstree.root){return false}D=B.text;alert("bbb");if(!this.check("rename_node",B,this.get_parent(B),E)){alert("mmm");this.settings.core.error.call(this,this._data.core.last_error);return false}alert("ccc");this.set_text(B,E);this.trigger("rename_node",{"node":B,"text":E,"old":D});return true},delete_node:function(M){var C,H,G,D,L,I,K,J,A,B,F,E;if(S.isArray(M)){M=M.slice();for(C=0,H=M.length;C<H;C++){this.delete_node(M[C])}return true}M=this.get_node(M);if(!M||M.id===S.jstree.root){return false}G=this.get_node(M.parent);D=S.inArray(M.id,G.children);B=false;if(!this.check("delete_node",M,G,D)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(D!==-1){G.children=S.vakata.array_remove(G.children,D)}L=M.children_d.concat([]);L.push(M.id);for(J=0,A=L.length;J<A;J++){for(I=0,K=M.parents.length;I<K;I++){D=S.inArray(L[J],this._model.data[M.parents[I]].children_d);if(D!==-1){this._model.data[M.parents[I]].children_d=S.vakata.array_remove(this._model.data[M.parents[I]].children_d,D)}}if(this._model.data[L[J]].state.selected){B=true;D=S.inArray(L[J],this._data.core.selected);if(D!==-1){this._data.core.selected=S.vakata.array_remove(this._data.core.selected,D)}}}this.trigger("delete_node",{"node":M,"parent":G.id});if(B){this.trigger("changed",{"action":"delete_node","node":M,"selected":this._data.core.selected,"parent":G.id})}for(J=0,A=L.length;J<A;J++){delete this._model.data[L[J]]}if(S.inArray(this._data.core.focused,L)!==-1){this._data.core.focused=null;F=this.element[0].scrollTop;E=this.element[0].scrollLeft;if(G.id===S.jstree.root){this.get_node(this._model.data[S.jstree.root].children[0],true).children(".jstree-anchor").focus()}else{this.get_node(G,true).children(".jstree-anchor").focus()}this.element[0].scrollTop=F;this.element[0].scrollLeft=E}this.redraw_node(G,true);return true},check:function(B,G,E,D,C){G=G&&G.id?G:this.get_node(G);E=E&&E.id?E:this.get_node(E);var A=B.match(/^move_node|copy_node|create_node$/i)?E:G,F=this.settings.core.check_callback;if(B==="move_node"||B==="copy_node"){if((!C||!C.is_multi)&&(G.id===E.id||S.inArray(G.id,E.children)===D||S.inArray(E.id,G.children_d)!==-1)){this._data.core.last_error={"error":"check","plugin":"core","id":"core_01","reason":"Moving parent inside child","data":JSON.stringify({"chk":B,"pos":D,"obj":G&&G.id?G.id:false,"par":E&&E.id?E.id:false})};return false}}if(A&&A.data){A=A.data}if(A&&A.functions&&(A.functions[B]===false||A.functions[B]===true)){if(A.functions[B]===false){this._data.core.last_error={"error":"check","plugin":"core","id":"core_02","reason":"Node data prevents function: "+B,"data":JSON.stringify({"chk":B,"pos":D,"obj":G&&G.id?G.id:false,"par":E&&E.id?E.id:false})}}return A.functions[B]}if(F===false||(S.isFunction(F)&&F.call(this,B,G,E,D,C)===false)||(F&&F[B]===false)){this._data.core.last_error={"error":"check","plugin":"core","id":"core_03","reason":"User config for core.check_callback prevents function: "+B,"data":JSON.stringify({"chk":B,"pos":D,"obj":G&&G.id?G.id:false,"par":E&&E.id?E.id:false})};return false}return true},last_error:function(){return this._data.core.last_error},move_node:function(E,Q,I,O,K,l,G){var L,F,J,N,P,i,M,C,k,j,A,H,B,D;Q=this.get_node(Q);I=I===R?0:I;if(!Q){return false}if(!I.toString().match(/^(before|after)$/)&&!K&&!this.is_loaded(Q)){return this.load_node(Q,function(){this.move_node(E,Q,I,O,true,false,G)})}if(S.isArray(E)){if(E.length===1){E=E[0]}else{for(L=0,F=E.length;L<F;L++){if((k=this.move_node(E[L],Q,I,O,K,false,G))){Q=k;I="after"}}this.redraw();return true}}E=E&&E.id?E:this.get_node(E);if(!E||E.id===S.jstree.root){return false}J=(E.parent||S.jstree.root).toString();P=(!I.toString().match(/^(before|after)$/)||Q.id===S.jstree.root)?Q:this.get_node(Q.parent);i=G?G:(this._model.data[E.id]?this:S.jstree.reference(E.id));M=!i||!i._id||(this._id!==i._id);N=i&&i._id&&J&&i._model.data[J]&&i._model.data[J].children?S.inArray(E.id,i._model.data[J].children):-1;if(i&&i._id){E=i._model.data[E.id]}if(M){if((k=this.copy_node(E,Q,I,O,K,false,G))){if(i){i.delete_node(E)}return k}return false}if(Q.id===S.jstree.root){if(I==="before"){I="first"}if(I==="after"){I="last"}}switch(I){case"before":I=S.inArray(Q.id,P.children);break;case"after":I=S.inArray(Q.id,P.children)+1;break;case"inside":case"first":I=0;break;case"last":I=P.children.length;break;default:if(!I){I=0}break}if(I>P.children.length){I=P.children.length}if(!this.check("move_node",E,P,I,{"core":true,"origin":G,"is_multi":(i&&i._id&&i._id!==this._id),"is_foreign":(!i||!i._id)})){this.settings.core.error.call(this,this._data.core.last_error);return false}if(E.parent===P.id){C=P.children.concat();k=S.inArray(E.id,C);if(k!==-1){C=S.vakata.array_remove(C,k);if(I>k){I--}}k=[];for(j=0,A=C.length;j<A;j++){k[j>=I?j+1:j]=C[j]}k[I]=E.id;P.children=k;this._node_changed(P.id);this.redraw(P.id===S.jstree.root)}else{k=E.children_d.concat();k.push(E.id);for(j=0,A=E.parents.length;j<A;j++){C=[];D=i._model.data[E.parents[j]].children_d;for(H=0,B=D.length;H<B;H++){if(S.inArray(D[H],k)===-1){C.push(D[H])}}i._model.data[E.parents[j]].children_d=C}i._model.data[J].children=S.vakata.array_remove_item(i._model.data[J].children,E.id);for(j=0,A=P.parents.length;j<A;j++){this._model.data[P.parents[j]].children_d=this._model.data[P.parents[j]].children_d.concat(k)}C=[];for(j=0,A=P.children.length;j<A;j++){C[j>=I?j+1:j]=P.children[j]}C[I]=E.id;P.children=C;P.children_d.push(E.id);P.children_d=P.children_d.concat(E.children_d);E.parent=P.id;k=P.parents.concat();k.unshift(P.id);D=E.parents.length;E.parents=k;k=k.concat();for(j=0,A=E.children_d.length;j<A;j++){this._model.data[E.children_d[j]].parents=this._model.data[E.children_d[j]].parents.slice(0,D*-1);Array.prototype.push.apply(this._model.data[E.children_d[j]].parents,k)}if(J===S.jstree.root||P.id===S.jstree.root){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(J);this._node_changed(P.id)}if(!l){this.redraw()}}if(O){O.call(this,E,P,I)}this.trigger("move_node",{"node":E,"parent":P.id,"position":I,"old_parent":J,"old_position":N,"is_multi":(i&&i._id&&i._id!==this._id),"is_foreign":(!i||!i._id),"old_instance":i,"new_instance":this});return E.id},copy_node:function(D,M,L,B,J,i,A){var H,E,O,G,F,K,N,C,I,Q,P;M=this.get_node(M);L=L===R?0:L;if(!M){return false}if(!L.toString().match(/^(before|after)$/)&&!J&&!this.is_loaded(M)){return this.load_node(M,function(){this.copy_node(D,M,L,B,true,false,A)})}if(S.isArray(D)){if(D.length===1){D=D[0]}else{for(H=0,E=D.length;H<E;H++){if((G=this.copy_node(D[H],M,L,B,J,true,A))){M=G;L="after"}}this.redraw();return true}}D=D&&D.id?D:this.get_node(D);if(!D||D.id===S.jstree.root){return false}C=(D.parent||S.jstree.root).toString();I=(!L.toString().match(/^(before|after)$/)||M.id===S.jstree.root)?M:this.get_node(M.parent);Q=A?A:(this._model.data[D.id]?this:S.jstree.reference(D.id));P=!Q||!Q._id||(this._id!==Q._id);if(Q&&Q._id){D=Q._model.data[D.id]}if(M.id===S.jstree.root){if(L==="before"){L="first"}if(L==="after"){L="last"}}switch(L){case"before":L=S.inArray(M.id,I.children);break;case"after":L=S.inArray(M.id,I.children)+1;break;case"inside":case"first":L=0;break;case"last":L=I.children.length;break;default:if(!L){L=0}break}if(L>I.children.length){L=I.children.length}if(!this.check("copy_node",D,I,L,{"core":true,"origin":A,"is_multi":(Q&&Q._id&&Q._id!==this._id),"is_foreign":(!Q||!Q._id)})){this.settings.core.error.call(this,this._data.core.last_error);return false}N=Q?Q.get_json(D,{no_id:true,no_data:true,no_state:true}):D;if(!N){return false}if(N.id===true){delete N.id}N=this._parse_model_from_json(N,I.id,I.parents.concat());if(!N){return false}G=this.get_node(N);if(D&&D.state&&D.state.loaded===false){G.state.loaded=false}O=[];O.push(N);O=O.concat(G.children_d);this.trigger("model",{"nodes":O,"parent":I.id});for(F=0,K=I.parents.length;F<K;F++){this._model.data[I.parents[F]].children_d=this._model.data[I.parents[F]].children_d.concat(O)}O=[];for(F=0,K=I.children.length;F<K;F++){O[F>=L?F+1:F]=I.children[F]}O[L]=G.id;I.children=O;I.children_d.push(G.id);I.children_d=I.children_d.concat(G.children_d);if(I.id===S.jstree.root){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(I.id)}if(!i){this.redraw(I.id===S.jstree.root)}if(B){B.call(this,G,I,L)}this.trigger("copy_node",{"node":G,"original":D,"parent":I.id,"position":L,"old_parent":C,"old_position":Q&&Q._id&&C&&Q._model.data[C]&&Q._model.data[C].children?S.inArray(D.id,Q._model.data[C].children):-1,"is_multi":(Q&&Q._id&&Q._id!==this._id),"is_foreign":(!Q||!Q._id),"old_instance":Q,"new_instance":this});return G.id},cut:function(D){if(!D){D=this._data.core.selected.concat()}if(!S.isArray(D)){D=[D]}if(!D.length){return false}var A=[],E,C,B;for(C=0,B=D.length;C<B;C++){E=this.get_node(D[C]);if(E&&E.id&&E.id!==S.jstree.root){A.push(E)}}if(!A.length){return false}X=A;b=this;c="move_node";this.trigger("cut",{"node":D})},copy:function(D){if(!D){D=this._data.core.selected.concat()}if(!S.isArray(D)){D=[D]}if(!D.length){return false}var A=[],E,C,B;for(C=0,B=D.length;C<B;C++){E=this.get_node(D[C]);if(E&&E.id&&E.id!==S.jstree.root){A.push(E)}}if(!A.length){return false}X=A;b=this;c="copy_node";this.trigger("copy",{"node":D})},get_buffer:function(){return{"mode":c,"node":X,"inst":b}},can_paste:function(){return c!==false&&X!==false},paste:function(A,B){A=this.get_node(A);if(!A||!c||!c.match(/^(copy_node|move_node)$/)||!X){return false}if(this[c](X,A,B,false,false,false,b)){this.trigger("paste",{"parent":A.id,"node":X,"mode":c})}X=false;c=false;b=false},clear_buffer:function(){X=false;c=false;b=false;this.trigger("clear_buffer")},edit:function(G,D,K){var H,L,M,F,I,A,E,B,C,J=false;G=this.get_node(G);if(!G){return false}if(this.settings.core.check_callback===false){this._data.core.last_error={"error":"check","plugin":"core","id":"core_07","reason":"Could not edit node because of check_callback"};this.settings.core.error.call(this,this._data.core.last_error);return false}C=G;D=typeof D==="string"?D:G.text;this.set_text(G,"");G=this._open_to(G);C.text=D;H=this._data.core.rtl;L=this.element.width();this._data.core.focused=C.id;M=G.children(".jstree-anchor").focus();F=S("<span>");I=D;A=S("<div />",{css:{"position":"absolute","top":"-200px","left":(H?"0px":"-1000px"),"visibility":"hidden"}}).appendTo("body");E=S("<input />",{"value":I,"class":"jstree-rename-input","css":{"padding":"0","border":"1px solid silver","box-sizing":"border-box","display":"inline-block","height":(this._data.core.li_height)+"px","lineHeight":(this._data.core.li_height)+"px","width":"150px"},"blur":S.proxy(function(N){N.stopImmediatePropagation();N.preventDefault();var Q=F.children(".jstree-rename-input"),O=Q.val(),i=this.settings.core.force_text,P;if(O===""){O=I}A.remove();F.replaceWith(M);F.remove();I=i?I:S("<div></div>").append(S.parseHTML(I)).html();this.set_text(G,I);P=!!this.rename_node(G,i?S("<div></div>").text(O).text():S("<div></div>").append(S.parseHTML(O)).html());if(!P){this.set_text(G,I)}this._data.core.focused=C.id;setTimeout(S.proxy(function(){var j=this.get_node(C.id,true);if(j.length){this._data.core.focused=C.id;j.children(".jstree-anchor").focus()}},this),0);if(K){K.call(this,C,P,J)}},this),"keydown":function(O){var N=O.which;if(N===27){J=true;this.value=I}if(N===27||N===13||N===37||N===38||N===39||N===40||N===32){O.stopImmediatePropagation()}if(N===27||N===13){O.preventDefault();this.blur()}},"click":function(N){N.stopImmediatePropagation()},"mousedown":function(N){N.stopImmediatePropagation()},"keyup":function(N){E.width(Math.min(A.text("pW"+this.value).width(),L))},"keypress":function(N){if(N.which===13){return false}}});B={fontFamily:M.css("fontFamily")||"",fontSize:M.css("fontSize")||"",fontWeight:M.css("fontWeight")||"",fontStyle:M.css("fontStyle")||"",fontStretch:M.css("fontStretch")||"",fontVariant:M.css("fontVariant")||"",letterSpacing:M.css("letterSpacing")||"",wordSpacing:M.css("wordSpacing")||""};F.attr("class",M.attr("class")).append(M.contents().clone()).append(E);M.replaceWith(F);A.css(B);E.css(B).width(Math.min(A.text("pW"+E[0].value).width(),L))[0].select()},set_theme:function(C,B){if(!C){return false}if(B===true){var A=this.settings.core.themes.dir;if(!A){A=S.jstree.path+"/themes"}B=A+"/"+C+"/style.css"}if(B&&S.inArray(B,f)===-1){S("head").append('<link rel="stylesheet" href="'+B+'" type="text/css" />');f.push(B)}if(this._data.core.themes.name){this.element.removeClass("jstree-"+this._data.core.themes.name)}this._data.core.themes.name=C;this.element.addClass("jstree-"+C);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+C+"-responsive");this.trigger("set_theme",{"theme":C})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(A){if(this._data.core.themes.variant){this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}this._data.core.themes.variant=A;if(A){this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=true;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=false;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){if(this._data.core.themes.stripes){this.hide_stripes()}else{this.show_stripes()}},show_dots:function(){this._data.core.themes.dots=true;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=false;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){if(this._data.core.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this._data.core.themes.icons=true;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=false;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){if(this._data.core.themes.icons){this.hide_icons()}else{this.show_icons()}},set_icon:function(E,C){var D,B,A,F;if(S.isArray(E)){E=E.slice();for(D=0,B=E.length;D<B;D++){this.set_icon(E[D],C)}return true}E=this.get_node(E);if(!E||E.id===S.jstree.root){return false}F=E.icon;E.icon=C===true||C===null||C===R||C===""?true:C;A=this.get_node(E,true).children(".jstree-anchor").children(".jstree-themeicon");if(C===false){this.hide_icon(E)}else{if(C===true||C===null||C===R||C===""){A.removeClass("jstree-themeicon-custom "+F).css("background","").removeAttr("rel");if(F===false){this.show_icon(E)}}else{if(C.indexOf("/")===-1&&C.indexOf(".")===-1){A.removeClass(F).css("background","");A.addClass(C+" jstree-themeicon-custom").attr("rel",C);if(F===false){this.show_icon(E)}}else{A.removeClass(F).css("background","");A.addClass("jstree-themeicon-custom").css("background","url('"+C+"') center center no-repeat").attr("rel",C);if(F===false){this.show_icon(E)}}}}return true},get_icon:function(A){A=this.get_node(A);return(!A||A.id===S.jstree.root)?false:A.icon},hide_icon:function(B){var C,A;if(S.isArray(B)){B=B.slice();for(C=0,A=B.length;C<A;C++){this.hide_icon(B[C])}return true}B=this.get_node(B);if(!B||B===S.jstree.root){return false}B.icon=false;this.get_node(B,true).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return true},show_icon:function(C){var D,B,A;if(S.isArray(C)){C=C.slice();for(D=0,B=C.length;D<B;D++){this.show_icon(C[D])}return true}C=this.get_node(C);if(!C||C===S.jstree.root){return false}A=this.get_node(C,true);C.icon=A.length?A.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):true;if(!C.icon){C.icon=true}A.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return true}};S.vakata={};S.vakata.attributes=function(A,C){A=S(A)[0];var B=C?{}:[];if(A&&A.attributes){S.each(A.attributes,function(E,D){if(S.inArray(D.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1){return}if(D.value!==null&&S.trim(D.value)!==""){if(C){B[D.name]=D.value}else{B.push(D.name)}}})}return B};S.vakata.array_unique=function(A){var C=[],B,D,F,E={};for(B=0,F=A.length;B<F;B++){if(E[A[B]]===R){C.push(A[B]);E[A[B]]=true}}return C};S.vakata.array_remove=function(A,B,C){var D=A.slice((C||B)+1||A.length);A.length=B<0?A.length+B:B;A.push.apply(A,D);return A};S.vakata.array_remove_item=function(B,C){var A=S.inArray(C,B);return A!==-1?S.vakata.array_remove(B,A):B};S.jstree.plugins.changed=function(A,C){var B=[];this.trigger=function(F,G){var E,H;if(!G){G={}}if(F.replace(".jstree","")==="changed"){G.changed={selected:[],deselected:[]};var D={};for(E=0,H=B.length;E<H;E++){D[B[E]]=1}for(E=0,H=G.selected.length;E<H;E++){if(!D[G.selected[E]]){G.changed.selected.push(G.selected[E])}else{D[G.selected[E]]=2}}for(E=0,H=B.length;E<H;E++){if(D[B[E]]===1){G.changed.deselected.push(B[E])}}B=G.selected.slice()}C.trigger.call(this,F,G)};this.refresh=function(D,E){B=[];return C.refresh.apply(this,arguments)}};var e=V.createElement("I");e.className="jstree-icon jstree-checkbox";e.setAttribute("role","presentation");S.jstree.defaults.checkbox={visible:true,three_state:true,whole_node:true,keep_selected_style:true,cascade:"",tie_selection:true};S.jstree.plugins.checkbox=function(A,B){this.bind=function(){B.bind.call(this);this._data.checkbox.uto=false;this._data.checkbox.selected=[];if(this.settings.checkbox.three_state){this.settings.checkbox.cascade="up+down+undetermined"}this.element.on("init.jstree",S.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;if(!this.settings.checkbox.keep_selected_style){this.element.addClass("jstree-checkbox-no-clicked")}if(this.settings.checkbox.tie_selection){this.element.addClass("jstree-checkbox-selection")}},this)).on("loading.jstree",S.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1){this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",S.proxy(function(){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(S.proxy(this._undetermined,this),50)},this))}if(!this.settings.checkbox.tie_selection){this.element.on("model.jstree",S.proxy(function(I,E){var G=this._model.data,F=G[E.parent],D=E.nodes,H,C;for(H=0,C=D.length;H<C;H++){G[D[H]].state.checked=G[D[H]].state.checked||(G[D[H]].original&&G[D[H]].original.state&&G[D[H]].original.state.checked);if(G[D[H]].state.checked){this._data.checkbox.selected.push(D[H])}}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1){this.element.on("model.jstree",S.proxy(function(N,M){var I=this._model.data,L=I[M.parent],G=M.nodes,K=[],J,P,F,C,O,H,E=this.settings.checkbox.cascade,D=this.settings.checkbox.tie_selection;if(E.indexOf("down")!==-1){if(L.state[D?"selected":"checked"]){for(P=0,F=G.length;P<F;P++){I[G[P]].state[D?"selected":"checked"]=true}this._data[D?"core":"checkbox"].selected=this._data[D?"core":"checkbox"].selected.concat(G)}else{for(P=0,F=G.length;P<F;P++){if(I[G[P]].state[D?"selected":"checked"]){for(C=0,O=I[G[P]].children_d.length;C<O;C++){I[I[G[P]].children_d[C]].state[D?"selected":"checked"]=true}this._data[D?"core":"checkbox"].selected=this._data[D?"core":"checkbox"].selected.concat(I[G[P]].children_d)}}}}if(E.indexOf("up")!==-1){for(P=0,F=L.children_d.length;P<F;P++){if(!I[L.children_d[P]].children.length){K.push(I[L.children_d[P]].parent)}}K=S.vakata.array_unique(K);for(C=0,O=K.length;C<O;C++){L=I[K[C]];while(L&&L.id!==S.jstree.root){J=0;for(P=0,F=L.children.length;P<F;P++){J+=I[L.children[P]].state[D?"selected":"checked"]}if(J===F){L.state[D?"selected":"checked"]=true;this._data[D?"core":"checkbox"].selected.push(L.id);H=this.get_node(L,true);if(H&&H.length){H.attr("aria-selected",true).children(".jstree-anchor").addClass(D?"jstree-clicked":"jstree-checked")}}else{break}L=this.get_node(L.parent)}}}this._data[D?"core":"checkbox"].selected=S.vakata.array_unique(this._data[D?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",S.proxy(function(N,K){var L=K.node,E=this._model.data,H=this.get_node(L.parent),J=this.get_node(L,true),I,F,M,C,D=this.settings.checkbox.cascade,G=this.settings.checkbox.tie_selection;if(D.indexOf("down")!==-1){this._data[G?"core":"checkbox"].selected=S.vakata.array_unique(this._data[G?"core":"checkbox"].selected.concat(L.children_d));for(I=0,F=L.children_d.length;I<F;I++){C=E[L.children_d[I]];C.state[G?"selected":"checked"]=true;if(C&&C.original&&C.original.state&&C.original.state.undetermined){C.original.state.undetermined=false}}}if(D.indexOf("up")!==-1){while(H&&H.id!==S.jstree.root){M=0;for(I=0,F=H.children.length;I<F;I++){M+=E[H.children[I]].state[G?"selected":"checked"]}if(M===F){H.state[G?"selected":"checked"]=true;this._data[G?"core":"checkbox"].selected.push(H.id);C=this.get_node(H,true);if(C&&C.length){C.attr("aria-selected",true).children(".jstree-anchor").addClass(G?"jstree-clicked":"jstree-checked")}}else{break}H=this.get_node(H.parent)}}if(D.indexOf("down")!==-1&&J.length){J.find(".jstree-anchor").addClass(G?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",true)}},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",S.proxy(function(F,E){var G=this.get_node(S.jstree.root),D=this._model.data,I,H,C;for(I=0,H=G.children_d.length;I<H;I++){C=D[G.children_d[I]];if(C&&C.original&&C.original.state&&C.original.state.undetermined){C.original.state.undetermined=false}}},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",S.proxy(function(J,K){var G=K.node,H=this.get_node(G,true),I,F,D,C=this.settings.checkbox.cascade,E=this.settings.checkbox.tie_selection;if(G&&G.original&&G.original.state&&G.original.state.undetermined){G.original.state.undetermined=false}if(C.indexOf("down")!==-1){for(I=0,F=G.children_d.length;I<F;I++){D=this._model.data[G.children_d[I]];D.state[E?"selected":"checked"]=false;if(D&&D.original&&D.original.state&&D.original.state.undetermined){D.original.state.undetermined=false}}}if(C.indexOf("up")!==-1){for(I=0,F=G.parents.length;I<F;I++){D=this._model.data[G.parents[I]];D.state[E?"selected":"checked"]=false;if(D&&D.original&&D.original.state&&D.original.state.undetermined){D.original.state.undetermined=false}D=this.get_node(G.parents[I],true);if(D&&D.length){D.attr("aria-selected",false).children(".jstree-anchor").removeClass(E?"jstree-clicked":"jstree-checked")}}}D=[];for(I=0,F=this._data[E?"core":"checkbox"].selected.length;I<F;I++){if((C.indexOf("down")===-1||S.inArray(this._data[E?"core":"checkbox"].selected[I],G.children_d)===-1)&&(C.indexOf("up")===-1||S.inArray(this._data[E?"core":"checkbox"].selected[I],G.parents)===-1)){D.push(this._data[E?"core":"checkbox"].selected[I])}}this._data[E?"core":"checkbox"].selected=S.vakata.array_unique(D);if(C.indexOf("down")!==-1&&H.length){H.find(".jstree-anchor").removeClass(E?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",false)}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1){this.element.on("delete_node.jstree",S.proxy(function(J,H){var K=this.get_node(H.parent),I=this._model.data,D,E,G,F,C=this.settings.checkbox.tie_selection;while(K&&K.id!==S.jstree.root){G=0;for(D=0,E=K.children.length;D<E;D++){G+=I[K.children[D]].state[C?"selected":"checked"]}if(G===E){K.state[C?"selected":"checked"]=true;this._data[C?"core":"checkbox"].selected.push(K.id);F=this.get_node(K,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(C?"jstree-clicked":"jstree-checked")}}else{break}K=this.get_node(K.parent)}},this)).on("move_node.jstree",S.proxy(function(L,K){var E=K.is_multi,M=K.old_parent,C=this.get_node(K.parent),N=this._model.data,J,D,I,H,F,G=this.settings.checkbox.tie_selection;if(!E){J=this.get_node(M);while(J&&J.id!==S.jstree.root){D=0;for(I=0,H=J.children.length;I<H;I++){D+=N[J.children[I]].state[G?"selected":"checked"]}if(D===H){J.state[G?"selected":"checked"]=true;this._data[G?"core":"checkbox"].selected.push(J.id);F=this.get_node(J,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(G?"jstree-clicked":"jstree-checked")}}else{break}J=this.get_node(J.parent)}}J=C;while(J&&J.id!==S.jstree.root){D=0;for(I=0,H=J.children.length;I<H;I++){D+=N[J.children[I]].state[G?"selected":"checked"]}if(D===H){if(!J.state[G?"selected":"checked"]){J.state[G?"selected":"checked"]=true;this._data[G?"core":"checkbox"].selected.push(J.id);F=this.get_node(J,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(G?"jstree-clicked":"jstree-checked")}}}else{if(J.state[G?"selected":"checked"]){J.state[G?"selected":"checked"]=false;this._data[G?"core":"checkbox"].selected=S.vakata.array_remove_item(this._data[G?"core":"checkbox"].selected,J.id);F=this.get_node(J,true);if(F&&F.length){F.attr("aria-selected",false).children(".jstree-anchor").removeClass(G?"jstree-clicked":"jstree-checked")}}else{break}}J=this.get_node(J.parent)}},this))}};this._undetermined=function(){if(this.element===null){return}var D,E,F,G,J={},H=this._model.data,L=this.settings.checkbox.tie_selection,K=this._data[L?"core":"checkbox"].selected,C=[],I=this;for(D=0,E=K.length;D<E;D++){if(H[K[D]]&&H[K[D]].parents){for(F=0,G=H[K[D]].parents.length;F<G;F++){if(J[H[K[D]].parents[F]]===R&&H[K[D]].parents[F]!==S.jstree.root){J[H[K[D]].parents[F]]=true;C.push(H[K[D]].parents[F])}}}}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var M=I.get_node(this),N;if(!M.state.loaded){if(M.original&&M.original.state&&M.original.state.undetermined&&M.original.state.undetermined===true){if(J[M.id]===R&&M.id!==S.jstree.root){J[M.id]=true;C.push(M.id)}for(F=0,G=M.parents.length;F<G;F++){if(J[M.parents[F]]===R&&M.parents[F]!==S.jstree.root){J[M.parents[F]]=true;C.push(M.parents[F])}}}}else{for(D=0,E=M.children_d.length;D<E;D++){N=H[M.children_d[D]];if(!N.state.loaded&&N.original&&N.original.state&&N.original.state.undetermined&&N.original.state.undetermined===true){if(J[N.id]===R&&N.id!==S.jstree.root){J[N.id]=true;C.push(N.id)}for(F=0,G=N.parents.length;F<G;F++){if(J[N.parents[F]]===R&&N.parents[F]!==S.jstree.root){J[N.parents[F]]=true;C.push(N.parents[F])}}}}}});this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(D=0,E=C.length;D<E;D++){if(!H[C[D]].state[L?"selected":"checked"]){K=this.get_node(C[D],true);if(K&&K.length){K.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}}}};this.redraw_node=function(F,D,H,I){F=B.redraw_node.apply(this,arguments);if(F){var J,C,G=null,E=null;for(J=0,C=F.childNodes.length;J<C;J++){if(F.childNodes[J]&&F.childNodes[J].className&&F.childNodes[J].className.indexOf("jstree-anchor")!==-1){G=F.childNodes[J];break}}if(G){if(!this.settings.checkbox.tie_selection&&this._model.data[F.id].state.checked){G.className+=" jstree-checked"}E=e.cloneNode(false);if(this._model.data[F.id].state.checkbox_disabled){E.className+=" jstree-checkbox-disabled"}G.insertBefore(E,G.childNodes[0])}}if(!H&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(S.proxy(this._undetermined,this),50)}return F};this.show_checkboxes=function(){this._data.core.themes.checkboxes=true;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=false;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){if(this._data.core.themes.checkboxes){this.hide_checkboxes()}else{this.show_checkboxes()}};this.is_undetermined=function(I){I=this.get_node(I);var F=this.settings.checkbox.cascade,H,E,G=this.settings.checkbox.tie_selection,D=this._data[G?"core":"checkbox"].selected,C=this._model.data;if(!I||I.state[G?"selected":"checked"]===true||F.indexOf("undetermined")===-1||(F.indexOf("down")===-1&&F.indexOf("up")===-1)){return false}if(!I.state.loaded&&I.original.state.undetermined===true){return true}for(H=0,E=I.children_d.length;H<E;H++){if(S.inArray(I.children_d[H],D)!==-1||(!C[I.children_d[H]].state.loaded&&C[I.children_d[H]].original.state.undetermined)){return true}}return false};this.disable_checkbox=function(C){var D,F,E;if(S.isArray(C)){C=C.slice();for(D=0,F=C.length;D<F;D++){this.disable_checkbox(C[D])}return true}C=this.get_node(C);if(!C||C.id===S.jstree.root){return false}E=this.get_node(C,true);if(!C.state.checkbox_disabled){C.state.checkbox_disabled=true;if(E&&E.length){E.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled")}this.trigger("disable_checkbox",{"node":C})}};this.enable_checkbox=function(C){var D,F,E;if(S.isArray(C)){C=C.slice();for(D=0,F=C.length;D<F;D++){this.enable_checkbox(C[D])}return true}C=this.get_node(C);if(!C||C.id===S.jstree.root){return false}E=this.get_node(C,true);if(C.state.checkbox_disabled){C.state.checkbox_disabled=false;if(E&&E.length){E.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled")}this.trigger("enable_checkbox",{"node":C})}};this.activate_node=function(C,D){if(S(D.target).hasClass("jstree-checkbox-disabled")){return false}if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||S(D.target).hasClass("jstree-checkbox"))){D.ctrlKey=true}if(this.settings.checkbox.tie_selection||(!this.settings.checkbox.whole_node&&!S(D.target).hasClass("jstree-checkbox"))){return B.activate_node.call(this,C,D)}if(this.is_disabled(C)){return false}if(this.is_checked(C)){this.uncheck_node(C,D)}else{this.check_node(C,D)}this.trigger("activate_node",{"node":this.get_node(C)})};this.check_node=function(E,F){if(this.settings.checkbox.tie_selection){return this.select_node(E,false,true,F)}var G,D,H,C;if(S.isArray(E)){E=E.slice();for(D=0,H=E.length;D<H;D++){this.check_node(E[D],F)}return true}E=this.get_node(E);if(!E||E.id===S.jstree.root){return false}G=this.get_node(E,true);if(!E.state.checked){E.state.checked=true;this._data.checkbox.selected.push(E.id);if(G&&G.length){G.children(".jstree-anchor").addClass("jstree-checked")}this.trigger("check_node",{"node":E,"selected":this._data.checkbox.selected,"event":F})}};this.uncheck_node=function(D,E){if(this.settings.checkbox.tie_selection){return this.deselect_node(D,false,E)}var C,G,F;if(S.isArray(D)){D=D.slice();for(C=0,G=D.length;C<G;C++){this.uncheck_node(D[C],E)}return true}D=this.get_node(D);if(!D||D.id===S.jstree.root){return false}F=this.get_node(D,true);if(D.state.checked){D.state.checked=false;this._data.checkbox.selected=S.vakata.array_remove_item(this._data.checkbox.selected,D.id);if(F.length){F.children(".jstree-anchor").removeClass("jstree-checked")}this.trigger("uncheck_node",{"node":D,"selected":this._data.checkbox.selected,"event":E})}};this.check_all=function(){if(this.settings.checkbox.tie_selection){return this.select_all()}var D=this._data.checkbox.selected.concat([]),E,C;this._data.checkbox.selected=this._model.data[S.jstree.root].children_d.concat();for(E=0,C=this._data.checkbox.selected.length;E<C;E++){if(this._model.data[this._data.checkbox.selected[E]]){this._model.data[this._data.checkbox.selected[E]].state.checked=true}}this.redraw(true);this.trigger("check_all",{"selected":this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection){return this.deselect_all()}var D=this._data.checkbox.selected.concat([]),E,C;for(E=0,C=this._data.checkbox.selected.length;E<C;E++){if(this._model.data[this._data.checkbox.selected[E]]){this._model.data[this._data.checkbox.selected[E]].state.checked=false}}this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{"selected":this._data.checkbox.selected,"node":D})};this.is_checked=function(C){if(this.settings.checkbox.tie_selection){return this.is_selected(C)}C=this.get_node(C);if(!C||C.id===S.jstree.root){return false}return C.state.checked};this.get_checked=function(C){if(this.settings.checkbox.tie_selection){return this.get_selected(C)}return C?S.map(this._data.checkbox.selected,S.proxy(function(D){return this.get_node(D)},this)):this._data.checkbox.selected};this.get_top_checked=function(H){if(this.settings.checkbox.tie_selection){return this.get_top_selected(H)}var G=this.get_checked(true),F={},I,E,D,C;for(I=0,E=G.length;I<E;I++){F[G[I].id]=G[I]}for(I=0,E=G.length;I<E;I++){for(D=0,C=G[I].children_d.length;D<C;D++){if(F[G[I].children_d[D]]){delete F[G[I].children_d[D]]}}}G=[];for(I in F){if(F.hasOwnProperty(I)){G.push(I)}}return H?S.map(G,S.proxy(function(J){return this.get_node(J)},this)):G};this.get_bottom_checked=function(E){if(this.settings.checkbox.tie_selection){return this.get_bottom_selected(E)}var F=this.get_checked(true),D=[],G,C;for(G=0,C=F.length;G<C;G++){if(!F[G].children.length){D.push(F[G].id)}}return E?S.map(D,S.proxy(function(H){return this.get_node(H)},this)):D};this.load_node=function(D,I){var J,F,E,G,H,C;if(!S.isArray(D)&&!this.settings.checkbox.tie_selection){C=this.get_node(D);if(C&&C.state.loaded){for(J=0,F=C.children_d.length;J<F;J++){if(this._model.data[C.children_d[J]].state.checked){H=true;this._data.checkbox.selected=S.vakata.array_remove_item(this._data.checkbox.selected,C.children_d[J])}}}}return B.load_node.apply(this,arguments)};this.get_state=function(){var C=B.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection){return C}C.checkbox=this._data.checkbox.selected.slice();return C};this.set_state=function(D,E){var C=B.set_state.apply(this,arguments);if(C&&D.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var F=this;S.each(D.checkbox,function(G,H){F.check_node(H)})}delete D.checkbox;this.set_state(D,E);return false}return C};this.refresh=function(D,C){if(!this.settings.checkbox.tie_selection){this._data.checkbox.selected=[]}return B.refresh.apply(this,arguments)}};S.jstree.defaults.conditionalselect=function(){return true};S.jstree.plugins.conditionalselect=function(A,B){this.activate_node=function(C,D){if(this.settings.conditionalselect.call(this,this.get_node(C),D)){B.activate_node.call(this,C,D)}}};S.jstree.defaults.contextmenu={select_node:true,show_at_node:true,items:function(B,A){return{"create":{"separator_before":false,"separator_after":true,"_disabled":false,"label":"Create","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);E.create_node(D,{},"last",function(F){setTimeout(function(){E.edit(F)},0)})}},"rename":{"separator_before":false,"separator_after":false,"_disabled":false,"label":"Rename","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);E.edit(D)}},"remove":{"separator_before":false,"icon":false,"separator_after":false,"_disabled":false,"label":"Delete","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);if(E.is_selected(D)){E.delete_node(E.get_selected())}else{E.delete_node(D)}}},"ccp":{"separator_before":true,"icon":false,"separator_after":false,"label":"Edit","action":false,"submenu":{"cut":{"separator_before":false,"separator_after":false,"label":"Cut","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);if(E.is_selected(D)){E.cut(E.get_top_selected())}else{E.cut(D)}}},"copy":{"separator_before":false,"icon":false,"separator_after":false,"label":"Copy","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);if(E.is_selected(D)){E.copy(E.get_top_selected())}else{E.copy(D)}}},"paste":{"separator_before":false,"icon":false,"_disabled":function(C){return !S.jstree.reference(C.reference).can_paste()},"separator_after":false,"label":"Paste","action":function(C){var E=S.jstree.reference(C.reference),D=E.get_node(C.reference);E.paste(D)}}}}}}};S.jstree.plugins.contextmenu=function(A,B){this.bind=function(){B.bind.call(this);var C=0,D=null,F,E;this.element.on("contextmenu.jstree",".jstree-anchor",S.proxy(function(G,H){G.preventDefault();C=G.ctrlKey?+new Date():0;if(H||D){C=(+new Date())+10000}if(D){clearTimeout(D)}if(!this.is_loading(G.currentTarget)){this.show_contextmenu(G.currentTarget,G.pageX,G.pageY,G)}},this)).on("click.jstree",".jstree-anchor",S.proxy(function(G){if(this._data.contextmenu.visible&&(!C||(+new Date())-C>250)){S.vakata.context.hide()}C=0},this)).on("touchstart.jstree",".jstree-anchor",function(G){if(!G.originalEvent||!G.originalEvent.changedTouches||!G.originalEvent.changedTouches[0]){return}F=G.pageX;E=G.pageY;D=setTimeout(function(){S(G.currentTarget).trigger("contextmenu",true)},750)}).on("touchmove.vakata.jstree",function(G){if(D&&G.originalEvent&&G.originalEvent.changedTouches&&G.originalEvent.changedTouches[0]&&(Math.abs(F-G.pageX)>50||Math.abs(E-G.pageY)>50)){clearTimeout(D)}}).on("touchend.vakata.jstree",function(G){if(D){clearTimeout(D)}});S(V).on("context_hide.vakata.jstree",S.proxy(function(){this._data.contextmenu.visible=false},this))};this.teardown=function(){if(this._data.contextmenu.visible){S.vakata.context.hide()}B.teardown.call(this)};this.show_contextmenu=function(D,E,C,J){D=this.get_node(D);if(!D||D.id===S.jstree.root){return false}var K=this.settings.contextmenu,G=this.get_node(D,true),F=G.children(".jstree-anchor"),I=false,H=false;if(K.show_at_node||E===R||C===R){I=F.offset();E=I.left;C=I.top+this._data.core.li_height}if(this.settings.contextmenu.select_node&&!this.is_selected(D)){this.activate_node(D,J)}H=K.items;if(S.isFunction(H)){H=H.call(this,D,S.proxy(function(L){this._show_contextmenu(D,E,C,L)},this))}if(S.isPlainObject(H)){this._show_contextmenu(D,E,C,H)}};this._show_contextmenu=function(H,F,E,G){var D=this.get_node(H,true),C=D.children(".jstree-anchor");S(V).one("context_show.vakata.jstree",S.proxy(function(I,J){var K="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";S(J.element).addClass(K)},this));this._data.contextmenu.visible=true;S.vakata.context.show(C,{"x":F,"y":E},G);this.trigger("show_contextmenu",{"node":H,"x":F,"y":E})}};(function(C){var B=false,A={element:false,reference:false,position_x:0,position_y:0,items:[],html:"",is_visible:false};C.vakata.context={settings:{hide_onmouseleave:0,icons:true},_trigger:function(D){C(V).triggerHandler("context_"+D+".vakata",{"reference":A.reference,"element":A.element,"position":{"x":A.position_x,"y":A.position_y}})},_execute:function(D){D=A.items[D];return D&&(!D._disabled||(C.isFunction(D._disabled)&&!D._disabled({"item":D,"reference":A.reference,"element":A.element})))&&D.action?D.action.call(null,{"item":D,"reference":A.reference,"element":A.element,"position":{"x":A.position_x,"y":A.position_y}}):false},_parse:function(E,F){if(!E){return false}if(!F){A.html="";A.items=[]}var G="",D=false,H;if(F){G+="<ul>"}C.each(E,function(I,J){if(!J){return true}A.items.push(J);if(!D&&J.separator_before){G+="<li class='vakata-context-separator'><a href='#' "+(C.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"}D=false;G+="<li class='"+(J._class||"")+(J._disabled===true||(C.isFunction(J._disabled)&&J._disabled({"item":J,"reference":A.reference,"element":A.element}))?" vakata-contextmenu-disabled ":"")+"' "+(J.shortcut?" data-shortcut='"+J.shortcut+"' ":"")+">";G+="<a href='#' rel='"+(A.items.length-1)+"'>";if(C.vakata.context.settings.icons){G+="<i ";if(J.icon){if(J.icon.indexOf("/")!==-1||J.icon.indexOf(".")!==-1){G+=" style='background:url(\""+J.icon+"\") center center no-repeat' "}else{G+=" class='"+J.icon+"' "}}G+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"}G+=(C.isFunction(J.label)?J.label({"item":I,"reference":A.reference,"element":A.element}):J.label)+(J.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+J.shortcut+'">'+(J.shortcut_label||"")+"</span>":"")+"</a>";if(J.submenu){H=C.vakata.context._parse(J.submenu,true);if(H){G+=H}}G+="</li>";if(J.separator_after){G+="<li class='vakata-context-separator'><a href='#' "+(C.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>";D=true}});G=G.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");if(F){G+="</ul>"}if(!F){A.html=G;C.vakata.context._trigger("parse")}return G.length>10?G:false},_show_submenu:function(G){G=C(G);if(!G.length||!G.children("ul").length){return}var K=G.children("ul"),D=G.offset().left+G.outerWidth(),H=G.offset().top,J=K.width(),F=K.height(),I=C(window).width()+C(window).scrollLeft(),E=C(window).height()+C(window).scrollTop();if(B){G[D-(J+10+G.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left")}else{G[D+J+10>I?"addClass":"removeClass"]("vakata-context-right")}if(H+F+10>E){K.css("bottom","-1px")}K.show()},show:function(D,I,G){var L,N,O,M,H,F,K,J,E=true;if(A.element&&A.element.length){A.element.width("")}switch(E){case (!I&&!D):return false;case (!!I&&!!D):A.reference=D;A.position_x=I.x;A.position_y=I.y;break;case (!I&&!!D):A.reference=D;L=D.offset();A.position_x=L.left+D.outerHeight();A.position_y=L.top;break;case (!!I&&!D):A.position_x=I.x;A.position_y=I.y;break}if(!!D&&!G&&C(D).data("vakata_contextmenu")){G=C(D).data("vakata_contextmenu")}if(C.vakata.context._parse(G)){A.element.html(A.html)}if(A.items.length){A.element.appendTo("body");N=A.element;O=A.position_x;M=A.position_y;H=N.width();F=N.height();K=C(window).width()+C(window).scrollLeft();J=C(window).height()+C(window).scrollTop();if(B){O-=(N.outerWidth()-C(D).outerWidth());if(O<C(window).scrollLeft()+20){O=C(window).scrollLeft()+20}}if(O+H+20>K){O=K-(H+20)}if(M+F+20>J){M=J-(F+20)}A.element.css({"left":O,"top":M}).show().find("a").first().focus().parent().addClass("vakata-context-hover");A.is_visible=true;C.vakata.context._trigger("show")}},hide:function(){if(A.is_visible){A.element.hide().find("ul").hide().end().find(":focus").blur().end().detach();A.is_visible=false;C.vakata.context._trigger("hide")}}};C(function(){B=C("body").css("direction")==="rtl";var D=false;A.element=C("<ul class='vakata-context'></ul>");A.element.on("mouseenter","li",function(E){E.stopImmediatePropagation();if(C.contains(this,E.relatedTarget)){return}if(D){clearTimeout(D)}A.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();C(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover");C.vakata.context._show_submenu(this)}).on("mouseleave","li",function(E){if(C.contains(this,E.relatedTarget)){return}C(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(E){C(this).find(".vakata-context-hover").removeClass("vakata-context-hover");if(C.vakata.context.settings.hide_onmouseleave){D=setTimeout((function(F){return function(){C.vakata.context.hide()}}(this)),C.vakata.context.settings.hide_onmouseleave)}}).on("click","a",function(E){E.preventDefault();if(!C(this).blur().parent().hasClass("vakata-context-disabled")&&C.vakata.context._execute(C(this).attr("rel"))!==false){C.vakata.context.hide()}}).on("keydown","a",function(E){var F=null;switch(E.which){case 13:case 32:E.type="mouseup";E.preventDefault();C(E.currentTarget).trigger(E);break;case 37:if(A.is_visible){A.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus();E.stopImmediatePropagation();E.preventDefault()}break;case 38:if(A.is_visible){F=A.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();if(!F.length){F=A.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()}F.addClass("vakata-context-hover").children("a").focus();E.stopImmediatePropagation();E.preventDefault()}break;case 39:if(A.is_visible){A.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus();E.stopImmediatePropagation();E.preventDefault()}break;case 40:if(A.is_visible){F=A.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();if(!F.length){F=A.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()}F.addClass("vakata-context-hover").children("a").focus();E.stopImmediatePropagation();E.preventDefault()}break;case 27:C.vakata.context.hide();E.preventDefault();break;default:break}}).on("keydown",function(E){E.preventDefault();var F=A.element.find(".vakata-contextmenu-shortcut-"+E.which).parent();if(F.parent().not(".vakata-context-disabled")){F.click()}});C(V).on("mousedown.vakata.jstree",function(E){if(A.is_visible&&!C.contains(A.element[0],E.target)){C.vakata.context.hide()}}).on("context_show.vakata.jstree",function(E,F){A.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");if(B){A.element.addClass("vakata-context-rtl").css("direction","rtl")}A.element.find("ul").hide().end()})})}(S));S.jstree.defaults.dnd={copy:true,open_timeout:500,is_draggable:true,check_while_dragging:true,always_copy:false,inside_pos:0,drag_selection:true,touch:true,large_drop_target:false,large_drag_target:false};S.jstree.plugins.dnd=function(A,B){this.bind=function(){B.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",S.proxy(function(E){if(this.settings.dnd.large_drag_target&&S(E.target).closest(".jstree-node")[0]!==E.currentTarget){return true}if(E.type==="touchstart"&&(!this.settings.dnd.touch||(this.settings.dnd.touch==="selected"&&!S(E.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))){return true}var F=this.get_node(E.target),C=this.is_selected(F)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,D=(C>1?C+" "+this.get_string("nodes"):this.get_text(E.currentTarget));if(this.settings.core.force_text){D=S.vakata.html.escape(D)}if(F&&F.id&&F.id!==S.jstree.root&&(E.which===1||E.type==="touchstart")&&(this.settings.dnd.is_draggable===true||(S.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,(C>1?this.get_top_selected(true):[F]),E)))){this.element.trigger("mousedown.jstree");return S.vakata.dnd.start(E,{"jstree":true,"origin":this,"obj":this.get_node(F,true),"nodes":C>1?this.get_top_selected():[F.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+D+'<ins class="jstree-copy" style="display:none;">+</ins></div>')}},this))}};S(function(){var A=false,B=false,D=false,C=false,E=S('<div id="jstree-marker">&#160;</div>').hide();S(V).on("dnd_start.vakata.jstree",function(G,F){A=false;D=false;if(!F||!F.data||!F.data.jstree){return}E.appendTo("body")}).on("dnd_move.vakata.jstree",function(I,J){if(C){clearTimeout(C)}if(!J||!J.data||!J.data.jstree){return}if(J.event.target.id&&J.event.target.id==="jstree-marker"){return}D=J.event;var F=S.jstree.reference(J.event.target),H=false,p=false,L=false,N,o,K,Q,Ab,i,t,P,M,l,z,G,O,y,Aa;if(F&&F._data&&F._data.dnd){E.attr("class","jstree-"+F.get_theme()+(F.settings.core.themes.responsive?" jstree-dnd-responsive":""));J.helper.children().attr("class","jstree-"+F.get_theme()+" jstree-"+F.get_theme()+"-"+F.get_theme_variant()+" "+(F.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[J.data.origin&&(J.data.origin.settings.dnd.always_copy||(J.data.origin.settings.dnd.copy&&(J.event.metaKey||J.event.ctrlKey)))?"show":"hide"]();if((J.event.target===F.element[0]||J.event.target===F.get_container_ul()[0])&&F.get_container_ul().children().length===0){P=true;for(M=0,l=J.data.nodes.length;M<l;M++){P=P&&F.check((J.data.origin&&(J.data.origin.settings.dnd.always_copy||(J.data.origin.settings.dnd.copy&&(J.event.metaKey||J.event.ctrlKey)))?"copy_node":"move_node"),(J.data.origin&&J.data.origin!==F?J.data.origin.get_node(J.data.nodes[M]):J.data.nodes[M]),S.jstree.root,"last",{"dnd":true,"ref":F.get_node(S.jstree.root),"pos":"i","origin":J.data.origin,"is_multi":(J.data.origin&&J.data.origin!==F),"is_foreign":(!J.data.origin)});if(!P){break}}if(P){A={"ins":F,"par":S.jstree.root,"pos":"last"};E.hide();J.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}else{H=F.settings.dnd.large_drop_target?S(J.event.target).closest(".jstree-node").children(".jstree-anchor"):S(J.event.target).closest(".jstree-anchor");if(H&&H.length&&H.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){p=H.offset();L=J.event.pageY-p.top;Q=H.outerHeight();if(L<Q/3){t=["b","i","a"]}else{if(L>Q-Q/3){t=["a","i","b"]}else{t=L>Q/2?["i","a","b"]:["i","b","a"]}}S.each(t,function(j,k){switch(k){case"b":o=p.left-6;K=p.top;Ab=F.get_parent(H);i=H.parent().index();break;case"i":y=F.settings.dnd.inside_pos;Aa=F.get_node(H.parent());o=p.left-2;K=p.top+Q/2+1;Ab=Aa.id;i=y==="first"?0:(y==="last"?Aa.children.length:Math.min(y,Aa.children.length));break;case"a":o=p.left-6;K=p.top+Q;Ab=F.get_parent(H);i=H.parent().index()+1;break}P=true;for(M=0,l=J.data.nodes.length;M<l;M++){z=J.data.origin&&(J.data.origin.settings.dnd.always_copy||(J.data.origin.settings.dnd.copy&&(J.event.metaKey||J.event.ctrlKey)))?"copy_node":"move_node";G=i;if(z==="move_node"&&k==="a"&&(J.data.origin&&J.data.origin===F)&&Ab===F.get_parent(J.data.nodes[M])){O=F.get_node(Ab);if(G>S.inArray(J.data.nodes[M],O.children)){G-=1}}P=P&&((F&&F.settings&&F.settings.dnd&&F.settings.dnd.check_while_dragging===false)||F.check(z,(J.data.origin&&J.data.origin!==F?J.data.origin.get_node(J.data.nodes[M]):J.data.nodes[M]),Ab,G,{"dnd":true,"ref":F.get_node(H.parent()),"pos":k,"origin":J.data.origin,"is_multi":(J.data.origin&&J.data.origin!==F),"is_foreign":(!J.data.origin)}));if(!P){if(F&&F.last_error){B=F.last_error()}break}}if(k==="i"&&H.parent().is(".jstree-closed")&&F.settings.dnd.open_timeout){C=setTimeout((function(n,m){return function(){n.open_node(m)}}(F,H)),F.settings.dnd.open_timeout)}if(P){A={"ins":F,"par":Ab,"pos":k==="i"&&y==="last"&&i===0&&!F.is_loaded(Aa)?"last":i};E.css({"left":o+"px","top":K+"px"}).show();J.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");B={};t=true;return false}});if(t===true){return}}}}A=false;J.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");E.hide()}).on("dnd_scroll.vakata.jstree",function(G,F){if(!F||!F.data||!F.data.jstree){return}E.hide();A=false;D=false;F.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er")}).on("dnd_stop.vakata.jstree",function(H,J){if(C){clearTimeout(C)}if(!J||!J.data||!J.data.jstree){return}E.hide().detach();var G,F,I=[];if(A){for(G=0,F=J.data.nodes.length;G<F;G++){I[G]=J.data.origin?J.data.origin.get_node(J.data.nodes[G]):J.data.nodes[G]}A.ins[J.data.origin&&(J.data.origin.settings.dnd.always_copy||(J.data.origin.settings.dnd.copy&&(J.event.metaKey||J.event.ctrlKey)))?"copy_node":"move_node"](I,A.par,A.pos,false,false,false,J.data.origin)}else{G=S(J.event.target).closest(".jstree");if(G.length&&B&&B.error&&B.error==="check"){G=G.jstree(true);if(G){G.settings.core.error.call(this,B)}}}D=false;A=false}).on("keyup.jstree keydown.jstree",function(G,F){F=S.vakata.dnd._get();if(F&&F.data&&F.data.jstree){F.helper.find(".jstree-copy").first()[F.data.origin&&(F.data.origin.settings.dnd.always_copy||(F.data.origin.settings.dnd.copy&&(G.metaKey||G.ctrlKey)))?"show":"hide"]();if(D){D.metaKey=G.metaKey;D.ctrlKey=G.ctrlKey;S.vakata.dnd._trigger("move",D)}}})});(function(B){B.vakata.html={div:B("<div />"),escape:function(C){return B.vakata.html.div.text(C).html()},strip:function(C){return B.vakata.html.div.empty().append(B.parseHTML(C)).text()}};var A={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};B.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(C,D){var E=B.vakata.dnd._get();E.event=D;B(V).triggerHandler("dnd_"+C+".vakata",E)},_get:function(){return{"data":A.data,"element":A.element,"helper":A.helper}},_clean:function(){if(A.helper){A.helper.remove()}if(A.scroll_i){clearInterval(A.scroll_i);A.scroll_i=false}A={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};B(V).off("mousemove.vakata.jstree touchmove.vakata.jstree",B.vakata.dnd.drag);B(V).off("mouseup.vakata.jstree touchend.vakata.jstree",B.vakata.dnd.stop)},_scroll:function(D){if(!A.scroll_e||(!A.scroll_l&&!A.scroll_t)){if(A.scroll_i){clearInterval(A.scroll_i);A.scroll_i=false}return false}if(!A.scroll_i){A.scroll_i=setInterval(B.vakata.dnd._scroll,100);return false}if(D===true){return false}var E=A.scroll_e.scrollTop(),C=A.scroll_e.scrollLeft();A.scroll_e.scrollTop(E+A.scroll_t*B.vakata.dnd.settings.scroll_speed);A.scroll_e.scrollLeft(C+A.scroll_l*B.vakata.dnd.settings.scroll_speed);if(E!==A.scroll_e.scrollTop()||C!==A.scroll_e.scrollLeft()){B.vakata.dnd._trigger("scroll",A.scroll_e)}},start:function(F,D,E){if(F.type==="touchstart"&&F.originalEvent&&F.originalEvent.changedTouches&&F.originalEvent.changedTouches[0]){F.pageX=F.originalEvent.changedTouches[0].pageX;F.pageY=F.originalEvent.changedTouches[0].pageY;F.target=V.elementFromPoint(F.originalEvent.changedTouches[0].pageX-window.pageXOffset,F.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(A.is_drag){B.vakata.dnd.stop({})}try{F.currentTarget.unselectable="on";F.currentTarget.onselectstart=function(){return false};if(F.currentTarget.style){F.currentTarget.style.MozUserSelect="none"}}catch(C){}A.init_x=F.pageX;A.init_y=F.pageY;A.data=D;A.is_down=true;A.element=F.currentTarget;A.target=F.target;A.is_touch=F.type==="touchstart";if(E!==false){A.helper=B("<div id='vakata-dnd'></div>").html(E).css({"display":"block","margin":"0","padding":"0","position":"absolute","top":"-2000px","lineHeight":"16px","zIndex":"10000"})}B(V).on("mousemove.vakata.jstree touchmove.vakata.jstree",B.vakata.dnd.drag);B(V).on("mouseup.vakata.jstree touchend.vakata.jstree",B.vakata.dnd.stop);return false},drag:function(M){if(M.type==="touchmove"&&M.originalEvent&&M.originalEvent.changedTouches&&M.originalEvent.changedTouches[0]){M.pageX=M.originalEvent.changedTouches[0].pageX;M.pageY=M.originalEvent.changedTouches[0].pageY;M.target=V.elementFromPoint(M.originalEvent.changedTouches[0].pageX-window.pageXOffset,M.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(!A.is_down){return}if(!A.is_drag){if(Math.abs(M.pageX-A.init_x)>(A.is_touch?B.vakata.dnd.settings.threshold_touch:B.vakata.dnd.settings.threshold)||Math.abs(M.pageY-A.init_y)>(A.is_touch?B.vakata.dnd.settings.threshold_touch:B.vakata.dnd.settings.threshold)){if(A.helper){A.helper.appendTo("body");A.helper_w=A.helper.outerWidth()}A.is_drag=true;B.vakata.dnd._trigger("start",M)}else{return}}var K=false,I=false,D=false,H=false,L=false,E=false,J=false,F=false,C=false,G=false;A.scroll_t=0;A.scroll_l=0;A.scroll_e=false;B(B(M.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return(/^auto|scroll$/).test(B(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var O=B(this),N=O.offset();if(this.scrollHeight>this.offsetHeight){if(N.top+O.height()-M.pageY<B.vakata.dnd.settings.scroll_proximity){A.scroll_t=1}if(M.pageY-N.top<B.vakata.dnd.settings.scroll_proximity){A.scroll_t=-1}}if(this.scrollWidth>this.offsetWidth){if(N.left+O.width()-M.pageX<B.vakata.dnd.settings.scroll_proximity){A.scroll_l=1}if(M.pageX-N.left<B.vakata.dnd.settings.scroll_proximity){A.scroll_l=-1}}if(A.scroll_t||A.scroll_l){A.scroll_e=B(this);return false}});if(!A.scroll_e){K=B(V);I=B(window);D=K.height();H=I.height();L=K.width();E=I.width();J=K.scrollTop();F=K.scrollLeft();if(D>H&&M.pageY-J<B.vakata.dnd.settings.scroll_proximity){A.scroll_t=-1}if(D>H&&H-(M.pageY-J)<B.vakata.dnd.settings.scroll_proximity){A.scroll_t=1}if(L>E&&M.pageX-F<B.vakata.dnd.settings.scroll_proximity){A.scroll_l=-1}if(L>E&&E-(M.pageX-F)<B.vakata.dnd.settings.scroll_proximity){A.scroll_l=1}if(A.scroll_t||A.scroll_l){A.scroll_e=K}}if(A.scroll_e){B.vakata.dnd._scroll(true)}if(A.helper){C=parseInt(M.pageY+B.vakata.dnd.settings.helper_top,10);G=parseInt(M.pageX+B.vakata.dnd.settings.helper_left,10);if(D&&C+25>D){C=D-50}if(L&&G+A.helper_w>L){G=L-(A.helper_w+2)}A.helper.css({left:G+"px",top:C+"px"})}B.vakata.dnd._trigger("move",M);return false},stop:function(C){if(C.type==="touchend"&&C.originalEvent&&C.originalEvent.changedTouches&&C.originalEvent.changedTouches[0]){C.pageX=C.originalEvent.changedTouches[0].pageX;C.pageY=C.originalEvent.changedTouches[0].pageY;C.target=V.elementFromPoint(C.originalEvent.changedTouches[0].pageX-window.pageXOffset,C.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(A.is_drag){B.vakata.dnd._trigger("stop",C)}else{if(C.type==="touchend"&&C.target===A.target){var D=setTimeout(function(){B(C.target).click()},100);B(C.target).one("click",function(){if(D){clearTimeout(D)}})}}B.vakata.dnd._clean();return false}}}(S));S.jstree.defaults.massload=null;S.jstree.plugins.massload=function(A,B){this.init=function(C,D){B.init.call(this,C,D);this._data.massload={}};this._load_nodes=function(D,E,C){var F=this.settings.massload;if(C&&!S.isEmptyObject(this._data.massload)){return B._load_nodes.call(this,D,E,C)}if(S.isFunction(F)){return F.call(this,D,S.proxy(function(H){if(H){for(var G in H){if(H.hasOwnProperty(G)){this._data.massload[G]=H[G]}}}B._load_nodes.call(this,D,E,C)},this))}if(typeof F==="object"&&F&&F.url){F=S.extend(true,{},F);if(S.isFunction(F.url)){F.url=F.url.call(this,D)}if(S.isFunction(F.data)){F.data=F.data.call(this,D)}return S.ajax(F).done(S.proxy(function(J,G,I){if(J){for(var H in J){if(J.hasOwnProperty(H)){this._data.massload[H]=J[H]}}}B._load_nodes.call(this,D,E,C)},this)).fail(S.proxy(function(G){B._load_nodes.call(this,D,E,C)},this))}return B._load_nodes.call(this,D,E,C)};this._load_node=function(C,D){var E=this._data.massload[C.id];if(E){return this[typeof E==="string"?"_append_html_data":"_append_json_data"](C,typeof E==="string"?S(S.parseHTML(E)).filter(function(){return this.nodeType!==3}):E,function(F){D.call(this,F);delete this._data.massload[C.id]})}return B._load_node.call(this,C,D)}};S.jstree.defaults.search={ajax:false,fuzzy:false,case_sensitive:false,show_only_matches:false,show_only_matches_children:false,close_opened_onclear:true,search_leaves_only:false,search_callback:false};S.jstree.plugins.search=function(A,B){this.bind=function(){B.bind.call(this);this._data.search.str="";this._data.search.dom=S();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=false;this._data.search.smc=false;this._data.search.hdn=[];this.element.on("search.jstree",S.proxy(function(H,G){if(this._data.search.som&&G.res.length){var F=this._model.data,E,D,C=[];for(E=0,D=G.res.length;E<D;E++){if(F[G.res[E]]&&!F[G.res[E]].state.hidden){C.push(G.res[E]);C=C.concat(F[G.res[E]].parents);if(this._data.search.smc){C=C.concat(F[G.res[E]].children_d)}}}C=S.vakata.array_remove_item(S.vakata.array_unique(C),S.jstree.root);this._data.search.hdn=this.hide_all();this.show_node(C)}},this)).on("clear_search.jstree",S.proxy(function(C,D){if(this._data.search.som&&D.res.length){this.show_node(this._data.search.hdn)}},this))};this.search=function(G,F,J,C,D,M){if(G===false||S.trim(G.toString())===""){return this.clear_search()}C=this.get_node(C);C=C&&C.id?C.id:null;G=G.toString();var O=this.settings.search,H=O.ajax?O.ajax:false,P=this._model.data,I=null,N=[],L=[],E,K;if(this._data.search.res.length&&!D){this.clear_search()}if(J===R){J=O.show_only_matches}if(M===R){M=O.show_only_matches_children}if(!F&&H!==false){if(S.isFunction(H)){return H.call(this,G,S.proxy(function(Q){if(Q&&Q.d){Q=Q.d}this._load_nodes(!S.isArray(Q)?[]:S.vakata.array_unique(Q),function(){this.search(G,true,J,C,D)},true)},this),C)}else{H=S.extend({},H);if(!H.data){H.data={}}H.data.str=G;if(C){H.data.inside=C}return S.ajax(H).fail(S.proxy(function(){this._data.core.last_error={"error":"ajax","plugin":"search","id":"search_01","reason":"Could not load search parents","data":JSON.stringify(H)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(S.proxy(function(Q){if(Q&&Q.d){Q=Q.d}this._load_nodes(!S.isArray(Q)?[]:S.vakata.array_unique(Q),function(){this.search(G,true,J,C,D)},true)},this))}}if(!D){this._data.search.str=G;this._data.search.dom=S();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=J;this._data.search.smc=M}I=new S.vakata.search(G,true,{caseSensitive:O.case_sensitive,fuzzy:O.fuzzy});S.each(P[C?C:S.jstree.root].children_d,function(k,i){var Q=P[i];if(Q.text&&(!O.search_leaves_only||(Q.state.loaded&&Q.children.length===0))&&((O.search_callback&&O.search_callback.call(this,G,Q))||(!O.search_callback&&I.search(Q.text).isMatch))){N.push(i);L=L.concat(Q.parents)}});if(N.length){L=S.vakata.array_unique(L);this._search_open(L);if(!D){this._data.search.dom=S(this.element[0].querySelectorAll("#"+S.map(N,function(Q){return"0123456789".indexOf(Q[0])!==-1?"\\3"+Q[0]+" "+Q.substr(1).replace(S.jstree.idregex,"\\$&"):Q.replace(S.jstree.idregex,"\\$&")}).join(", #")));this._data.search.res=N}else{this._data.search.dom=this._data.search.dom.add(S(this.element[0].querySelectorAll("#"+S.map(N,function(Q){return"0123456789".indexOf(Q[0])!==-1?"\\3"+Q[0]+" "+Q.substr(1).replace(S.jstree.idregex,"\\$&"):Q.replace(S.jstree.idregex,"\\$&")}).join(", #"))));this._data.search.res=S.vakata.array_unique(this._data.search.res.concat(N))}this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:G,res:this._data.search.res,show_only_matches:J})};this.clear_search=function(){if(this.settings.search.close_opened_onclear){this.close_node(this._data.search.opn,0)}this.trigger("clear_search",{"nodes":this._data.search.dom,str:this._data.search.str,res:this._data.search.res});if(this._data.search.res.length){this._data.search.dom=S(this.element[0].querySelectorAll("#"+S.map(this._data.search.res,function(C){return"0123456789".indexOf(C[0])!==-1?"\\3"+C[0]+" "+C.substr(1).replace(S.jstree.idregex,"\\$&"):C.replace(S.jstree.idregex,"\\$&")}).join(", #")));this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")}this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=S()};this._search_open=function(C){var D=this;S.each(C.concat([]),function(F,G){if(G===S.jstree.root){return true}try{G=S("#"+G.replace(S.jstree.idregex,"\\$&"),D.element)}catch(E){}if(G&&G.length){if(D.is_closed(G)){D._data.search.opn.push(G[0].id);D.open_node(G,function(){D._search_open(C)},0)}}})};this.redraw_node=function(F,G,H,E){F=B.redraw_node.apply(this,arguments);if(F){if(S.inArray(F.id,this._data.search.res)!==-1){var I,D,C=null;for(I=0,D=F.childNodes.length;I<D;I++){if(F.childNodes[I]&&F.childNodes[I].className&&F.childNodes[I].className.indexOf("jstree-anchor")!==-1){C=F.childNodes[I];break}}if(C){C.className+=" jstree-search"}}}return F}};(function(A){A.vakata.search=function(L,E,J){J=J||{};J=A.extend({},A.vakata.search.defaults,J);if(J.fuzzy!==false){J.fuzzy=true}L=J.caseSensitive?L:L.toLowerCase();var B=J.location,C=J.distance,H=J.threshold,G=L.length,F,I,K,D;if(G>32){J.fuzzy=false}if(J.fuzzy){F=1<<(G-1);I=(function(){var N={},M=0;for(M=0;M<G;M++){N[L.charAt(M)]=0}for(M=0;M<G;M++){N[L.charAt(M)]|=1<<(G-M-1)}return N}());K=function(N,P){var M=N/G,O=Math.abs(B-P);if(!C){return O?1:M}return M+(O/C)}}D=function(O){O=J.caseSensitive?O:O.toLowerCase();if(L===O||O.indexOf(L)!==-1){return{isMatch:true,score:0}}if(!J.fuzzy){return{isMatch:false,score:1}}var P,y,w=O.length,i=H,v=O.indexOf(L,B),Ab,z,j=G+w,x,M,N,Q,Ac,Aa=1,Ad=[];if(v!==-1){i=Math.min(K(0,v),i);v=O.lastIndexOf(L,B+G);if(v!==-1){i=Math.min(K(0,v),i)}}v=-1;for(P=0;P<G;P++){Ab=0;z=j;while(Ab<z){if(K(P,B+z)<=i){Ab=z}else{j=z}z=Math.floor((j-Ab)/2+Ab)}j=z;M=Math.max(1,B-z+1);N=Math.min(B+z,w)+G;Q=new Array(N+2);Q[N+1]=(1<<P)-1;for(y=N;y>=M;y--){Ac=I[O.charAt(y-1)];if(P===0){Q[y]=((Q[y+1]<<1)|1)&Ac}else{Q[y]=((Q[y+1]<<1)|1)&Ac|(((x[y+1]|x[y])<<1)|1)|x[y+1]}if(Q[y]&F){Aa=K(P,y-1);if(Aa<=i){i=Aa;v=y-1;Ad.push(v);if(v>B){M=Math.max(1,2*B-v)}else{break}}}}if(K(P+1,B)>i){break}x=Q}return{isMatch:v>=0,score:Aa}};return E===true?{"search":D}:D(E)};A.vakata.search.defaults={location:0,distance:100,threshold:0.6,fuzzy:false,caseSensitive:false}}(S));S.jstree.defaults.sort=function(B,A){return this.get_text(B)>this.get_text(A)?1:-1};S.jstree.plugins.sort=function(A,B){this.bind=function(){B.bind.call(this);this.element.on("model.jstree",S.proxy(function(C,D){this.sort(D.parent,true)},this)).on("rename_node.jstree create_node.jstree",S.proxy(function(C,D){this.sort(D.parent||D.node.parent,false);this.redraw_node(D.parent||D.node.parent,true)},this)).on("move_node.jstree copy_node.jstree",S.proxy(function(C,D){this.sort(D.parent,false);this.redraw_node(D.parent,true)},this))};this.sort=function(F,C){var E,D;F=this.get_node(F);if(F&&F.children&&F.children.length){F.children.sort(S.proxy(this.settings.sort,this));if(C){for(E=0,D=F.children_d.length;E<D;E++){this.sort(F.children_d[E],false)}}}}};var d=false;S.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:false,filter:false};S.jstree.plugins.state=function(A,B){this.bind=function(){B.bind.call(this);var C=S.proxy(function(){this.element.on(this.settings.state.events,S.proxy(function(){if(d){clearTimeout(d)}d=setTimeout(S.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",S.proxy(function(E,D){this.element.one("restore_state.jstree",C);if(!this.restore_state()){C()}},this))};this.save_state=function(){var C={"state":this.get_state(),"ttl":this.settings.state.ttl,"sec":+(new Date())};S.vakata.storage.set(this.settings.state.key,JSON.stringify(C))};this.restore_state=function(){var D=S.vakata.storage.get(this.settings.state.key);if(!!D){try{D=JSON.parse(D)}catch(C){return false}}if(!!D&&D.ttl&&D.sec&&+(new Date())-D.sec>D.ttl){return false}if(!!D&&D.state){D=D.state}if(!!D&&S.isFunction(this.settings.state.filter)){D=this.settings.state.filter.call(this,D)}if(!!D){this.element.one("set_state.jstree",function(E,F){F.instance.trigger("restore_state",{"state":S.extend(true,{},D)})});this.set_state(D);return true}return false};this.clear_state=function(){return S.vakata.storage.del(this.settings.state.key)}};(function(B,A){B.vakata.storage={set:function(C,D){return window.localStorage.setItem(C,D)},get:function(C){return window.localStorage.getItem(C)},del:function(C){return window.localStorage.removeItem(C)}}}(S));S.jstree.defaults.types={"default":{}};S.jstree.defaults.types[S.jstree.root]={};S.jstree.plugins.types=function(A,B){this.init=function(E,C){var F,D;if(C&&C.types&&C.types["default"]){for(F in C.types){if(F!=="default"&&F!==S.jstree.root&&C.types.hasOwnProperty(F)){for(D in C.types["default"]){if(C.types["default"].hasOwnProperty(D)&&C.types[F][D]===R){C.types[F][D]=C.types["default"][D]}}}}}B.init.call(this,E,C);this._model.data[S.jstree.root].type=S.jstree.root};this.refresh=function(D,C){B.refresh.call(this,D,C);this._model.data[S.jstree.root].type=S.jstree.root};this.bind=function(){this.element.on("model.jstree",S.proxy(function(I,J){var D=this._model.data,E=J.nodes,G=this.settings.types,F,H,C="default";for(F=0,H=E.length;F<H;F++){C="default";if(D[E[F]].original&&D[E[F]].original.type&&G[D[E[F]].original.type]){C=D[E[F]].original.type}if(D[E[F]].data&&D[E[F]].data.jstree&&D[E[F]].data.jstree.type&&G[D[E[F]].data.jstree.type]){C=D[E[F]].data.jstree.type}D[E[F]].type=C;if(D[E[F]].icon===true&&G[C].icon!==R){D[E[F]].icon=G[C].icon}}D[S.jstree.root].type=S.jstree.root},this));B.bind.call(this)};this.get_json=function(D,E,H){var C,J,F=this._model.data,I=E?S.extend(true,{},E,{no_id:false}):{},G=B.get_json.call(this,D,I,H);if(G===false){return false}if(S.isArray(G)){for(C=0,J=G.length;C<J;C++){G[C].type=G[C].id&&F[G[C].id]&&F[G[C].id].type?F[G[C].id].type:"default";if(E&&E.no_id){delete G[C].id;if(G[C].li_attr&&G[C].li_attr.id){delete G[C].li_attr.id}if(G[C].a_attr&&G[C].a_attr.id){delete G[C].a_attr.id}}}}else{G.type=G.id&&F[G.id]&&F[G.id].type?F[G.id].type:"default";if(E&&E.no_id){G=this._delete_ids(G)}}return G};this._delete_ids=function(D){if(S.isArray(D)){for(var E=0,C=D.length;E<C;E++){D[E]=this._delete_ids(D[E])}return D}delete D.id;if(D.li_attr&&D.li_attr.id){delete D.li_attr.id}if(D.a_attr&&D.a_attr.id){delete D.a_attr.id}if(D.children&&S.isArray(D.children)){D.children=this._delete_ids(D.children)}return D};this.check=function(H,G,I,D,K){if(B.check.call(this,H,G,I,D,K)===false){return false}G=G&&G.id?G:this.get_node(G);I=I&&I.id?I:this.get_node(I);var J=G&&G.id?(K&&K.origin?K.origin:S.jstree.reference(G.id)):null,E,L,F,C;J=J&&J._model&&J._model.data?J._model.data:null;switch(H){case"create_node":case"move_node":case"copy_node":if(H!=="move_node"||S.inArray(G.id,I.children)===-1){E=this.get_rules(I);if(E.max_children!==R&&E.max_children!==-1&&E.max_children===I.children.length){this._data.core.last_error={"error":"check","plugin":"types","id":"types_01","reason":"max_children prevents function: "+H,"data":JSON.stringify({"chk":H,"pos":D,"obj":G&&G.id?G.id:false,"par":I&&I.id?I.id:false})};return false}if(E.valid_children!==R&&E.valid_children!==-1&&S.inArray((G.type||"default"),E.valid_children)===-1){this._data.core.last_error={"error":"check","plugin":"types","id":"types_02","reason":"valid_children prevents function: "+H,"data":JSON.stringify({"chk":H,"pos":D,"obj":G&&G.id?G.id:false,"par":I&&I.id?I.id:false})};return false}if(J&&G.children_d&&G.parents){L=0;for(F=0,C=G.children_d.length;F<C;F++){L=Math.max(L,J[G.children_d[F]].parents.length)}L=L-G.parents.length+1}if(L<=0||L===R){L=1}do{if(E.max_depth!==R&&E.max_depth!==-1&&E.max_depth<L){this._data.core.last_error={"error":"check","plugin":"types","id":"types_03","reason":"max_depth prevents function: "+H,"data":JSON.stringify({"chk":H,"pos":D,"obj":G&&G.id?G.id:false,"par":I&&I.id?I.id:false})};return false}I=this.get_node(I.parent);E=this.get_rules(I);L++}while(I)}break}return true};this.get_rules=function(D){D=this.get_node(D);if(!D){return false}var C=this.get_type(D,true);if(C.max_depth===R){C.max_depth=-1}if(C.max_children===R){C.max_children=-1}if(C.valid_children===R){C.valid_children=-1}return C};this.get_type=function(C,D){C=this.get_node(C);return(!C)?false:(D?S.extend({"type":C.type},this.settings.types[C.type]):C.type)};this.set_type=function(F,H){var G,E,I,D,C;if(S.isArray(F)){F=F.slice();for(E=0,I=F.length;E<I;E++){this.set_type(F[E],H)}return true}G=this.settings.types;F=this.get_node(F);if(!G[H]||!F){return false}D=F.type;C=this.get_icon(F);F.type=H;if(C===true||(G[D]&&G[D].icon!==R&&C===G[D].icon)){this.set_icon(F,G[H].icon!==R?G[H].icon:true)}return true}};S.jstree.defaults.unique={case_sensitive:false,duplicate:function(B,A){return B+" ("+A+")"}};S.jstree.plugins.unique=function(A,B){this.check=function(C,H,I,E,K){if(B.check.call(this,C,H,I,E,K)===false){return false}H=H&&H.id?H:this.get_node(H);I=I&&I.id?I:this.get_node(I);if(!I||!I.children){return true}var G=C==="rename_node"?E:H.text,M=[],L=this.settings.unique.case_sensitive,J=this._model.data,F,D;for(F=0,D=I.children.length;F<D;F++){M.push(L?J[I.children[F]].text:J[I.children[F]].text.toLowerCase())}if(!L){G=G.toLowerCase()}switch(C){case"delete_node":return true;case"rename_node":F=(S.inArray(G,M)===-1||(H.text&&H.text[L?"toString":"toLowerCase"]()===G));if(!F){this._data.core.last_error={"error":"check","plugin":"unique","id":"unique_01","reason":"Child with name "+G+" already exists. Preventing: "+C,"data":JSON.stringify({"chk":C,"pos":E,"obj":H&&H.id?H.id:false,"par":I&&I.id?I.id:false})}}return F;case"create_node":F=(S.inArray(G,M)===-1);if(!F){this._data.core.last_error={"error":"check","plugin":"unique","id":"unique_04","reason":"Child with name "+G+" already exists. Preventing: "+C,"data":JSON.stringify({"chk":C,"pos":E,"obj":H&&H.id?H.id:false,"par":I&&I.id?I.id:false})}}return F;case"copy_node":F=(S.inArray(G,M)===-1);if(!F){this._data.core.last_error={"error":"check","plugin":"unique","id":"unique_02","reason":"Child with name "+G+" already exists. Preventing: "+C,"data":JSON.stringify({"chk":C,"pos":E,"obj":H&&H.id?H.id:false,"par":I&&I.id?I.id:false})}}return F;case"move_node":F=((H.parent===I.id&&(!K||!K.is_multi))||S.inArray(G,M)===-1);if(!F){this._data.core.last_error={"error":"check","plugin":"unique","id":"unique_03","reason":"Child with name "+G+" already exists. Preventing: "+C,"data":JSON.stringify({"chk":C,"pos":E,"obj":H&&H.id?H.id:false,"par":I&&I.id?I.id:false})}}return F}return true};this.create_node=function(G,J,O,N,L){if(!J||J.text===R){if(G===null){G=S.jstree.root}G=this.get_node(G);if(!G){return B.create_node.call(this,G,J,O,N,L)}O=O===R?"last":O;if(!O.toString().match(/^(before|after)$/)&&!L&&!this.is_loaded(G)){return B.create_node.call(this,G,J,O,N,L)}if(!J){J={}}var F,I,C,M,H,E=this._model.data,D=this.settings.unique.case_sensitive,K=this.settings.unique.duplicate;I=F=this.get_string("New node");C=[];for(M=0,H=G.children.length;M<H;M++){C.push(D?E[G.children[M]].text:E[G.children[M]].text.toLowerCase())}M=1;while(S.inArray(D?I:I.toLowerCase(),C)!==-1){I=K.call(this,F,(++M)).toString()}J.text=I}return B.create_node.call(this,G,J,O,N,L)}};var h=V.createElement("DIV");h.setAttribute("unselectable","on");h.setAttribute("role","presentation");h.className="jstree-wholerow";h.innerHTML="&#160;";S.jstree.plugins.wholerow=function(A,B){this.bind=function(){B.bind.call(this);this.element.on("ready.jstree set_state.jstree",S.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",S.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",S.proxy(function(C,D){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",S.proxy(function(D,E){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var F=false,G,C;for(G=0,C=E.selected.length;G<C;G++){F=this.get_node(E.selected[G],true);if(F&&F.length){F.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}}},this)).on("open_node.jstree",S.proxy(function(C,D){this.get_node(D.node,true).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",S.proxy(function(C,D){if(C.type==="hover_node"&&this.is_disabled(D.node)){return}this.get_node(D.node,true).children(".jstree-wholerow")[C.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",S.proxy(function(D){D.preventDefault();var C=S.Event("contextmenu",{metaKey:D.metaKey,ctrlKey:D.ctrlKey,altKey:D.altKey,shiftKey:D.shiftKey,pageX:D.pageX,pageY:D.pageY});S(D.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(C)},this)).on("click.jstree",".jstree-wholerow",function(D){D.stopImmediatePropagation();var C=S.Event("click",{metaKey:D.metaKey,ctrlKey:D.ctrlKey,altKey:D.altKey,shiftKey:D.shiftKey});S(D.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(C).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",S.proxy(function(D){D.stopImmediatePropagation();var C=S.Event("click",{metaKey:D.metaKey,ctrlKey:D.ctrlKey,altKey:D.altKey,shiftKey:D.shiftKey});S(D.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(C).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",S.proxy(function(C){C.stopImmediatePropagation();if(!this.is_disabled(C.currentTarget)){this.hover_node(C.currentTarget)}return false},this)).on("mouseleave.jstree",".jstree-node",S.proxy(function(C){this.dehover_node(C.currentTarget)},this))};this.teardown=function(){if(this.settings.wholerow){this.element.find(".jstree-wholerow").remove()}B.teardown.call(this)};this.redraw_node=function(G,D,F,E){G=B.redraw_node.apply(this,arguments);if(G){var C=h.cloneNode(true);if(S.inArray(G.id,this._data.core.selected)!==-1){C.className+=" jstree-wholerow-clicked"}if(this._data.core.focused&&this._data.core.focused===G.id){C.className+=" jstree-wholerow-hovered"}G.insertBefore(C,G.childNodes[0])}return G}};if(V.registerElement&&Object&&Object.create){var g=Object.create(HTMLElement.prototype);g.createdCallback=function(){var B={core:{},plugins:[]},A;for(A in S.jstree.plugins){if(S.jstree.plugins.hasOwnProperty(A)&&this.attributes[A]){B.plugins.push(A);if(this.getAttribute(A)&&JSON.parse(this.getAttribute(A))){B[A]=JSON.parse(this.getAttribute(A))}}}for(A in S.jstree.defaults.core){if(S.jstree.defaults.core.hasOwnProperty(A)&&this.attributes[A]){B.core[A]=JSON.parse(this.getAttribute(A))||this.getAttribute(A)}}S(this).jstree(B)};try{V.registerElement("vakata-jstree",{prototype:g})}catch(a){}}return S.fn.jstree}));