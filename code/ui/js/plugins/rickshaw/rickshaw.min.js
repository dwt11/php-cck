(function(D,C){if(typeof define==="function"&&define.amd){define(["d3"],function(A){return D.Rickshaw=C(A)})}else{if(typeof exports==="object"){module.exports=C(require("d3"))}else{D.Rickshaw=C(d3)}}})(this,function(C){var D={namespace:function(M,K){var J=M.split(".");var B=D;for(var A=1,L=J.length;A<L;A++){var N=J[A];B[N]=B[N]||{};B=B[N]}return B},keys:function(A){var B=[];for(var F in A){B.push(F)}return B},extend:function(F,A){for(var B in A){F[B]=A[B]}return F},clone:function(A){return JSON.parse(JSON.stringify(A))}};(function(o){var h=Object.prototype.toString,b="Null",e="Undefined",q="Boolean",a="Number",n="String",r="Object",d="[object Function]";function Y(E){return h.call(E)===d}function m(F,E){for(var G in E){if(E.hasOwnProperty(G)){F[G]=E[G]}}return F}function Z(F){if(g(F)!==r){throw new TypeError}var G=[];for(var E in F){if(F.hasOwnProperty(E)){G.push(E)}}return G}function g(E){switch(E){case null:return b;case void 0:return e}var F=typeof E;switch(F){case"boolean":return q;case"number":return a;case"string":return n}return r}function p(E){return typeof E==="undefined"}var j=Array.prototype.slice;function l(F){var E=F.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return E.length==1&&!E[0]?[]:E}function c(E,F){var G=E;return function(){var H=B([f(G,this)],arguments);return F.apply(this,H)}}function B(E,F){var G=E.length,H=F.length;while(H--){E[G+H]=F[H]}return E}function k(F,E){F=j.call(F,0);return B(F,E)}function f(E,G){if(arguments.length<2&&p(arguments[0])){return this}var H=E,F=j.call(arguments,2);return function(){var I=k(F,arguments);return H.apply(G,I)}}var A=function(){};var i=function(){var G=function(){for(var I in {toString:1}){if(I==="toString"){return false}}return true}();function F(){}function E(){var M=null,I=[].slice.apply(arguments);if(Y(I[0])){M=I.shift()}function J(){this.initialize.apply(this,arguments)}m(J,i.Methods);J.superclass=M;J.subclasses=[];if(M){F.prototype=M.prototype;J.prototype=new F;try{M.subclasses.push(J)}catch(K){}}for(var L=0,N=I.length;L<N;L++){J.addMethods(I[L])}if(!J.prototype.initialize){J.prototype.initialize=A}J.prototype.constructor=J;return J}function H(O){var K=this.superclass&&this.superclass.prototype,L=Z(O);if(G){if(O.toString!=Object.prototype.toString){L.push("toString")}if(O.valueOf!=Object.prototype.valueOf){L.push("valueOf")}}for(var N=0,P=L.length;N<P;N++){var M=L[N],I=O[M];if(K&&Y(I)&&l(I)[0]=="$super"){var J=I;I=c(function(Q){return function(){return K[Q].apply(this,arguments)}}(M),J);I.valueOf=f(J.valueOf,J);I.toString=f(J.toString,J)}this.prototype[M]=I}return this}return{create:E,Methods:{addMethods:H}}}();if(o.exports){o.exports.Class=i}else{o.Class=i}})(D);D.namespace("Rickshaw.Compat.ClassList");D.Compat.ClassList=function(){if(typeof document!=="undefined"&&!("classList" in document.createElement("a"))){(function(S){var R="classList",X="prototype",a=(S.HTMLElement||S.Element)[X],V=Object,B=String[X].trim||function(){return this.replace(/^\s+|\s+$/g,"")},Z=Array[X].indexOf||function(E){var G=0,F=this.length;for(;G<F;G++){if(G in this&&this[G]===E){return G}}return -1},A=function(F,E){this.name=F;this.code=DOMException[F];this.message=E},Q=function(E,F){if(F===""){throw new A("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(F)){throw new A("INVALID_CHARACTER_ERR","String contains an invalid character")}return Z.call(E,F)},W=function(F){var E=B.call(F.className),I=E?E.split(/\s+/):[],G=0,H=I.length;for(;G<H;G++){this.push(I[G])}this._updateClassName=function(){F.className=this.toString()}},U=W[X]=[],T=function(){return new W(this)};A[X]=Error[X];U.item=function(E){return this[E]||null};U.contains=function(E){E+="";return Q(this,E)!==-1};U.add=function(E){E+="";if(Q(this,E)===-1){this.push(E);this._updateClassName()}};U.remove=function(F){F+="";var E=Q(this,F);if(E!==-1){this.splice(E,1);this._updateClassName()}};U.toggle=function(E){E+="";if(Q(this,E)===-1){this.add(E)}else{this.remove(E)}};U.toString=function(){return this.join(" ")};if(V.defineProperty){var Y={get:T,enumerable:true,configurable:true};try{V.defineProperty(a,R,Y)}catch(b){if(b.number===-2146823252){Y.enumerable=false;V.defineProperty(a,R,Y)}}}else{if(V[X].__defineGetter__){a.__defineGetter__(R,T)}}})(window)}};if(typeof RICKSHAW_NO_COMPAT!=="undefined"&&!RICKSHAW_NO_COMPAT||typeof RICKSHAW_NO_COMPAT==="undefined"){new D.Compat.ClassList}D.namespace("Rickshaw.Graph");D.Graph=function(A){var B=this;this.initialize=function(F){if(!F.element){throw"Rickshaw.Graph needs a reference to an element"}if(F.element.nodeType!==1){throw"Rickshaw.Graph element was defined but not an HTML element"}this.element=F.element;this.series=F.series;this.window={};this.updateCallbacks=[];this.configureCallbacks=[];this.defaults={interpolation:"cardinal",offset:"zero",min:undefined,max:undefined,preserve:false,xScale:undefined,yScale:undefined,stack:true};this._loadRenderers();this.configure(F);this.validateSeries(F.series);this.series.active=function(){return B.series.filter(function(E){return !E.disabled})};this.setSize({width:F.width,height:F.height});this.element.classList.add("rickshaw_graph");this.vis=C.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);this.discoverRange()};this._loadRenderers=function(){for(var G in D.Graph.Renderer){if(!G||!D.Graph.Renderer.hasOwnProperty(G)){continue}var H=D.Graph.Renderer[G];if(!H||!H.prototype||!H.prototype.render){continue}B.registerRenderer(new H({graph:B}))}};this.validateSeries=function(I){if(!Array.isArray(I)&&!(I instanceof D.Series)){var J=Object.prototype.toString.apply(I);throw"series is not an array: "+J}var H;I.forEach(function(E){if(!(E instanceof Object)){throw"series element is not an object: "+E}if(!E.data){throw"series has no data: "+JSON.stringify(E)}if(!Array.isArray(E.data)){throw"series data is not an array: "+JSON.stringify(E.data)}if(E.data.length>0){var F=E.data[0].x;var G=E.data[0].y;if(typeof F!="number"||typeof G!="number"&&G!==null){throw"x and y properties of points should be numbers instead of "+typeof F+" and "+typeof G}}if(E.data.length>=3){if(E.data[2].x<E.data[1].x||E.data[1].x<E.data[0].x||E.data[E.data.length-1].x<E.data[0].x){throw"series data needs to be sorted on x values for series name: "+E.name}}},this)};this.dataDomain=function(){var I=this.series.map(function(E){return E.data});var J=C.min(I.map(function(E){return E[0].x}));var H=C.max(I.map(function(E){return E[E.length-1].x}));return[J,H]};this.discoverRange=function(){var F=this.renderer.domain();this.x=(this.xScale||C.scale.linear()).copy().domain(F.x).range([0,this.width]);this.y=(this.yScale||C.scale.linear()).copy().domain(F.y).range([this.height,0]);this.x.magnitude=C.scale.linear().domain([F.x[0]-F.x[0],F.x[1]-F.x[0]]).range([0,this.width]);this.y.magnitude=C.scale.linear().domain([F.y[0]-F.y[0],F.y[1]-F.y[0]]).range([0,this.height])};this.render=function(){var F=this.stackData();this.discoverRange();this.renderer.render();this.updateCallbacks.forEach(function(E){E()})};this.update=this.render;this.stackData=function(){var L=this.series.active().map(function(E){return E.data}).map(function(E){return E.filter(function(F){return this._slice(F)},this)},this);var J=this.preserve;if(!J){this.series.forEach(function(E){if(E.scale){J=true}})}L=J?D.clone(L):L;this.series.active().forEach(function(E,G){if(E.scale){var F=L[G];if(F){F.forEach(function(H){H.y=E.scale(H.y)})}}});this.stackData.hooks.data.forEach(function(E){L=E.f.apply(B,[L])});var K;if(!this.renderer.unstack){this._validateStackable();var N=C.layout.stack();N.offset(B.offset);K=N(L)}K=K||L;if(this.renderer.unstack){K.forEach(function(E){E.forEach(function(F){F.y0=F.y0===undefined?0:F.y0})})}this.stackData.hooks.after.forEach(function(E){K=E.f.apply(B,[L])});var M=0;this.series.forEach(function(E){if(E.disabled){return}E.stack=K[M++]});this.stackedData=K;return K};this._validateStackable=function(){var G=this.series;var H;G.forEach(function(E){H=H||E.data.length;if(H&&E.data.length!=H){throw"stacked series cannot have differing numbers of points: "+H+" vs "+E.data.length+"; see Rickshaw.Series.fill()"}},this)};this.stackData.hooks={data:[],after:[]};this._slice=function(H){if(this.window.xMin||this.window.xMax){var G=true;if(this.window.xMin&&H.x<this.window.xMin){G=false}if(this.window.xMax&&H.x>this.window.xMax){G=false}return G}return true};this.onUpdate=function(F){this.updateCallbacks.push(F)};this.onConfigure=function(F){this.configureCallbacks.push(F)};this.registerRenderer=function(F){this._renderers=this._renderers||{};this._renderers[F.name]=F};this.configure=function(G){this.config=this.config||{};if(G.width||G.height){this.setSize(G)}D.keys(this.defaults).forEach(function(E){this.config[E]=E in G?G[E]:E in this?this[E]:this.defaults[E]},this);D.keys(this.config).forEach(function(E){this[E]=this.config[E]},this);if("stack" in G){G.unstack=!G.stack}var H=G.renderer||this.renderer&&this.renderer.name||"stack";this.setRenderer(H,G);this.configureCallbacks.forEach(function(E){E(G)})};this.setRenderer=function(H,G){if(typeof H=="function"){this.renderer=new H({graph:B});this.registerRenderer(this.renderer)}else{if(!this._renderers[H]){throw"couldn't find renderer "+H}this.renderer=this._renderers[H]}if(typeof G=="object"){this.renderer.configure(G)}};this.setSize=function(J){J=J||{};if(typeof window!==undefined){var I=window.getComputedStyle(this.element,null);var L=parseInt(I.getPropertyValue("width"),10);var K=parseInt(I.getPropertyValue("height"),10)}this.width=J.width||L||400;this.height=J.height||K||250;this.vis&&this.vis.attr("width",this.width).attr("height",this.height)};this.initialize(A)};D.namespace("Rickshaw.Fixtures.Color");D.Fixtures.Color=function(){this.schemes={};this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse();this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"];this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"];this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse();this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"};this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse();this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"];this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]};D.namespace("Rickshaw.Fixtures.RandomData");D.Fixtures.RandomData=function(H){var G;H=H||1;var A=200;var B=Math.floor((new Date).getTime()/1000);this.addData=function(L){var E=Math.random()*100+15+A;var F=L[0].length;var K=1;L.forEach(function(N){var I=Math.random()*20;var J=E/25+K+++(Math.cos(F*K*11/960)+2)*15+(Math.cos(F/7)+2)*7+(Math.cos(F/17)+2)*1;N.push({x:F*H+B,y:J+I})});A=E*0.85};this.removeData=function(E){E.forEach(function(F){F.shift()});B+=H}};D.namespace("Rickshaw.Fixtures.Time");D.Fixtures.Time=function(){var A=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(B){return parseInt(B.getUTCFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(B){return B.getUTCFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(B){return A.months[B.getUTCMonth()]}},{name:"week",seconds:86400*7,formatter:function(B){return A.formatDate(B)}},{name:"day",seconds:86400,formatter:function(B){return B.getUTCDate()}},{name:"6 hour",seconds:3600*6,formatter:function(B){return A.formatTime(B)}},{name:"hour",seconds:3600,formatter:function(B){return A.formatTime(B)}},{name:"15 minute",seconds:60*15,formatter:function(B){return A.formatTime(B)}},{name:"minute",seconds:60,formatter:function(B){return B.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(B){return B.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(B){return B.getUTCSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(B){return B.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(B){return B.getUTCMilliseconds()+"ms"}}];this.unit=function(B){return this.units.filter(function(F){return B==F.name}).shift()};this.formatDate=function(B){return C.time.format("%b %e")(B)};this.formatTime=function(B){return B.toUTCString().match(/(\d+:\d+):/)[1]};this.ceil=function(B,L){var J,K,N;if(L.name=="month"){J=new Date(B*1000);K=Date.UTC(J.getUTCFullYear(),J.getUTCMonth())/1000;if(K==B){return B}N=J.getUTCFullYear();var M=J.getUTCMonth();if(M==11){M=0;N=N+1}else{M+=1}return Date.UTC(N,M)/1000}if(L.name=="year"){J=new Date(B*1000);K=Date.UTC(J.getUTCFullYear(),0)/1000;if(K==B){return B}N=J.getUTCFullYear()+1;return Date.UTC(N,0)/1000}return Math.ceil(B/L.seconds)*L.seconds}};D.namespace("Rickshaw.Fixtures.Time.Local");D.Fixtures.Time.Local=function(){var A=this;this.months=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(B){return parseInt(B.getFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(B){return B.getFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(B){return A.months[B.getMonth()]}},{name:"week",seconds:86400*7,formatter:function(B){return A.formatDate(B)}},{name:"day",seconds:86400,formatter:function(B){return B.getDate()}},{name:"6 hour",seconds:3600*6,formatter:function(B){return A.formatTime(B)}},{name:"hour",seconds:3600,formatter:function(B){return A.formatTime(B)}},{name:"15 minute",seconds:60*15,formatter:function(B){return A.formatTime(B)}},{name:"minute",seconds:60,formatter:function(B){return B.getMinutes()}},{name:"15 second",seconds:15,formatter:function(B){return B.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(B){return B.getSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(B){return B.getMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(B){return B.getMilliseconds()+"ms"}}];this.unit=function(B){return this.units.filter(function(F){return B==F.name}).shift()};this.formatDate=function(B){return C.time.format("%b %e")(B)};this.formatTime=function(B){return B.toString().match(/(\d+:\d+):/)[1]};this.ceil=function(P,R){var B,N,M;if(R.name=="day"){var O=new Date((P+R.seconds-1)*1000);var L=new Date(0);L.setMilliseconds(0);L.setSeconds(0);L.setMinutes(0);L.setHours(0);L.setDate(O.getDate());L.setMonth(O.getMonth());L.setFullYear(O.getFullYear());return L.getTime()/1000}if(R.name=="month"){B=new Date(P*1000);N=new Date(B.getFullYear(),B.getMonth()).getTime()/1000;if(N==P){return P}M=B.getFullYear();var Q=B.getMonth();if(Q==11){Q=0;M=M+1}else{Q+=1}return new Date(M,Q).getTime()/1000}if(R.name=="year"){B=new Date(P*1000);N=new Date(B.getUTCFullYear(),0).getTime()/1000;if(N==P){return P}M=B.getFullYear()+1;return new Date(M,0).getTime()/1000}return Math.ceil(P/R.seconds)*R.seconds}};D.namespace("Rickshaw.Fixtures.Number");D.Fixtures.Number.formatKMBT=function(A){var B=Math.abs(A);if(B>=1000000000000){return A/1000000000000+"T"}else{if(B>=1000000000){return A/1000000000+"B"}else{if(B>=1000000){return A/1000000+"M"}else{if(B>=1000){return A/1000+"K"}else{if(B<1&&A>0){return A.toFixed(2)}else{if(B===0){return""}else{return A}}}}}}};D.Fixtures.Number.formatBase1024KMGTP=function(A){var B=Math.abs(A);if(B>=1.12589990684262e+15){return A/1.12589990684262e+15+"P"}else{if(B>=1099511627776){return A/1099511627776+"T"}else{if(B>=1073741824){return A/1073741824+"G"}else{if(B>=1048576){return A/1048576+"M"}else{if(B>=1024){return A/1024+"K"}else{if(B<1&&A>0){return A.toFixed(2)}else{if(B===0){return""}else{return A}}}}}}}};D.namespace("Rickshaw.Color.Palette");D.Color.Palette=function(J){var B=new D.Fixtures.Color;J=J||{};this.schemes={};this.scheme=B.schemes[J.scheme]||J.scheme||B.schemes.colorwheel;this.runningIndex=0;this.generatorIndex=0;if(J.interpolatedStopCount){var K=this.scheme.length-1;var L,N,M=[];for(L=0;L<K;L++){M.push(this.scheme[L]);var A=C.interpolateHsl(this.scheme[L],this.scheme[L+1]);for(N=1;N<J.interpolatedStopCount;N++){M.push(A(1/J.interpolatedStopCount*N))}}M.push(this.scheme[this.scheme.length-1]);this.scheme=M}this.rotateCount=this.scheme.length;this.color=function(E){return this.scheme[E]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"};this.interpolateColor=function(){if(!Array.isArray(this.scheme)){return}var E;if(this.generatorIndex==this.rotateCount*2-1){E=C.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(0.5);this.generatorIndex=0;this.rotateCount*=2}else{E=C.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(0.5);this.generatorIndex++}this.scheme.push(E);return E}};D.namespace("Rickshaw.Graph.Ajax");D.Graph.Ajax=D.Class.create({initialize:function(A){this.dataURL=A.dataURL;this.onData=A.onData||function(B){return B};this.onComplete=A.onComplete||function(){};this.onError=A.onError||function(){};this.args=A;this.request()},request:function(){jQuery.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL);this.onError(this)},success:function(A,B){A=this.onData(A);this.args.series=this._splice({data:A,series:this.args.series});this.graph=this.graph||new D.Graph(this.args);this.graph.render();this.onComplete(this)},_splice:function(B){var F=B.data;var A=B.series;if(!B.series){return F}A.forEach(function(E){var H=E.key||E.name;if(!H){throw"series needs a key or a name"}F.forEach(function(K){var G=K.key||K.name;if(!G){throw"data needs a key or a name"}if(H==G){var L=["color","name","data"];L.forEach(function(I){if(K[I]){E[I]=K[I]}})}})});return A}});D.namespace("Rickshaw.Graph.Annotate");D.Graph.Annotate=function(B){var A=this.graph=B.graph;this.elements={intimeline:B.element};var F=this;this.data={};this.elements.intimeline.classList.add("rickshaw_annotation_intimeline");this.add=function(E,I,J){F.data[E]=F.data[E]||{boxes:[]};F.data[E].boxes.push({content:I,end:J})};this.update=function(){D.keys(F.data).forEach(function(J){var E=F.data[J];var K=F.graph.x(J);if(K<0||K>F.graph.x.range()[1]){if(E.element){E.line.classList.add("offscreen");E.element.style.display="none"}E.boxes.forEach(function(G){if(G.rangeElement){G.rangeElement.classList.add("offscreen")}});return}if(!E.element){var L=E.element=document.createElement("div");L.classList.add("annotation");this.elements.intimeline.appendChild(L);L.addEventListener("click",function(G){L.classList.toggle("active");E.line.classList.toggle("active");E.boxes.forEach(function(H){if(H.rangeElement){H.rangeElement.classList.toggle("active")}})},false)}E.element.style.left=K+"px";E.element.style.display="block";E.boxes.forEach(function(P){var H=P.element;if(!H){H=P.element=document.createElement("div");H.classList.add("content");H.innerHTML=P.content;E.element.appendChild(H);E.line=document.createElement("div");E.line.classList.add("annotation_line");F.graph.element.appendChild(E.line);if(P.end){P.rangeElement=document.createElement("div");P.rangeElement.classList.add("annotation_range");F.graph.element.appendChild(P.rangeElement)}}if(P.end){var O=K;var I=Math.min(F.graph.x(P.end),F.graph.x.range()[1]);if(O>I){I=K;O=Math.max(F.graph.x(P.end),F.graph.x.range()[0])}var G=I-O;P.rangeElement.style.left=O+"px";P.rangeElement.style.width=G+"px";P.rangeElement.classList.remove("offscreen")}E.line.classList.remove("offscreen");E.line.style.left=K+"px"})},this)};this.graph.onUpdate(function(){F.update()})};D.namespace("Rickshaw.Graph.Axis.Time");D.Graph.Axis.Time=function(B){var F=this;this.graph=B.graph;this.elements=[];this.ticksTreatment=B.ticksTreatment||"plain";this.fixedTimeUnit=B.timeUnit;var A=B.timeFixture||new D.Fixtures.Time;this.appropriateTimeUnit=function(){var J;var E=A.units;var K=this.graph.x.domain();var L=K[1]-K[0];E.forEach(function(G){if(Math.floor(L/G.seconds)>=2){J=J||G}});return J||A.units[A.units.length-1]};this.tickOffsets=function(){var P=this.graph.x.domain();var N=this.fixedTimeUnit||this.appropriateTimeUnit();var M=Math.ceil((P[1]-P[0])/N.seconds);var R=P[0];var E=[];for(var O=0;O<M;O++){var Q=A.ceil(R,N);R=Q+N.seconds/2;E.push({value:Q,unit:N})}return E};this.render=function(){this.elements.forEach(function(H){H.parentNode.removeChild(H)});this.elements=[];var E=this.tickOffsets();E.forEach(function(K){if(F.graph.x(K.value)>F.graph.x.range()[1]){return}var L=document.createElement("div");L.style.left=F.graph.x(K.value)+"px";L.classList.add("x_tick");L.classList.add(F.ticksTreatment);var J=document.createElement("div");J.classList.add("title");J.innerHTML=K.unit.formatter(new Date(K.value*1000));L.appendChild(J);F.graph.element.appendChild(L);F.elements.push(L)})};this.graph.onUpdate(function(){F.render()})};D.namespace("Rickshaw.Graph.Axis.X");D.Graph.Axis.X=function(B){var F=this;var A=0.1;this.initialize=function(E){this.graph=E.graph;this.orientation=E.orientation||"top";this.pixelsPerTick=E.pixelsPerTick||75;if(E.ticks){this.staticTicks=E.ticks}if(E.tickValues){this.tickValues=E.tickValues}this.tickSize=E.tickSize||4;this.ticksTreatment=E.ticksTreatment||"plain";if(E.element){this.element=E.element;this._discoverSize(E.element,E);this.vis=C.select(E.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:E.width,height:E.height})}else{this.vis=this.graph.vis}this.graph.onUpdate(function(){F.render()})};this.setSize=function(H){H=H||{};if(!this.element){return}this._discoverSize(this.element.parentNode,H);this.vis.attr("height",this.height).attr("width",this.width*(1+A));var E=Math.floor(this.width*A/2);this.element.style.left=-1*E+"px"};this.render=function(){if(this._renderWidth!==undefined&&this.graph.width!==this._renderWidth){this.setSize({auto:true})}var N=C.svg.axis().scale(this.graph.x).orient(this.orientation);N.tickFormat(B.tickFormat||function(G){return G});if(this.tickValues){N.tickValues(this.tickValues)}this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var E=Math.floor(this.width*A/2)||0;var K;if(this.orientation=="top"){var L=this.height||this.graph.height;K="translate("+E+","+L+")"}else{K="translate("+E+", 0)"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",K).call(N.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var M=(this.orientation=="bottom"?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(N.ticks(this.ticks).tickSubdivide(0).tickSize(M)).selectAll("text").each(function(){this.parentNode.setAttribute("data-x-value",this.textContent)});this._renderHeight=this.graph.height};this._discoverSize=function(L,N){if(typeof window!=="undefined"){var K=window.getComputedStyle(L,null);var E=parseInt(K.getPropertyValue("height"),10);if(!N.auto){var M=parseInt(K.getPropertyValue("width"),10)}}this.width=(N.width||M||this.graph.width)*(1+A);this.height=N.height||E||40};this.initialize(B)};D.namespace("Rickshaw.Graph.Axis.Y");D.Graph.Axis.Y=D.Class.create({initialize:function(A){this.graph=A.graph;this.orientation=A.orientation||"right";this.pixelsPerTick=A.pixelsPerTick||75;if(A.ticks){this.staticTicks=A.ticks}if(A.tickValues){this.tickValues=A.tickValues}this.tickSize=A.tickSize||4;this.ticksTreatment=A.ticksTreatment||"plain";this.tickFormat=A.tickFormat||function(F){return F};this.berthRate=0.1;if(A.element){this.element=A.element;this.vis=C.select(A.element).append("svg:svg").attr("class","rickshaw_graph y_axis");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:A.width,height:A.height})}else{this.vis=this.graph.vis}var B=this;this.graph.onUpdate(function(){B.render()})},setSize:function(B){B=B||{};if(!this.element){return}if(typeof window!=="undefined"){var I=window.getComputedStyle(this.element.parentNode,null);var H=parseInt(I.getPropertyValue("width"),10);if(!B.auto){var A=parseInt(I.getPropertyValue("height"),10)}}this.width=B.width||H||this.graph.width*this.berthRate;this.height=B.height||A||this.graph.height;this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var J=this.height*this.berthRate;if(this.orientation=="left"){this.element.style.top=-1*J+"px"}},render:function(){if(this._renderHeight!==undefined&&this.graph.height!==this._renderHeight){this.setSize({auto:true})}this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var A=this._drawAxis(this.graph.y);this._drawGrid(A);this._renderHeight=this.graph.height},_drawAxis:function(G){var A=C.svg.axis().scale(G).orient(this.orientation);A.tickFormat(this.tickFormat);if(this.tickValues){A.tickValues(this.tickValues)}if(this.orientation=="left"){var H=this.height*this.berthRate;var B="translate("+this.width+", "+H+")"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",B).call(A.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));return A},_drawGrid:function(A){var B=(this.orientation=="right"?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(A.ticks(this.ticks).tickSubdivide(0).tickSize(B)).selectAll("text").each(function(){this.parentNode.setAttribute("data-y-value",this.textContent)})}});D.namespace("Rickshaw.Graph.Axis.Y.Scaled");D.Graph.Axis.Y.Scaled=D.Class.create(D.Graph.Axis.Y,{initialize:function($super,A){if(typeof A.scale==="undefined"){throw new Error("Scaled requires scale")}this.scale=A.scale;if(typeof A.grid==="undefined"){this.grid=true}else{this.grid=A.grid}$super(A)},_drawAxis:function($super,N){var B=this.scale.domain();var M=this.graph.renderer.domain().y;var P=[Math.min.apply(Math,B),Math.max.apply(Math,B)];var L=C.scale.linear().domain([0,1]).range(P);var K=[L(M[0]),L(M[1])];var A=C.scale.linear().domain(P).range(K);var O=this.scale.copy().domain(B.map(A)).range(N.range());return $super(O)},_drawGrid:function($super,A){if(this.grid){$super(A)}}});D.namespace("Rickshaw.Graph.Behavior.Series.Highlight");D.Graph.Behavior.Series.Highlight=function(B){this.graph=B.graph;this.legend=B.legend;var H=this;var A={};var J=null;var I=B.disabledColor||function(E){return C.interpolateRgb(E,C.rgb("#d8d8d8"))(0.8).toString()};this.addHighlightEvents=function(E){E.element.addEventListener("mouseover",function(F){if(J){return}else{J=E}H.legend.lines.forEach(function(M){if(E===M){if(H.graph.renderer.unstack&&(M.series.renderer?M.series.renderer.unstack:true)){var N=H.graph.series.indexOf(M.series);M.originalIndex=N;var G=H.graph.series.splice(N,1)[0];H.graph.series.push(G)}return}A[M.series.name]=A[M.series.name]||M.series.color;M.series.color=I(M.series.color)});H.graph.update()},false);E.element.addEventListener("mouseout",function(F){if(!J){return}else{J=null}H.legend.lines.forEach(function(G){if(E===G&&G.hasOwnProperty("originalIndex")){var L=H.graph.series.pop();H.graph.series.splice(G.originalIndex,0,L);delete G.originalIndex}if(A[G.series.name]){G.series.color=A[G.series.name]}});H.graph.update()},false)};if(this.legend){this.legend.lines.forEach(function(E){H.addHighlightEvents(E)})}};D.namespace("Rickshaw.Graph.Behavior.Series.Order");D.Graph.Behavior.Series.Order=function(A){this.graph=A.graph;this.legend=A.legend;var B=this;if(typeof window.jQuery=="undefined"){throw"couldn't find jQuery at window.jQuery"}if(typeof window.jQuery.ui=="undefined"){throw"couldn't find jQuery UI at window.jQuery.ui"}jQuery(function(){jQuery(B.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(J,L){var I=[];jQuery(B.legend.list).find("li").each(function(F,E){if(!E.series){return}I.push(E.series)});for(var K=B.graph.series.length-1;K>=0;K--){B.graph.series[K]=I.shift()}B.graph.update()}});jQuery(B.legend.list).disableSelection()});this.graph.onUpdate(function(){var F=window.getComputedStyle(B.legend.element).height;B.legend.element.style.height=F})};D.namespace("Rickshaw.Graph.Behavior.Series.Toggle");D.Graph.Behavior.Series.Toggle=function(B){this.graph=B.graph;this.legend=B.legend;var F=this;this.addAnchor=function(I){var E=document.createElement("a");E.innerHTML="&#10004;";E.classList.add("action");I.element.insertBefore(E,I.element.firstChild);E.onclick=function(G){if(I.series.disabled){I.series.enable();I.element.classList.remove("disabled")}else{if(this.graph.series.filter(function(H){return !H.disabled}).length<=1){return}I.series.disable();I.element.classList.add("disabled")}}.bind(this);var J=I.element.getElementsByTagName("span")[0];J.onclick=function(N){var M=I.series.disabled;if(!M){for(var H=0;H<F.legend.lines.length;H++){var G=F.legend.lines[H];if(I.series===G.series){}else{if(G.series.disabled){}else{M=true;break}}}}if(M){I.series.enable();I.element.classList.remove("disabled");F.legend.lines.forEach(function(K){if(I.series===K.series){}else{K.series.disable();K.element.classList.add("disabled")}})}else{F.legend.lines.forEach(function(K){K.series.enable();K.element.classList.remove("disabled")})}}};if(this.legend){var A=jQuery;if(typeof A!="undefined"&&A(this.legend.list).sortable){A(this.legend.list).sortable({start:function(H,E){E.item.bind("no.onclick",function(G){G.preventDefault()})},stop:function(H,E){setTimeout(function(){E.item.unbind("no.onclick")},250)}})}this.legend.lines.forEach(function(E){F.addAnchor(E)})}this._addBehavior=function(){this.graph.series.forEach(function(E){E.disable=function(){if(F.graph.series.length<=1){throw"only one series left"}E.disabled=true;F.graph.update()};E.enable=function(){E.disabled=false;F.graph.update()}})};this._addBehavior();this.updateBehaviour=function(){this._addBehavior()}};D.namespace("Rickshaw.Graph.HoverDetail");D.Graph.HoverDetail=D.Class.create({initialize:function(B){var F=this.graph=B.graph;this.xFormatter=B.xFormatter||function(E){return new Date(E*1000).toUTCString()};this.yFormatter=B.yFormatter||function(E){return E===null?E:E.toFixed(2)};var A=this.element=document.createElement("div");A.className="detail";this.visible=true;F.element.appendChild(A);this.lastEvent=null;this._addListeners();this.onShow=B.onShow;this.onHide=B.onHide;this.onRender=B.onRender;this.formatter=B.formatter||this.formatter},formatter:function(A,J,B,K,L,I){return A.name+":&nbsp;"+L},update:function(M){M=M||this.lastEvent;if(!M){return}this.lastEvent=M;if(!M.target.nodeName.match(/^(path|svg|rect|circle)$/)){return}var Q=this.graph;var N=M.offsetX||M.layerX;var P=M.offsetY||M.layerY;var O=0;var R=[];var A;this.graph.series.active().forEach(function(a){var H=this.graph.stackedData[O++];if(!H.length){return}var Z=Q.x.invert(N);var G=C.scale.linear().domain([H[0].x,H.slice(-1)[0].x]).range([0,H.length-1]);var F=Math.round(G(Z));if(F==H.length-1){F--}var J=Math.min(F||0,H.length-1);for(var X=F;X<H.length-1;){if(!H[X]||!H[X+1]){break}if(H[X].x<=Z&&H[X+1].x>Z){J=Math.abs(Z-H[X].x)<Math.abs(Z-H[X+1].x)?X:X+1;break}if(H[X+1].x<=Z){X++}else{X--}}if(J<0){J=0}var K=H[J];var I=Math.sqrt(Math.pow(Math.abs(Q.x(K.x)-N),2)+Math.pow(Math.abs(Q.y(K.y+K.y0)-P),2));var Y=a.xFormatter||this.xFormatter;var b=a.yFormatter||this.yFormatter;var E={formattedXValue:Y(K.x),formattedYValue:b(a.scale?a.scale.invert(K.y):K.y),series:a,value:K,distance:I,order:O,name:a.name};if(!A||I<A.distance){A=E}R.push(E)},this);if(!A){return}A.active=true;var L=A.value.x;var B=A.formattedXValue;this.element.innerHTML="";this.element.style.left=Q.x(L)+"px";this.visible&&this.render({points:R,detail:R,mouseX:N,mouseY:P,formattedXValue:B,domainX:L})},hide:function(){this.visible=false;this.element.classList.add("inactive");if(typeof this.onHide=="function"){this.onHide()}},show:function(){this.visible=true;this.element.classList.remove("inactive");if(typeof this.onShow=="function"){this.onShow()}},render:function(Y){var Z=this.graph;var U=Y.points;var X=U.filter(function(E){return E.active}).shift();if(X.value.y===null){return}var Q=X.formattedXValue;var R=X.formattedYValue;this.element.innerHTML="";this.element.style.left=Z.x(X.value.x)+"px";var S=document.createElement("div");S.className="x_label";S.innerHTML=Q;this.element.appendChild(S);var a=document.createElement("div");a.className="item";var A=X.series;var V=A.scale?A.scale.invert(X.value.y):X.value.y;a.innerHTML=this.formatter(A,X.value.x,V,Q,R,X);a.style.top=this.graph.y(X.value.y0+X.value.y)+"px";this.element.appendChild(a);var W=document.createElement("div");W.className="dot";W.style.top=a.style.top;W.style.borderColor=A.color;this.element.appendChild(W);if(X.active){a.classList.add("active");W.classList.add("active")}var T=[S,a];T.forEach(function(E){E.classList.add("left")});this.show();var b=this._calcLayoutError(T);if(b>0){T.forEach(function(E){E.classList.remove("left");E.classList.add("right")});var B=this._calcLayoutError(T);if(B>b){T.forEach(function(E){E.classList.remove("right");E.classList.add("left")})}}if(typeof this.onRender=="function"){this.onRender(Y)}},_calcLayoutError:function(H){var G=this.element.parentNode.getBoundingClientRect();var A=0;var B=H.forEach(function(F){var E=F.getBoundingClientRect();if(!E.width){return}if(E.right>G.right){A+=E.right-G.right}if(E.left<G.left){A+=G.left-E.left}});return A},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(A){this.visible=true;this.update(A)}.bind(this),false);this.graph.onUpdate(function(){this.update()}.bind(this));this.graph.element.addEventListener("mouseout",function(A){if(A.relatedTarget&&!(A.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS)){this.hide()}}.bind(this),false)}});D.namespace("Rickshaw.Graph.JSONP");D.Graph.JSONP=D.Class.create(D.Graph.Ajax,{request:function(){jQuery.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}});D.namespace("Rickshaw.Graph.Legend");D.Graph.Legend=D.Class.create({className:"rickshaw_legend",initialize:function(A){this.element=A.element;this.graph=A.graph;this.naturalOrder=A.naturalOrder;this.element.classList.add(this.className);this.list=document.createElement("ul");this.element.appendChild(this.list);this.render();this.graph.onUpdate(function(){})},render:function(){var B=this;while(this.list.firstChild){this.list.removeChild(this.list.firstChild)}this.lines=[];var A=this.graph.series.map(function(F){return F});if(!this.naturalOrder){A=A.reverse()}A.forEach(function(F){B.addLine(F)})},addLine:function(A){var B=document.createElement("li");B.className="line";if(A.disabled){B.className+=" disabled"}if(A.className){C.select(B).classed(A.className,true)}var I=document.createElement("div");I.className="swatch";I.style.backgroundColor=A.color;B.appendChild(I);var J=document.createElement("span");J.className="label";J.innerHTML=A.name;B.appendChild(J);this.list.appendChild(B);B.series=A;if(A.noLegend){B.style.display="none"}var H={element:B,series:A};if(this.shelving){this.shelving.addAnchor(H);this.shelving.updateBehaviour()}if(this.highlighter){this.highlighter.addHighlightEvents(H)}this.lines.push(H);return B}});D.namespace("Rickshaw.Graph.RangeSlider");D.Graph.RangeSlider=D.Class.create({initialize:function(B){var A=this.element=B.element;var F=this.graph=B.graph;this.slideCallbacks=[];this.build();F.onUpdate(function(){this.update()}.bind(this))},build:function(){var I=this.element;var H=this.graph;var B=jQuery;var A=H.dataDomain();var J=this;B(function(){B(I).slider({range:true,min:A[0],max:A[1],values:[A[0],A[1]],slide:function(F,E){if(E.values[1]<=E.values[0]){return}H.window.xMin=E.values[0];H.window.xMax=E.values[1];H.update();var G=H.dataDomain();if(G[0]==E.values[0]){H.window.xMin=undefined}if(G[1]==E.values[1]){H.window.xMax=undefined}J.slideCallbacks.forEach(function(L){L(H,H.window.xMin,H.window.xMax)})}})});B(I)[0].style.width=H.width+"px"},update:function(){var I=this.element;var H=this.graph;var B=jQuery;var J=B(I).slider("option","values");var A=H.dataDomain();B(I).slider("option","min",A[0]);B(I).slider("option","max",A[1]);if(H.window.xMin==null){J[0]=A[0]}if(H.window.xMax==null){J[1]=A[1]}B(I).slider("option","values",J)},onSlide:function(A){this.slideCallbacks.push(A)}});D.namespace("Rickshaw.Graph.RangeSlider.Preview");D.Graph.RangeSlider.Preview=D.Class.create({initialize:function(A){if(!A.element){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an element"}if(!A.graph&&!A.graphs){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an graph or an array of graphs"}this.element=A.element;this.element.style.position="relative";this.graphs=A.graph?[A.graph]:A.graphs;this.defaults={height:75,width:400,gripperColor:undefined,frameTopThickness:3,frameHandleThickness:10,frameColor:"#d4d4d4",frameOpacity:1,minimumFrameWidth:0,heightRatio:0.2};this.heightRatio=A.heightRatio||this.defaults.heightRatio;this.defaults.gripperColor=C.rgb(this.defaults.frameColor).darker().toString();this.configureCallbacks=[];this.slideCallbacks=[];this.previews=[];if(!A.width){this.widthFromGraph=true}if(!A.height){this.heightFromGraph=true}if(this.widthFromGraph||this.heightFromGraph){this.graphs[0].onConfigure(function(){this.configure(A);this.render()}.bind(this))}A.width=A.width||this.graphs[0].width||this.defaults.width;A.height=A.height||this.graphs[0].height*this.heightRatio||this.defaults.height;this.configure(A);this.render()},onSlide:function(A){this.slideCallbacks.push(A)},onConfigure:function(A){this.configureCallbacks.push(A)},configure:function(A){this.config=this.config||{};this.configureCallbacks.forEach(function(B){B(A)});D.keys(this.defaults).forEach(function(B){this.config[B]=B in A?A[B]:B in this.config?this.config[B]:this.defaults[B]},this);if("width" in A||"height" in A){if(this.widthFromGraph){this.config.width=this.graphs[0].width}if(this.heightFromGraph){this.config.height=this.graphs[0].height*this.heightRatio;this.previewHeight=this.config.height}this.previews.forEach(function(K){var B=this.previewHeight/this.graphs.length-this.config.frameTopThickness*2;var I=this.config.width-this.config.frameHandleThickness*2;K.setSize({width:I,height:B});if(this.svg){var L=B+this.config.frameHandleThickness*2;var J=I+this.config.frameHandleThickness*2;this.svg.style("width",J+"px");this.svg.style("height",L+"px")}},this)}},render:function(){var J=this;this.svg=C.select(this.element).selectAll("svg.rickshaw_range_slider_preview").data([null]);this.previewHeight=this.config.height-this.config.frameTopThickness*2;this.previewWidth=this.config.width-this.config.frameHandleThickness*2;this.currentFrame=[0,this.previewWidth];var B=function(G,F){var E=D.extend({},G.config);var P=J.previewHeight/J.graphs.length;var I=G.renderer.name;D.extend(E,{element:this.appendChild(document.createElement("div")),height:P,width:J.previewWidth,series:G.series,renderer:I});var H=new D.Graph(E);J.previews.push(H);G.onUpdate(function(){H.render();J.render()});G.onConfigure(function(O){delete O.height;O.width=O.width-J.config.frameHandleThickness*2;H.configure(O);H.render()});H.render()};var N=C.select(this.element).selectAll("div.rickshaw_range_slider_preview_container").data(this.graphs);var A="translate("+this.config.frameHandleThickness+"px, "+this.config.frameTopThickness+"px)";N.enter().append("div").classed("rickshaw_range_slider_preview_container",true).style("-webkit-transform",A).style("-moz-transform",A).style("-ms-transform",A).style("transform",A).each(B);N.exit().remove();var K=this.graphs[0];var L=C.scale.linear().domain([0,this.previewWidth]).range(K.dataDomain());var M=[K.window.xMin,K.window.xMax];this.currentFrame[0]=M[0]===undefined?0:Math.round(L.invert(M[0]));if(this.currentFrame[0]<0){this.currentFrame[0]=0}this.currentFrame[1]=M[1]===undefined?this.previewWidth:L.invert(M[1]);if(this.currentFrame[1]-this.currentFrame[0]<J.config.minimumFrameWidth){this.currentFrame[1]=(this.currentFrame[0]||0)+J.config.minimumFrameWidth}this.svg.enter().append("svg").classed("rickshaw_range_slider_preview",true).style("height",this.config.height+"px").style("width",this.config.width+"px").style("position","absolute").style("top",0);this._renderDimming();this._renderFrame();this._renderGrippers();this._renderHandles();this._renderMiddle();this._registerMouseEvents()},_renderDimming:function(){var B=this.svg.selectAll("path.dimming").data([null]);B.enter().append("path").attr("fill","white").attr("fill-opacity","0.7").attr("fill-rule","evenodd").classed("dimming",true);var A="";A+=" M "+this.config.frameHandleThickness+" "+this.config.frameTopThickness;A+=" h "+this.previewWidth;A+=" v "+this.previewHeight;A+=" h "+-this.previewWidth;A+=" z ";A+=" M "+Math.max(this.currentFrame[0],this.config.frameHandleThickness)+" "+this.config.frameTopThickness;A+=" H "+Math.min(this.currentFrame[1]+this.config.frameHandleThickness*2,this.previewWidth+this.config.frameHandleThickness);A+=" v "+this.previewHeight;A+=" H "+Math.max(this.currentFrame[0],this.config.frameHandleThickness);A+=" z";B.attr("d",A)},_renderFrame:function(){var B=this.svg.selectAll("path.frame").data([null]);B.enter().append("path").attr("stroke","white").attr("stroke-width","1px").attr("stroke-linejoin","round").attr("fill",this.config.frameColor).attr("fill-opacity",this.config.frameOpacity).attr("fill-rule","evenodd").classed("frame",true);var A="";A+=" M "+this.currentFrame[0]+" 0";A+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness*2);A+=" V "+this.config.height;A+=" H "+this.currentFrame[0];A+=" z";A+=" M "+(this.currentFrame[0]+this.config.frameHandleThickness)+" "+this.config.frameTopThickness;A+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness);A+=" v "+this.previewHeight;A+=" H "+(this.currentFrame[0]+this.config.frameHandleThickness);A+=" z";B.attr("d",A)},_renderGrippers:function(){var B=this.svg.selectAll("path.gripper").data([null]);B.enter().append("path").attr("stroke",this.config.gripperColor).classed("gripper",true);var A="";[0.4,0.6].forEach(function(F){A+=" M "+Math.round(this.currentFrame[0]+this.config.frameHandleThickness*F)+" "+Math.round(this.config.height*0.3);A+=" V "+Math.round(this.config.height*0.7);A+=" M "+Math.round(this.currentFrame[1]+this.config.frameHandleThickness*(1+F))+" "+Math.round(this.config.height*0.3);A+=" V "+Math.round(this.config.height*0.7)}.bind(this));B.attr("d",A)},_renderHandles:function(){var B=this.svg.selectAll("rect.left_handle").data([null]);B.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("left_handle",true);B.attr("x",this.currentFrame[0]).attr("height",this.config.height);var A=this.svg.selectAll("rect.right_handle").data([null]);A.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("right_handle",true);A.attr("x",this.currentFrame[1]+this.config.frameHandleThickness).attr("height",this.config.height)},_renderMiddle:function(){var A=this.svg.selectAll("rect.middle_handle").data([null]);A.enter().append("rect").style("cursor","move").style("fill-opacity","0").classed("middle_handle",true);A.attr("width",Math.max(0,this.currentFrame[1]-this.currentFrame[0])).attr("x",this.currentFrame[0]+this.config.frameHandleThickness).attr("height",this.config.height)},_registerMouseEvents:function(){var M=C.select(this.element);var O={target:null,start:null,stop:null,left:false,right:false,rigid:false};var Q=this;function P(I,H){O.stop=Q._getClientXFromEvent(C.event,O);var G=O.stop-O.start;var F=Q.frameBeforeDrag.slice(0);var J=Q.config.minimumFrameWidth;if(O.rigid){J=Q.frameBeforeDrag[1]-Q.frameBeforeDrag[0]}if(O.left){F[0]=Math.max(F[0]+G,0)}if(O.right){F[1]=Math.min(F[1]+G,Q.previewWidth)}var E=F[1]-F[0];if(E<=J){if(O.left){F[0]=F[1]-J}if(O.right){F[1]=F[0]+J}if(F[0]<=0){F[1]-=F[0];F[0]=0}if(F[1]>=Q.previewWidth){F[0]-=F[1]-Q.previewWidth;F[1]=Q.previewWidth}}Q.graphs.forEach(function(U){var V=C.scale.linear().interpolate(C.interpolateNumber).domain([0,Q.previewWidth]).range(U.dataDomain());var K=[V(F[0]),V(F[1])];Q.slideCallbacks.forEach(function(S){S(U,K[0],K[1])});if(F[0]===0){K[0]=undefined}if(F[1]===Q.previewWidth){K[1]=undefined}U.window.xMin=K[0];U.window.xMax=K[1];U.update()})}function B(){O.target=C.event.target;O.start=Q._getClientXFromEvent(C.event,O);Q.frameBeforeDrag=Q.currentFrame.slice();C.event.preventDefault?C.event.preventDefault():C.event.returnValue=false;C.select(document).on("mousemove.rickshaw_range_slider_preview",P);C.select(document).on("mouseup.rickshaw_range_slider_preview",L);C.select(document).on("touchmove.rickshaw_range_slider_preview",P);C.select(document).on("touchend.rickshaw_range_slider_preview",L);C.select(document).on("touchcancel.rickshaw_range_slider_preview",L)}function R(F,E){O.left=true;B()}function A(F,E){O.right=true;B()}function N(F,E){O.left=true;O.right=true;O.rigid=true;B()}function L(F,E){C.select(document).on("mousemove.rickshaw_range_slider_preview",null);C.select(document).on("mouseup.rickshaw_range_slider_preview",null);C.select(document).on("touchmove.rickshaw_range_slider_preview",null);C.select(document).on("touchend.rickshaw_range_slider_preview",null);C.select(document).on("touchcancel.rickshaw_range_slider_preview",null);delete Q.frameBeforeDrag;O.left=false;O.right=false;O.rigid=false}M.select("rect.left_handle").on("mousedown",R);M.select("rect.right_handle").on("mousedown",A);M.select("rect.middle_handle").on("mousedown",N);M.select("rect.left_handle").on("touchstart",R);M.select("rect.right_handle").on("touchstart",A);M.select("rect.middle_handle").on("touchstart",N)},_getClientXFromEvent:function(I,J){switch(I.type){case"touchstart":case"touchmove":var B=I.changedTouches;var A=null;for(var H=0;H<B.length;H++){if(B[H].target===J.target){A=B[H];break}}return A!==null?A.clientX:undefined;default:return I.clientX}}});D.namespace("Rickshaw.Graph.Renderer");D.Graph.Renderer=D.Class.create({initialize:function(A){this.graph=A.graph;this.tension=A.tension||this.tension;this.configure(A)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:0.8,strokeWidth:2,unstack:true,padding:{top:0.01,right:0,bottom:0.01,left:0},stroke:false,fill:false}},domain:function(B){var L=B||this.graph.stackedData||this.graph.stackData();var J=+Infinity;var I=-Infinity;var K=+Infinity;var A=-Infinity;L.forEach(function(E){E.forEach(function(G){if(G.y==null){return}var F=G.y+G.y0;if(F<K){K=F}if(F>A){A=F}});if(!E.length){return}if(E[0].x<J){J=E[0].x}if(E[E.length-1].x>I){I=E[E.length-1].x}});J-=(I-J)*this.padding.left;I+=(I-J)*this.padding.right;K=this.graph.min==="auto"?K:this.graph.min||0;A=this.graph.max===undefined?A:this.graph.max;if(this.graph.min==="auto"||K<0){K-=(A-K)*this.padding.bottom}if(this.graph.max===undefined){A+=(A-K)*this.padding.top}return{x:[J,I],y:[K,A]}},render:function(K){K=K||{};var O=this.graph;var P=K.series||O.series;var M=K.vis||O.vis;M.selectAll("*").remove();var L=P.filter(function(E){return !E.disabled}).map(function(E){return E.stack});var N=M.selectAll("path.path").data(L).enter().append("svg:path").classed("path",true).attr("d",this.seriesPathFactory());if(this.stroke){var B=M.selectAll("path.stroke").data(L).enter().append("svg:path").classed("stroke",true).attr("d",this.seriesStrokeFactory())}var A=0;P.forEach(function(E){if(E.disabled){return}E.path=N[0][A];if(this.stroke){E.stroke=B[0][A]}this._styleSeries(E);A++},this)},_styleSeries:function(B){var F=this.fill?B.color:"none";var A=this.stroke?B.color:"none";B.path.setAttribute("fill",F);B.path.setAttribute("stroke",A);B.path.setAttribute("stroke-width",this.strokeWidth);if(B.className){C.select(B.path).classed(B.className,true)}if(B.className&&this.stroke){C.select(B.stroke).classed(B.className,true)}},configure:function(A){A=A||{};D.keys(this.defaults()).forEach(function(B){if(!A.hasOwnProperty(B)){this[B]=this[B]||this.graph[B]||this.defaults()[B];return}if(typeof this.defaults()[B]=="object"){D.keys(this.defaults()[B]).forEach(function(F){this[B][F]=A[B][F]!==undefined?A[B][F]:this[B][F]!==undefined?this[B][F]:this.defaults()[B][F]},this)}else{this[B]=A[B]!==undefined?A[B]:this[B]!==undefined?this[B]:this.graph[B]!==undefined?this.graph[B]:this.defaults()[B]}},this)},setStrokeWidth:function(A){if(A!==undefined){this.strokeWidth=A}},setTension:function(A){if(A!==undefined){this.tension=A}}});D.namespace("Rickshaw.Graph.Renderer.Line");D.Graph.Renderer.Line=D.Class.create(D.Graph.Renderer,{name:"line",defaults:function($super){return D.extend($super(),{unstack:true,fill:false,stroke:true})},seriesPathFactory:function(){var B=this.graph;var A=C.svg.line().x(function(F){return B.x(F.x)}).y(function(F){return B.y(F.y)}).interpolate(this.graph.interpolation).tension(this.tension);A.defined&&A.defined(function(F){return F.y!==null});return A}});D.namespace("Rickshaw.Graph.Renderer.Stack");D.Graph.Renderer.Stack=D.Class.create(D.Graph.Renderer,{name:"stack",defaults:function($super){return D.extend($super(),{fill:true,stroke:false,unstack:false})},seriesPathFactory:function(){var B=this.graph;var A=C.svg.area().x(function(F){return B.x(F.x)}).y0(function(F){return B.y(F.y0)}).y1(function(F){return B.y(F.y+F.y0)}).interpolate(this.graph.interpolation).tension(this.tension);A.defined&&A.defined(function(F){return F.y!==null});return A}});D.namespace("Rickshaw.Graph.Renderer.Bar");D.Graph.Renderer.Bar=D.Class.create(D.Graph.Renderer,{name:"bar",defaults:function($super){var A=D.extend($super(),{gapSize:0.05,unstack:false});delete A.tension;return A},initialize:function($super,A){A=A||{};this.gapSize=A.gapSize||this.gapSize;$super(A)},domain:function($super){var A=$super();var B=this._frequentInterval(this.graph.stackedData.slice(-1).shift());A.x[1]+=Number(B.magnitude);return A},barWidth:function(A){var F=this._frequentInterval(A.stack);var B=this.graph.x.magnitude(F.magnitude)*(1-this.gapSize);return B},render:function(Q){Q=Q||{};var N=this.graph;var R=Q.series||N.series;var B=Q.vis||N.vis;B.selectAll("*").remove();var O=this.barWidth(R.active()[0]);var M=0;var P=R.filter(function(E){return !E.disabled}).length;var A=this.unstack?O/P:O;var L=function(F){var E=[1,0,0,F.y<0?-1:1,0,F.y<0?N.y.magnitude(Math.abs(F.y))*2:0];return"matrix("+E.join(",")+")"};R.forEach(function(G){if(G.disabled){return}var E=this.barWidth(G);var F=B.selectAll("path").data(G.stack.filter(function(H){return H.y!==null})).enter().append("svg:rect").attr("x",function(H){return N.x(H.x)+M}).attr("y",function(H){return N.y(H.y0+Math.abs(H.y))*(H.y<0?-1:1)}).attr("width",A).attr("height",function(H){return N.y.magnitude(Math.abs(H.y))}).attr("transform",L);Array.prototype.forEach.call(F[0],function(H){H.setAttribute("fill",G.color)});if(this.unstack){M+=A}},this)},_frequentInterval:function(B){var I={};for(var J=0;J<B.length-1;J++){var H=B[J+1].x-B[J].x;I[H]=I[H]||0;I[H]++}var A={count:0,magnitude:1};D.keys(I).forEach(function(E){if(A.count<I[E]){A={count:I[E],magnitude:E}}});return A}});D.namespace("Rickshaw.Graph.Renderer.Area");D.Graph.Renderer.Area=D.Class.create(D.Graph.Renderer,{name:"area",defaults:function($super){return D.extend($super(),{unstack:false,fill:false,stroke:false})},seriesPathFactory:function(){var B=this.graph;var A=C.svg.area().x(function(F){return B.x(F.x)}).y0(function(F){return B.y(F.y0)}).y1(function(F){return B.y(F.y+F.y0)}).interpolate(B.interpolation).tension(this.tension);A.defined&&A.defined(function(F){return F.y!==null});return A},seriesStrokeFactory:function(){var B=this.graph;var A=C.svg.line().x(function(F){return B.x(F.x)}).y(function(F){return B.y(F.y+F.y0)}).interpolate(B.interpolation).tension(this.tension);A.defined&&A.defined(function(F){return F.y!==null});return A},render:function(K){K=K||{};var N=this.graph;var B=K.series||N.series;var L=K.vis||N.vis;L.selectAll("*").remove();var A=this.unstack?"append":"insert";var O=B.filter(function(E){return !E.disabled}).map(function(E){return E.stack});var P=L.selectAll("path").data(O).enter()[A]("svg:g","g");P.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area");if(this.stroke){P.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line")}var M=0;B.forEach(function(E){if(E.disabled){return}E.path=P[0][M++];this._styleSeries(E)},this)},_styleSeries:function(A){if(!A.path){return}C.select(A.path).select(".area").attr("fill",A.color);if(this.stroke){C.select(A.path).select(".line").attr("fill","none").attr("stroke",A.stroke||C.interpolateRgb(A.color,"black")(0.125)).attr("stroke-width",this.strokeWidth)}if(A.className){A.path.setAttribute("class",A.className)}}});D.namespace("Rickshaw.Graph.Renderer.ScatterPlot");D.Graph.Renderer.ScatterPlot=D.Class.create(D.Graph.Renderer,{name:"scatterplot",defaults:function($super){return D.extend($super(),{unstack:true,fill:true,stroke:false,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:4})},initialize:function($super,A){$super(A)},render:function(B){B=B||{};var J=this.graph;var I=B.series||J.series;var A=B.vis||J.vis;var H=this.dotSize;A.selectAll("*").remove();I.forEach(function(F){if(F.disabled){return}var E=A.selectAll("path").data(F.stack.filter(function(G){return G.y!==null})).enter().append("svg:circle").attr("cx",function(G){return J.x(G.x)}).attr("cy",function(G){return J.y(G.y)}).attr("r",function(G){return"r" in G?G.r:H});if(F.className){E.classed(F.className,true)}Array.prototype.forEach.call(E[0],function(G){G.setAttribute("fill",F.color)})},this)}});D.namespace("Rickshaw.Graph.Renderer.Multi");D.Graph.Renderer.Multi=D.Class.create(D.Graph.Renderer,{name:"multi",initialize:function($super,A){$super(A)},defaults:function($super){return D.extend($super(),{unstack:true,fill:false,stroke:true})},configure:function($super,A){A=A||{};this.config=A;$super(A)},domain:function($super){this.graph.stackData();var B=[];var K=this._groups();this._stack(K);K.forEach(function(F){var E=F.series.filter(function(H){return !H.disabled}).map(function(H){return H.stack});if(!E.length){return}var G=null;if(F.renderer&&F.renderer.domain){G=F.renderer.domain(E)}else{G=$super(E)}B.push(G)});var A=C.min(B.map(function(E){return E.x[0]}));var I=C.max(B.map(function(E){return E.x[1]}));var L=C.min(B.map(function(E){return E.y[0]}));var J=C.max(B.map(function(E){return E.y[1]}));return{x:[A,I],y:[L,J]}},_groups:function(){var A=this.graph;var B={};A.series.forEach(function(M){if(M.disabled){return}if(!B[M.renderer]){var E="http://www.w3.org/2000/svg";var P=document.createElementNS(E,"g");A.vis[0][0].appendChild(P);var L=A._renderers[M.renderer];var N={};var O=[this.defaults(),L.defaults(),this.config,this.graph];O.forEach(function(G){D.extend(N,G)});L.configure(N);B[M.renderer]={renderer:L,series:[],vis:C.select(P)}}B[M.renderer].series.push(M)},this);var F=[];Object.keys(B).forEach(function(E){var H=B[E];F.push(H)});return F},_stack:function(A){A.forEach(function(J){var I=J.series.filter(function(E){return !E.disabled});var B=I.map(function(E){return E.stack});if(!J.renderer.unstack){var K=C.layout.stack();var L=D.clone(K(B));I.forEach(function(F,E){F._stack=D.clone(L[E])})}},this);return A},render:function(){this.graph.series.forEach(function(B){if(!B.renderer){throw new Error("Each series needs a renderer for graph 'multi' renderer")}});this.graph.vis.selectAll("*").remove();var A=this._groups();A=this._stack(A);A.forEach(function(B){var F=B.series.filter(function(E){return !E.disabled});F.active=function(){return F};B.renderer.render({series:F,vis:B.vis});F.forEach(function(E){E.stack=E._stack||E.stack||E.data})})}});D.namespace("Rickshaw.Graph.Renderer.LinePlot");D.Graph.Renderer.LinePlot=D.Class.create(D.Graph.Renderer,{name:"lineplot",defaults:function($super){return D.extend($super(),{unstack:true,fill:false,stroke:true,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:3,strokeWidth:2})},seriesPathFactory:function(){var B=this.graph;var A=C.svg.line().x(function(F){return B.x(F.x)}).y(function(F){return B.y(F.y)}).interpolate(this.graph.interpolation).tension(this.tension);A.defined&&A.defined(function(F){return F.y!==null});return A},render:function(N){N=N||{};var O=this.graph;var B=N.series||O.series;var M=N.vis||O.vis;var K=this.dotSize;M.selectAll("*").remove();var L=B.filter(function(E){return !E.disabled}).map(function(E){return E.stack});var P=M.selectAll("path").data(L).enter().append("svg:path").attr("d",this.seriesPathFactory());var A=0;B.forEach(function(E){if(E.disabled){return}E.path=P[0][A++];this._styleSeries(E)},this);B.forEach(function(F){if(F.disabled){return}var E=M.selectAll("x").data(F.stack.filter(function(G){return G.y!==null})).enter().append("svg:circle").attr("cx",function(G){return O.x(G.x)}).attr("cy",function(G){return O.y(G.y)}).attr("r",function(G){return"r" in G?G.r:K});Array.prototype.forEach.call(E[0],function(G){if(!G){return}G.setAttribute("data-color",F.color);G.setAttribute("fill","white");G.setAttribute("stroke",F.color);G.setAttribute("stroke-width",this.strokeWidth)}.bind(this))},this)}});D.namespace("Rickshaw.Graph.Smoother");D.Graph.Smoother=D.Class.create({initialize:function(A){this.graph=A.graph;this.element=A.element;this.aggregationScale=1;this.build();this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var B=this;var A=jQuery;if(this.element){A(function(){A(B.element).slider({min:1,max:100,slide:function(G,H){B.setScale(H.value);B.graph.update()}})})}},setScale:function(A){if(A<1){throw"scale out of range: "+A}this.aggregationScale=A;this.graph.update()},transformer:function(A){if(this.aggregationScale==1){return A}var B=[];A.forEach(function(K){var M=[];while(K.length){var J=0,L=0;var N=K.splice(0,this.aggregationScale);N.forEach(function(E){J+=E.x/N.length;L+=E.y/N.length});M.push({x:J,y:L})}B.push(M)}.bind(this));return B}});D.namespace("Rickshaw.Graph.Socketio");D.Graph.Socketio=D.Class.create(D.Graph.Ajax,{request:function(){var A=io.connect(this.dataURL);var B=this;A.on("rickshaw",function(F){B.success(F)})}});D.namespace("Rickshaw.Series");D.Series=D.Class.create(Array,{initialize:function(A,G,B){B=B||{};this.palette=new D.Color.Palette(G);this.timeBase=typeof B.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):B.timeBase;var H=typeof B.timeInterval=="undefined"?1000:B.timeInterval;this.setTimeInterval(H);if(A&&typeof A=="object"&&Array.isArray(A)){A.forEach(function(E){this.addItem(E)},this)}},addItem:function(A){if(typeof A.name==="undefined"){throw"addItem() needs a name"}A.color=A.color||this.palette.color(A.name);A.data=A.data||[];if(A.data.length===0&&this.length&&this.getIndex()>0){this[0].data.forEach(function(B){A.data.push({x:B.x,y:0})})}else{if(A.data.length===0){A.data.push({x:this.timeBase-(this.timeInterval||0),y:0})}}this.push(A);if(this.legend){this.legend.addLine(this.itemByName(A.name))}},addData:function(B,F){var A=this.getIndex();D.keys(B).forEach(function(E){if(!this.itemByName(E)){this.addItem({name:E})}},this);this.forEach(function(E){E.data.push({x:F||(A*this.timeInterval||1)+this.timeBase,y:B[E.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(A){for(var B=0;B<this.length;B++){if(this[B].name==A){return this[B]}}},setTimeInterval:function(A){this.timeInterval=A/1000},setTimeBase:function(A){this.timeBase=A},dump:function(){var A={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};this.forEach(function(F){var B={color:F.color,name:F.name,data:[]};F.data.forEach(function(E){B.data.push({x:E.x,y:E.y})});A.items.push(B)});return A},load:function(A){if(A.timeInterval){this.timeInterval=A.timeInterval}if(A.timeBase){this.timeBase=A.timeBase}if(A.items){A.items.forEach(function(B){this.push(B);if(this.legend){this.legend.addLine(this.itemByName(B.name))}},this)}}});D.Series.zeroFill=function(A){D.Series.fill(A,0)};D.Series.fill=function(A,J){var I;var H=0;var B=A.map(function(E){return E.data});while(H<Math.max.apply(null,B.map(function(E){return E.length}))){I=Math.min.apply(null,B.filter(function(E){return E[H]}).map(function(E){return E[H].x}));B.forEach(function(E){if(!E[H]||E[H].x!=I){E.splice(H,0,{x:I,y:J})}});H++}};D.namespace("Rickshaw.Series.FixedDuration");D.Series.FixedDuration=D.Class.create(D.Series,{initialize:function(A,G,B){B=B||{};if(typeof B.timeInterval==="undefined"){throw new Error("FixedDuration series requires timeInterval")}if(typeof B.maxDataPoints==="undefined"){throw new Error("FixedDuration series requires maxDataPoints")}this.palette=new D.Color.Palette(G);this.timeBase=typeof B.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):B.timeBase;this.setTimeInterval(B.timeInterval);if(this[0]&&this[0].data&&this[0].data.length){this.currentSize=this[0].data.length;this.currentIndex=this[0].data.length}else{this.currentSize=0;this.currentIndex=0}this.maxDataPoints=B.maxDataPoints;if(A&&typeof A=="object"&&Array.isArray(A)){A.forEach(function(E){this.addItem(E)},this);this.currentSize+=1;this.currentIndex+=1}this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval;if(typeof this.maxDataPoints!=="undefined"&&this.currentSize<this.maxDataPoints){for(var H=this.maxDataPoints-this.currentSize-1;H>1;H--){this.currentSize+=1;this.currentIndex+=1;this.forEach(function(E){E.data.unshift({x:((H-1)*this.timeInterval||1)+this.timeBase,y:0,i:H})},this)}}},addData:function($super,A,B){$super(A,B);this.currentSize+=1;this.currentIndex+=1;if(this.maxDataPoints!==undefined){while(this.currentSize>this.maxDataPoints){this.dropData()}}},dropData:function(){this.forEach(function(A){A.data.splice(0,1)});this.currentSize-=1},getIndex:function(){return this.currentIndex}});return D});